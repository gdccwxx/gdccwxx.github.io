<!DOCTYPE html><html class="theme-next gemini use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="vz1PrlmOl-C4FBrH_at-JOEneuzGOz7AfXa3QVThvy8"><meta name="baidu-site-verification" content="code-4IMpMXQpb6"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon.ico?v=5.1.4"><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico?v=5.1.4"><meta name="keywords" content="gdccwxx"><meta name="description" content="ä¸ªäººåšå®¢åˆ†äº«ï¼Œçƒ­çˆ±ç”Ÿæ´»ï¼Œçƒ­çˆ±æ¢ç´¢"><meta property="og:type" content="website"><meta property="og:title" content="gdccwxx"><meta property="og:url" content="https://blog.gdccwxx.com/index.html"><meta property="og:site_name" content="gdccwxx"><meta property="og:description" content="ä¸ªäººåšå®¢åˆ†äº«ï¼Œçƒ­çˆ±ç”Ÿæ´»ï¼Œçƒ­çˆ±æ¢ç´¢"><meta property="og:locale" content="zh-Hans"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="gdccwxx"><meta name="twitter:description" content="ä¸ªäººåšå®¢åˆ†äº«ï¼Œçƒ­çˆ±ç”Ÿæ´»ï¼Œçƒ­çˆ±æ¢ç´¢"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Gemini",version:"5.1.4",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:{enable:!0,async:!1,transition:{post_header:"slideDownIn",post_body:"slideDownIn"}},duoshuo:{userId:"undefined",author:"åšä¸»"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://blog.gdccwxx.com/"><title>gdccwxx - :)</title><script>!function(e,a,t,n,g,c){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=+new Date,g=a.createElement(t),c=a.getElementsByTagName(t)[0],g.async=1,g.src="https://www.google-analytics.com/analytics.js",c.parentNode.insertBefore(g,c)}(window,document,"script","ga"),ga("create","UA-118405225-1","auto"),ga("send","pageview")</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">gdccwxx</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">:)</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>å…³äº</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>æ ‡ç­¾</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>å½’æ¡£</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/http/what-is-sse/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/http/what-is-sse/" itemprop="url">ä½¿ç”¨ SSE æ›¿ä»£è½®è¯¢</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-10-09T22:00:50+08:00">2021-10-09</time></span></div></header><div class="post-body" itemprop="articleBody"><h1 id="ğŸ“-èƒŒæ™¯"><a href="#ğŸ“-èƒŒæ™¯" class="headerlink" title="ğŸ“ èƒŒæ™¯"></a>ğŸ“ èƒŒæ™¯</h1><p>æµè§ˆå™¨å’ŒæœåŠ¡ç«¯äº¤äº’è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰æœåŠ¡ç«¯å‘æµè§ˆå™¨é€šä¿¡çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼šæœåŠ¡ç«¯å¼‚æ­¥å¤„ç†ä¿¡æ¯ï¼Œå¤„ç†æˆåŠŸåå‘æµè§ˆå™¨æ¨é€ã€‚</p><p>ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„åå°æœåŠ¡éƒ½å»ºç«‹äº† <code>websocket</code> é€šé“ï¼Œå› æ­¤å¸¸ç”¨åšæ³•æ˜¯æµè§ˆå™¨å®šæ—¶æŸ¥è¯¢ï¼Œ<code>è½®è¯¢</code>åå°æ•°æ®ã€‚</p><p>ä»è¯·æ±‚çš„è§’åº¦æ¥çœ‹ï¼Œ<code>è½®è¯¢</code>å¤šä½™äº†æµè§ˆå™¨å‘åå°æœåŠ¡<code>å‘èµ·æ¡æ‰‹</code>ã€<code>å‘é€æ•°æ®åŒ…</code>çš„è¿‡ç¨‹ï¼Œå› æ­¤å¹¶ä¸ç®€æ´ã€ä¼˜é›…ã€‚</p><p>é‚£æœ‰æ²¡æœ‰æ—¢ä¸éœ€è¦ <code>websocket</code> é€šé“ï¼Œåˆä¸ç”¨<code>è½®è¯¢</code>è¿™ä¹ˆ â€œlowâ€ çš„æ–¹æ³•å‘¢ï¼Ÿæœ¬æ–‡ä»‹ç»çš„ <code>SSE</code> (server-site events) å°±è¶³å¤Ÿç®€æ´å’Œä¼˜é›…ã€‚</p><h1 id="ğŸ¤”ï¸-SSE-æ˜¯å•¥"><a href="#ğŸ¤”ï¸-SSE-æ˜¯å•¥" class="headerlink" title="ğŸ¤”ï¸ SSE æ˜¯å•¥"></a>ğŸ¤”ï¸ SSE æ˜¯å•¥</h1><p><code>SSE</code> å…¨ç§°æ˜¯ Server-sent events(æœåŠ¡å™¨å‘é€äº‹ä»¶)ï¼Œæ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚</p><p><code>SSE</code> çš„æœ¬è´¨æ˜¯é€šè¿‡ <code>HTTP</code> è¯·æ±‚ï¼Œä¸æ–­å‘é€ <code>æµä¿¡æ¯(streaming)</code>ï¼Œä½¿å¾—æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ã€‚ç±»ä¼¼äºè§†é¢‘æµã€‚</p><p>ä»–ä¸æ˜¯ä¸€æ¬¡æ€§çš„æ•°æ®åŒ…ï¼Œè€Œæ˜¯ä¼šä¸€ç›´ç­‰ç€æœåŠ¡ç«¯çš„æ¨é€ã€‚å› æ­¤å®¢æˆ·ç«¯ä¸ä¼šå…³é—­è¿æ¥ï¼Œç­‰ç€æœåŠ¡ç«¯çš„ä¸æ–­æ¨é€ã€‚è¿™æ ·å°±å®ç°äº†æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯çš„æ¨é€ã€‚</p><h1 id="ğŸ†š-SSE-VS-Websocket"><a href="#ğŸ†š-SSE-VS-Websocket" class="headerlink" title="ğŸ†š SSE VS Websocket"></a>ğŸ†š SSE VS Websocket</h1><p><code>Websocket</code> æ˜¯åŒå‘é€šä¿¡(å…¨åŒå·¥)ï¼Œæµè§ˆå™¨ <-> æœåŠ¡ç«¯ç›¸äº’é€šä¿¡ï¼Œæ›´å¼ºå¤§ä¹Ÿæ›´çµæ´»ã€‚</-></p><p><code>SSE</code> æ˜¯å•å‘é€šä¿¡(åŠåŒå·¥)ï¼Œæµè§ˆå™¨ &lt;- æœåŠ¡ç«¯ï¼Œæœ¬è´¨æ˜¯ä¸‹è½½ä¿¡æ¯ã€‚</p><table><thead><tr><th>å¯¹æ¯”</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><code>Websocket</code></td><td>1. å…¨åŒå·¥ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§<br></td><td>1.è¾ƒä¸ºå¤æ‚ï¼ŒæœåŠ¡ç«¯éœ€è¦é‡æ–°æ”¯æŒ<br>2.æ–­çº¿é‡è¿éœ€è¦é¢å¤–éƒ¨ç½²</td></tr><tr><td><code>SSE</code></td><td>1.åè®®è½»é‡ï¼Œæ”¯æŒ HTTP çš„æœåŠ¡ç«¯å°±æ”¯æŒ<br>2.æ–¹ä¾¿é»˜è®¤æ”¯æŒæ–­çº¿é‡è¿<br>3.æ”¯æŒè‡ªå®šä¹‰æ•°æ®ç±»å‹</td><td>1.åŠåŒå·¥ï¼Œä¸å¤Ÿçµæ´»</td></tr></tbody></table><p>ä¸¤è€…å„æœ‰ç‰¹ç‚¹ï¼Œé€‚åˆä¸åŒåœºæ‰€</p><h1 id="ğŸ’¡-SSE-çš„ä½¿ç”¨"><a href="#ğŸ’¡-SSE-çš„ä½¿ç”¨" class="headerlink" title="ğŸ’¡ SSE çš„ä½¿ç”¨"></a>ğŸ’¡ SSE çš„ä½¿ç”¨</h1><p>æ—¢ç„¶ <code>SSE</code> ä½œç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼Œä¸‹é¢åˆ†ä¸º<code>å®¢æˆ·ç«¯</code>å’Œ<code>æœåŠ¡ç«¯</code>æ¥åˆ†åˆ«ä»‹ç» <code>API</code>ã€‚</p><h2 id="æµè§ˆå™¨çš„ä½¿ç”¨"><a href="#æµè§ˆå™¨çš„ä½¿ç”¨" class="headerlink" title="æµè§ˆå™¨çš„ä½¿ç”¨"></a>æµè§ˆå™¨çš„ä½¿ç”¨</h2><h3 id="æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨"><a href="#æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨" class="headerlink" title="æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨"></a>æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨</h3><p><code>SSE</code> åœ¨æµè§ˆå™¨ä¸­çš„APIåœ¨ <code>EventSource</code> å¯¹è±¡ä¸Šã€‚é€šè¿‡è¿™æ ·æ¥æ£€æµ‹æ˜¯å¦å¯ä»¥ä½¿ç”¨ï¼Œé€šå¸¸æ¥è®²ï¼Œé™¤äº† IE\Edgeï¼Œä¸»æµæµè§ˆå™¨éƒ½æ”¯æŒï¼š<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">Boolean</span>(<span class="built_in">window</span>.EventSource)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3 id="å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥"><a href="#å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥" class="headerlink" title="å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥"></a>å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥</h3><p>æµè§ˆå™¨å…ˆç”Ÿæˆ <code>EventSource</code> å®ä¾‹ï¼Œå†å‘æœåŠ¡å™¨å‘èµ·è¿æ¥ã€‚</p><p>å½“ç„¶ï¼Œurl å¯ä»¥æ˜¯å½“å‰ç½‘å€åŒåŸŸï¼Œä¹Ÿå¯ä»¥è·¨åŸŸã€‚<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒç½‘å€</span></span><br><span class="line"><span class="keyword">let</span> source = <span class="keyword">new</span> EventSource(url);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¨åŸŸå¸¦ä¸Š cookieã€‚ æ‰“å¼€withCredentialså±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦ä¸€èµ·å‘é€ Cookieã€‚</span></span><br><span class="line"><span class="keyword">let</span> source = <span class="keyword">new</span> EventSource(url, &#123; <span class="attr">withCredentials</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure><p></p><h3 id="çŠ¶æ€å˜åŒ–"><a href="#çŠ¶æ€å˜åŒ–" class="headerlink" title="çŠ¶æ€å˜åŒ–"></a>çŠ¶æ€å˜åŒ–</h3><p><code>EventSource</code> å®ä¾‹ä¸­ <code>readyState</code> å±æ€§è¡¨æ˜äº†å½“å‰è¿æ¥çŠ¶æ€ã€‚å¯ä»¥å–ä»¥ä¸‹å€¼ã€‚</p><table><thead><tr><th>å–å€¼</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td><code>0</code></td><td>è¡¨ç¤ºè¿æ¥è¿˜æœªå»ºç«‹ï¼Œæˆ–è€…æ–­çº¿æ­£åœ¨é‡è¿</td></tr><tr><td><code>1</code></td><td>è¡¨ç¤ºè¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥æ¥å—æ•°æ®</td></tr><tr><td><code>2</code></td><td>è¡¨ç¤ºè¿æ¥å·²æ–­ï¼Œä¸”ä¸ä¼šé‡è¿</td></tr></tbody></table><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><ul><li><p><code>å»ºç«‹è¿æ¥æ—¶</code>ï¼Œä¼šè§¦å‘ <code>open</code> äº‹ä»¶ï¼Œå’Œ <code>js</code> å…¶ä»–äº‹ä»¶ç”¨æ³•åŸºæœ¬ä¸€è‡´</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onopen å†™æ³•</span></span><br><span class="line">source.onopen = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// addEventListener</span></span><br><span class="line">source.addEventListener(<span class="string">'open'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>æ”¶åˆ°æ¶ˆæ¯æ—¶</code>ï¼Œä¼šè§¦å‘ <code>message</code> äº‹ä»¶ï¼Œå’Œ <code>js</code> å…¶ä»–äº‹ä»¶ç”¨æ³•åŸºæœ¬ä¸€è‡´ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onmessage å†™æ³•</span></span><br><span class="line">source.onmessage = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = event.data;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// addEventListener</span></span><br><span class="line">source.addEventListener(<span class="string">'message'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="comment">// data æ˜¯æœåŠ¡å™¨å›ä¼ çš„æ•°æ®ï¼Œæ˜¯ æ–‡æœ¬æ ¼å¼ï¼ŒäºŒè¿›åˆ¶éœ€è¦é‡æ–°è½¬ç </span></span><br><span class="line">  <span class="keyword">const</span> data = event.data;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>å‘ç”Ÿé”™è¯¯æ—¶</code>(ä¾‹å¦‚ä¸­æ–­)ï¼Œä¼šè§¦å‘ <code>error</code> äº‹ä»¶ï¼Œå’Œ <code>js</code> å…¶ä»–äº‹ä»¶ç”¨æ³•åŸºæœ¬ä¸€è‡´ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// onerror å†™æ³•</span></span><br><span class="line">source.onerror = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// addEventListener</span></span><br><span class="line">source.addEventListener(<span class="string">'error'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></li><li><p><code>å…³é—­è¿æ¥</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source.close();</span><br></pre></td></tr></table></figure></li><li><p><code>è‡ªå®šä¹‰äº‹ä»¶</code>, é»˜è®¤æƒ…å†µä¸‹è§¦å‘çš„æ˜¯ <code>message</code> äº‹ä»¶ï¼Œä½†æ˜¯è¿˜èƒ½è‡ªå®šä¹‰äº‹ä»¶ï¼Œä»è€Œä¸è§¦å‘ <code>message</code> äº‹ä»¶ã€‚æœ¬ä¾‹å­å¯¹ <code>info</code> äº‹ä»¶è¿›è¡Œç›‘å¬</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source.addEventListener(<span class="string">'info'</span>, (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = event.data;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure></li></ul><h2 id="æœåŠ¡ç«¯çš„ä½¿ç”¨"><a href="#æœåŠ¡ç«¯çš„ä½¿ç”¨" class="headerlink" title="æœåŠ¡ç«¯çš„ä½¿ç”¨"></a>æœåŠ¡ç«¯çš„ä½¿ç”¨</h2><h3 id="è¯·æ±‚å¤´"><a href="#è¯·æ±‚å¤´" class="headerlink" title="è¯·æ±‚å¤´"></a>è¯·æ±‚å¤´</h3><p>æœåŠ¡ç«¯çš„å‘æµè§ˆå™¨å‘é€çš„æ•°æ®æ˜¯ <code>UTF-8</code> çš„ç¼–ç æ–‡æœ¬ï¼Œ<code>HTTP</code> å¤´å…·æœ‰ç‰¹å®šçš„ä¿¡æ¯ã€‚<br>å¿…é¡»æŒ‡å®š <code>Content-Type</code> ç±»å‹ä¸º <code>event-steam</code>ã€‚<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: text/event-stream</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure><p></p><p><img src="/img/loading.gif" data-original="/http/what-is-sse/sse-header.png" alt="header"></p><h3 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h3><p>æ¯ä¸€æ¬¡å‘é€çš„ä¿¡æ¯ï¼Œç”±è‹¥å¹²ä¸ª <code>message</code> ç»„æˆï¼Œæ¯ä¸ª <code>message</code> ä¹‹é—´ç”¨\n\nåˆ†éš”ã€‚ç±»å‹å¦‚ä¸‹:<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•°æ®æ </span></span><br><span class="line">data: [value]\n</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ä¿¡æ¯ç±»å‹</span></span><br><span class="line">event: [value]\n</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°æ®æ ‡è¯†ç¬¦</span></span><br><span class="line">id: [value]\n</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€å¤§é—´éš”æ—¶é—´</span></span><br><span class="line">retry: [value]\n</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨é‡Š</span></span><br><span class="line">: [value]\n</span><br></pre></td></tr></table></figure><p></p><table><thead><tr><th>å¯¹æ¯”</th><th>æè¿°</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td><code>data</code></td><td>æ•°æ®å†…å®¹ç”¨dataè¡¨ç¤ºï¼Œå¯ä»¥å ç”¨ä¸€è¡Œæˆ–å¤šè¡Œï¼Œä»¥â€œ\n\nâ€ç»“å°¾</td><td>data: begin message\n<br>data: continue message\n\n</td></tr><tr><td><code>event</code></td><td>eventå¤´ä¿¡æ¯è¡¨ç¤ºè‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œæ²¡æœ‰åˆ™é»˜è®¤ <code>message</code> äº‹ä»¶</td><td>event: foo\n<br>data: a foo event\n\n</td></tr><tr><td><code>id</code></td><td>æ•°æ®æ ‡è¯†ç¬¦ç”¨idè¡¨ç¤ºï¼Œç›¸å½“äºæ¯ä¸€æ¡æ•°æ®çš„ç¼–å·</td><td>id: msg1\n<br>data: message\n\n</td></tr><tr><td><code>retry</code></td><td>æµè§ˆå™¨é»˜è®¤ä¸‰ç§’å†…æ²¡æœ‰å‘é€ä»»ä½•ä¿¡æ¯å¼€å§‹é‡è¿ã€‚æœåŠ¡å™¨ç«¯å¯ä»¥ç”¨ <code>retry</code> å¤´ä¿¡æ¯ï¼ŒæŒ‡å®šé€šä¿¡çš„æœ€å¤§é—´éš”æ—¶é—´</td><td>retry: 10000\n</td></tr><tr><td><code></code></td><td>é€šå¸¸ï¼ŒæœåŠ¡å™¨æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šå‘æµè§ˆå™¨å‘é€ä¸€ä¸ªæ³¨é‡Šä¿æŒè¿æ¥ä¸ä¸­æ–­</td><td>: This is a comment</td></tr></tbody></table><h2 id="æœåŠ¡ç«¯å®ç°"><a href="#æœåŠ¡ç«¯å®ç°" class="headerlink" title="æœåŠ¡ç«¯å®ç°"></a>æœåŠ¡ç«¯å®ç°</h2><p>æ¯ä¸ªæœåŠ¡ç«¯å®ç°ä¸åŒï¼Œä»¥ä¸‹æ˜¯ <code>NodeJS</code> æ–¹æ¡ˆå®ç°ã€‚</p><h3 id="NodeJS-å®ç°"><a href="#NodeJS-å®ç°" class="headerlink" title="NodeJS å®ç°"></a>NodeJS å®ç°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sse.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);<span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">"Content-Type"</span>: <span class="string">"text/event-stream"</span>,</span><br><span class="line">    <span class="string">"Cache-Control"</span>: <span class="string">"no-cache"</span>,</span><br><span class="line">    <span class="string">"Connection"</span>: <span class="string">"keep-alive"</span>,</span><br><span class="line">    <span class="string">"Access-Control-Allow-Origin"</span>: <span class="string">'*'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  res.write(<span class="string">"retry: 1000\n"</span>);</span><br><span class="line">  res.write(<span class="string">"event: connecttime\n"</span>);</span><br><span class="line">  res.write(<span class="string">"data: "</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">"\n\n"</span>);</span><br><span class="line"></span><br><span class="line">  interval = setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    res.write(<span class="string">"data: "</span> + (<span class="keyword">new</span> <span class="built_in">Date</span>()) + <span class="string">"\n\n"</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">  req.addListener(<span class="string">"close"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    clearInterval(interval);</span><br><span class="line">  &#125;, <span class="literal">false</span>);</span><br><span class="line">&#125;).listen(<span class="number">8080</span>);</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨å’Œè®¿é—®"><a href="#å¯åŠ¨å’Œè®¿é—®" class="headerlink" title="å¯åŠ¨å’Œè®¿é—®"></a>å¯åŠ¨å’Œè®¿é—®</h3><p>ä»…éœ€ <code>node sse.js</code> å³å¯æ‰“å¼€</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node sse.js</span><br></pre></td></tr></table></figure><p>å¹¶è®¿é—® <a href="http://127.0.0.1:8080/" target="_blank" rel="noopener">http://127.0.0.1:8080/</a> å°±èƒ½è®¿é—®åˆ° <code>sse</code> çš„é¡µé¢å•¦ï¼</p><h1 id="ğŸ”š-ç»“è¯­"><a href="#ğŸ”š-ç»“è¯­" class="headerlink" title="ğŸ”š ç»“è¯­"></a>ğŸ”š ç»“è¯­</h1><p>ä» <code>è½®è¯¢</code> åˆ° <code>SSE</code>ï¼Œå†åˆ° <code>SSE</code> å’Œ <code>Websocket</code> çš„æŠ€æœ¯é€‰å‹ï¼Œä¸åŒçš„åœºæ™¯ç”¨ä¸åŒæ–¹æ¡ˆã€‚åœ¨é±¼å’Œç†ŠæŒéƒ½è¦å…¼å¾—çš„é“è·¯ä¸Šï¼Œé“é˜»ä¸”é•¿ã€‚</p><p>å¼€å‘è¿‡ç¨‹å’Œæˆé•¿è¿‡ç¨‹ä¸€æ ·ã€‚å…ˆæ˜¯â€œé•¿å¤§â€å°±è¡Œï¼Œå†åˆ°â€œå¿«ç‚¹é•¿å¤§â€ï¼Œæœ€åæ˜¯â€œå¥½å¥½é•¿å¤§â€ã€‚å¼€å‘è¿‡ç¨‹ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå­—ç¬¦ä¸²æ›¿æ¢â€œé•¿å¤§â€ æˆ â€œè¿­ä»£â€ã€‚è¿™ä¸ªè¿‡ç¨‹å¿…ä¸å¯å°‘ï¼Œç»å†ä¹Ÿå®Œå…¨ä¸åŒã€‚</p><p>å¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥äº›å¸®åŠ©ï¼Œæ„Ÿè°¢ä½ çš„æ—¶é—´é˜…è¯»åˆ°è¿™é‡ŒğŸ’—ã€‚</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/git/git-rebase-merge-commit/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/git/git-rebase-merge-commit/" itemprop="url">git â€”â€” é€šè¿‡ rebase åˆå¹¶ commit</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-10-08T12:41:58+08:00">2021-10-08</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨é¡¹ç›®å¼€å‘æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°æ˜æ˜æ˜¯åŒä¸€ä¸ªä¿®æ”¹ï¼Œåœ¨ä¸€äº›ä¸å¯æŠ—æ‹’å› ç´ ä¸‹ï¼Œå¯¼è‡´æœ¬åº”è¯¥æ˜¯ä¸€æ¬¡æäº¤çš„ commit è¢«å¤šæ¬¡æäº¤ã€‚åœ¨å¼€æºç¤¾åŒºå¾€å¾€å¯¹commit message æœ‰ç€å¼ºè¿«ç—‡ä¼¼çš„æäº¤ã€‚</p><p>æœ¬ç¯‡çš„ç›®çš„å°±æ˜¯é€šè¿‡ rebase åˆå¹¶ commitã€‚</p><h2 id="åœºæ™¯å†ç°"><a href="#åœºæ™¯å†ç°" class="headerlink" title="åœºæ™¯å†ç°"></a>åœºæ™¯å†ç°</h2><p>åˆ†æ”¯: <code>master</code><br>æäº¤æ¬¡æ•°: <code>2æ¬¡</code><br>git log:</p><ul><li>åˆå§‹åŒ–: ç¬¬äºŒæ¬¡æäº¤ (<strong>å½“å‰æœ€æ–°commit</strong>)</li><li>åˆå§‹åŒ–: ç¬¬ä¸€æ¬¡æäº¤(éœ€è¦åˆå¹¶)</li><li>åˆå§‹åŒ–: initï¼ˆä¸éœ€è¦åˆå¹¶ï¼‰</li></ul><p><img src="/img/loading.gif" data-original="/git/git-rebase-merge-commit/git-log.png" alt="git-log"></p><h3 id="æœŸæœ›åœºæ™¯"><a href="#æœŸæœ›åœºæ™¯" class="headerlink" title="æœŸæœ›åœºæ™¯"></a>æœŸæœ›åœºæ™¯</h3><p>åˆå¹¶commit: <code>e4a5545b</code> å’Œ <code>1bc8133d</code><br>git log: <code>åˆå§‹åŒ–æ–‡ä»¶</code></p><h2 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h2><h3 id="å‹ç¼©-commit-å‘½ä»¤"><a href="#å‹ç¼©-commit-å‘½ä»¤" class="headerlink" title="å‹ç¼© commit å‘½ä»¤"></a>å‹ç¼© commit å‘½ä»¤</h3><p>å‘½ä»¤ï¼š<code>git rebase -i [start point] [end point]</code> or <code>git rebase -i HEAD~[number]</code> å¯ä½¿ç”¨ä»»æ„ä¸€ç§</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git rebase -i 03dcc16f // commitå·æ˜¯éœ€è¦åˆå¹¶æäº¤çš„å‰ä¸€æ¬¡æäº¤</span><br><span class="line">// or </span><br><span class="line">git rebase -i 03dcc16f 1bc8133d</span><br><span class="line">// or</span><br><span class="line">git rebase -i HEAD~2</span><br></pre></td></tr></table></figure><p>é”®å…¥å‘½ä»¤åï¼Œcommit ä¿¡æ¯ç”±æœ€å¼€å§‹åˆ°æœ€è¿‘æäº¤ã€‚å³ï¼šæœ€ä¸Šé¢æ˜¯æœ€å¼€å§‹çš„æäº¤ï¼Œæœ€ä¸‹é¢æ˜¯æœ€è¿‘æäº¤ã€‚<br><img src="/img/loading.gif" data-original="/git/git-rebase-merge-commit/git-rebase-pick.png" alt="git-rebase-pick"></p><h3 id="Rebase"><a href="#Rebase" class="headerlink" title="Rebase"></a>Rebase</h3><h4 id="1-å‘½ä»¤è§£æï¼š"><a href="#1-å‘½ä»¤è§£æï¼š" class="headerlink" title="1. å‘½ä»¤è§£æï¼š"></a>1. å‘½ä»¤è§£æï¼š</h4><ul><li><code>pick</code>: è¦æ‰§è¡Œè¿™ä¸ª commit</li><li><code>squash</code> : å½“å‰ commit ä¼šè¢«åˆå¹¶åˆ°å‰ä¸€ä¸ª commit</li><li>â€¦</li></ul><h4 id="2-æ“ä½œ-rebase-i"><a href="#2-æ“ä½œ-rebase-i" class="headerlink" title="2. æ“ä½œ rebase -i"></a>2. æ“ä½œ rebase -i</h4><ul><li>å°† <code>é™¤äº†ç¬¬ä¸€æ¡</code> çš„ <code>pick</code> éƒ½æ”¹ä¸º <code>squash</code> æˆ–è€… <code>s</code></li><li>vi <code>:wq</code> ä¿å­˜é€€å‡º</li></ul><p><img src="/img/loading.gif" data-original="/git/git-rebase-merge-commit/git-rebase-s.png" alt="git-rebase-s"></p><h4 id="3-git-rebase-åŸºç¡€æ“ä½œ-éå¿…è¦æ— éœ€æ­¤æ­¥"><a href="#3-git-rebase-åŸºç¡€æ“ä½œ-éå¿…è¦æ— éœ€æ­¤æ­¥" class="headerlink" title="3. git rebase åŸºç¡€æ“ä½œ(éå¿…è¦æ— éœ€æ­¤æ­¥)"></a>3. git rebase åŸºç¡€æ“ä½œ(éå¿…è¦æ— éœ€æ­¤æ­¥)</h4><p>git ä¼šå‹ç¼©æäº¤å†å²ï¼Œè‹¥æœ‰å†²çªï¼Œéœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œä¿®æ”¹çš„æ—¶å€™ä¿ç•™æœ€æ–°çš„å†å²è®°å½•ã€‚</p><ul><li><p>if æ‰§è¡Œå‹ç¼©ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git rebase --continue</span><br></pre></td></tr></table></figure></li><li><p>else å¦‚æœæ”¾å¼ƒæ­¤æ¬¡å‹ç¼©ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --abort</span><br></pre></td></tr></table></figure></li></ul><h4 id="4-ä¿®æ”¹-commit-message"><a href="#4-ä¿®æ”¹-commit-message" class="headerlink" title="4. ä¿®æ”¹ commit message"></a>4. ä¿®æ”¹ commit message</h4><p>è‹¥æ— å†²çª or å†²çªå·² fixï¼Œåˆ™ä¼šå‡ºç°ä¸€ä¸ª commit message ç¼–è¾‘é¡µé¢ã€‚</p><p>ä¿®æ”¹ commit messageï¼Œ vi <code>:wq</code> ä¿å­˜é€€å‡ºã€‚</p><p><img src="/img/loading.gif" data-original="/git/git-rebase-merge-commit/modify-commit-message.png" alt="modify-commit-message"></p><h4 id="5-æŸ¥çœ‹ä¿®æ”¹åçš„å†…å®¹"><a href="#5-æŸ¥çœ‹ä¿®æ”¹åçš„å†…å®¹" class="headerlink" title="5. æŸ¥çœ‹ä¿®æ”¹åçš„å†…å®¹"></a>5. æŸ¥çœ‹ä¿®æ”¹åçš„å†…å®¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><p><img src="/img/loading.gif" data-original="/git/git-rebase-merge-commit/modified-git-log.png" alt="modified-git-log"></p><p>å·²ç»å°† <code>e4a5545b</code> å’Œ <code>1bc8133d</code> åˆå¹¶æˆä¸€æ¡ <code>510bfd34</code> âœ…</p><h4 id="6-åŒæ­¥åˆ°è¿œç«¯"><a href="#6-åŒæ­¥åˆ°è¿œç«¯" class="headerlink" title="6. åŒæ­¥åˆ°è¿œç«¯"></a>6. åŒæ­¥åˆ°è¿œç«¯</h4><p>ä½¿ç”¨ <code>git push -f</code> or <code>git push --force</code> å¼ºåˆ¶æ¨é€ã€‚</p><p>ç”±äºæœ¬åœ° git commit è®°å½•è¢«æ”¹åŠ¨ï¼Œä¸è¿œç«¯çš„è®°å½•ä¸åŒ¹é…ã€‚å› æ­¤éœ€è¦ç”¨ <code>force push</code> å¼ºåˆ¶è¿œç«¯ä¸æœ¬åœ°è®°å½•åŒæ­¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git push -f</span><br><span class="line">// or</span><br><span class="line">git push --force</span><br></pre></td></tr></table></figure><p>å†çœ‹è¿œç«¯çš„ä»“åº“ï¼Œè®°å½•å·²ç»æ”¹å˜ï½</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/nestJs/nest-js-tutorial-4/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/nestJs/nest-js-tutorial-4/" itemprop="url">NestJs å…¥é—¨æ•™ç¨‹ä¹‹å››ï¼šé«˜é˜¶ç”¨æ³•</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-09-15T21:19:29+08:00">2021-09-15</time></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-4/nestjs.png" alt="nestjs"></p><a href="/nestJs/nest-js-tutorial-3/" title="ä¸Šç¯‡">ä¸Šç¯‡</a>æ–‡ç« ï¼Œå®ç°äº† <code>æ•°æ®åº“</code> åŸºç¡€æ“ä½œ å’Œè”è¡¨æŸ¥è¯¢ã€‚<br><br>æœ¬ç¯‡æ˜¯æ•™ç¨‹çš„æœ€ç»ˆç¯‡ï¼Œè™½ç„¶æˆ‘ä»¬å®ç°äº† NestJs çš„åŸºç¡€åŠŸèƒ½ï¼Œä½†æ˜¯çœŸæ­£çš„æœåŠ¡å™¨éœ€è¦åšå…¨å±€çš„æ•°æ®æ ¸æŸ¥ã€æ•æ„Ÿæ“ä½œè½åº“å’Œæ•°æ®è½¬åŒ–ã€‚<br><br>æ‹¥æœ‰è¿™äº›èƒ½åŠ›æ‰èƒ½è®©åå°èƒ½åŠ›æ›´åŠ ä¸°å¯Œï¼Œæœ¬ç¯‡å°†ä¸»è¦ä½¿ç”¨ NestJs çš„é«˜çº§èƒ½åŠ›ï¼Œæ¥å®ç°è¿™äº›åŠŸèƒ½ã€‚<br><br>æœ¬ç¯‡æ¦‚è¦ï¼š<br>- ä½¿ç”¨ <code>guards</code> å’Œ <code>decorators</code> å®ç°æ•°æ®æ ¡éªŒæ ¸æŸ¥<br>- é€šè¿‡ <code>interceptors</code> å’Œ <code>decorators</code> å®ç°æ•æ„Ÿæ“ä½œå½•å…¥<br>- è‡ªå®šä¹‰ <code>pipes</code> å®ç°æ•°æ®è½¬åŒ–<br><p>å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ <a href="https://github.com/gdccwxx/nest-test" target="_blank" rel="noopener">github</a> æ‰¾åˆ°ã€‚</p><h1 id="å®ˆå«-Guards"><a href="#å®ˆå«-Guards" class="headerlink" title="å®ˆå« Guards"></a>å®ˆå« Guards</h1><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-4/guards.png" alt="guards"><br>åœ¨ <code>è¯·æ±‚åˆ°è¾¾ä¸šåŠ¡é€»è¾‘å‰</code> ä¼šç»è¿‡ guardï¼Œè¿™æ ·åœ¨æ¥å£å‰å¯ä»¥åšç»Ÿä¸€å¤„ç†ã€‚</p><p>ä¾‹å¦‚ï¼šæ£€æŸ¥ç™»é™†æ€ã€æ£€æŸ¥æƒé™ â€¦</p><p>éœ€è¦åœ¨ä¸šåŠ¡é€»è¾‘å‰ <code>ç»Ÿä¸€æ£€æŸ¥</code> çš„ä¿¡æ¯ï¼Œéƒ½å¯ä»¥æŠ½è±¡æˆå®ˆå«ã€‚</p><p>åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œå¤§å¤šæ•°çš„åå°ç®¡ç†ç«¯ä¼šç”¨ <code>JWT</code> å®ç°æ¥å£é‰´æƒã€‚<code>NestJs</code> ä¹Ÿæä¾›äº†å¯¹åº”çš„<a href="https://docs.nestjs.com/security/authentication" target="_blank" rel="noopener">è§£å†³æ–¹æ¡ˆ</a>ã€‚</p><p>ç”±äºè¾ƒé•¿ä¸”åŸç†ç›¸é€šï¼Œæœ¬ç¯‡æš‚æ—¶ç”¨æ ¡éªŒ <code>user</code> å­—æ®µåšæ¼”ç¤ºã€‚</p><h2 id="æ–°å»ºå®ˆå«"><a href="#æ–°å»ºå®ˆå«" class="headerlink" title="æ–°å»ºå®ˆå«"></a>æ–°å»ºå®ˆå«</h2><p>æ–°å»º <code>user.guard.ts</code> æ–‡ä»¶</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/common/guards/user.guard.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable, CanActivate, ExecutionContext, UnauthorizedException &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserGuard <span class="keyword">implements</span> CanActivate &#123;</span><br><span class="line">  canActivate(</span><br><span class="line">    context: ExecutionContext,</span><br><span class="line">  ): <span class="built_in">boolean</span> | <span class="built_in">Promise</span>&lt;<span class="built_in">boolean</span>&gt; | Observable&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> request = context.switchToHttp().getRequest();</span><br><span class="line">    <span class="keyword">const</span> user = request.body.user;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnauthorizedException(<span class="string">'need user field'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å•ä¸ªæ¥å£ä½¿ç”¨å®ˆå«"><a href="#å•ä¸ªæ¥å£ä½¿ç”¨å®ˆå«" class="headerlink" title="å•ä¸ªæ¥å£ä½¿ç”¨å®ˆå«"></a>å•ä¸ªæ¥å£ä½¿ç”¨å®ˆå«</h2><p>å•ä¸ªæ¥å£ä½¿ç”¨éœ€è¦ç”¨ <code>@UseGuards</code> ä½œä¸ºå¼•ç”¨ã€‚å†å°†å®šä¹‰çš„ <code>UserGuard</code> ä½œä¸ºå…¥å‚ã€‚</p><p>åœ¨ <code>student.controller.ts</code> ä¸­ä½¿ç”¨<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;  UseGuards  <span class="comment">/** ... **/</span>&#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserGuard &#125; <span class="keyword">from</span> <span class="string">'../common/guards/user.guard'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@UseGuards</span>(UserGuard)</span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'who-are-you'</span>)</span><br><span class="line">    whoAreYouPost(<span class="meta">@Body</span>() student: StudentDto) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.ImStudent(student.name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™æ ·å½“è®¿é—® <code>who-are-you</code> å’Œ <code>who-is-request</code> å°±èµ·ä½œç”¨äº†<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// âŒ ä¸ä½¿ç”¨ user</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/who-are-you -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"name": "gdccwxx"&#125;'</span></span><br><span class="line">// =&gt; &#123;<span class="string">"statusCode"</span>:401,<span class="string">"message"</span>:<span class="string">"need user to distinct"</span>,<span class="string">"error"</span>:<span class="string">"Unauthorized"</span>&#125;%  </span><br><span class="line"></span><br><span class="line">// âœ… ä½¿ç”¨ user</span><br><span class="line">// curl -X POST http://127.0.0.1:3000/students/who-are-you -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"user": "gdccwxx", "name": "gdccwxx"&#125;'</span></span><br><span class="line">// =&gt; Im student gdccwxx%</span><br></pre></td></tr></table></figure><p></p><h2 id="å…¨å±€ä½¿ç”¨"><a href="#å…¨å±€ä½¿ç”¨" class="headerlink" title="å…¨å±€ä½¿ç”¨"></a>å…¨å±€ä½¿ç”¨</h2><p>å…¨å±€ä½¿ç”¨ä»…éœ€åœ¨ <code>app.module.ts</code> çš„ <code>providers</code> ä¸­å¼•å…¥ã€‚è¿™æ ·å°±å¯¹å…¨å±€ç”Ÿæ•ˆäº†<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; APP_GUARD &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserGuard &#125; <span class="keyword">from</span> <span class="string">'./common/guards/user.guard'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  controllers: [AppController],</span><br><span class="line">  providers: [</span><br><span class="line">    &#123;</span><br><span class="line">      provide: APP_GUARD,</span><br><span class="line">      useClass: UserGuard,</span><br><span class="line">    &#125;,</span><br><span class="line">      AppService</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™æ—¶å†è®¿é—® <code>get</code> è¯·æ±‚ <code>who-are-you</code> å’Œ <code>post</code> è¯·æ±‚ <code>who-is-request</code><br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// âŒ get who-are-you</span><br><span class="line">http://localhost:3000/students/who-are-you?name=gdccwxx</span><br><span class="line">// =&gt; &#123;</span><br><span class="line">// statusCode: 401,</span><br><span class="line">// message: <span class="string">"need user field"</span>,</span><br><span class="line">// error: <span class="string">"Unauthorized"</span></span><br><span class="line">// &#125;</span><br><span class="line"></span><br><span class="line">// âœ… post </span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/who-is-request -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"user": "gdccwxx"&#125;'</span></span><br><span class="line">// =&gt; gdccwxx%</span><br></pre></td></tr></table></figure><p></p><h2 id="è‡ªå®šä¹‰è£…é¥°å™¨è¿‡æ»¤"><a href="#è‡ªå®šä¹‰è£…é¥°å™¨è¿‡æ»¤" class="headerlink" title="è‡ªå®šä¹‰è£…é¥°å™¨è¿‡æ»¤"></a>è‡ªå®šä¹‰è£…é¥°å™¨è¿‡æ»¤</h2><p>æ€»æœ‰äº›æ¥å£æˆ‘ä»¬ä¸éœ€è¦æœ‰ <code>user</code> å­—æ®µï¼Œè¿™æ—¶è‡ªå®šä¹‰ <code>decorator</code> å°±å‡ºé©¬äº†ã€‚</p><p>åŸºæœ¬åŸç†æ˜¯ï¼šåœ¨æ¥å£å‰è®¾ç½® MetaData, åœ¨æœåŠ¡å¯åŠ¨æ—¶æŠŠ MetaData å†™å…¥å†…å­˜ï¼Œè¿™æ ·åœ¨è¯·æ±‚è¿‡æ¥æ—¶åˆ¤æ–­æœ‰æ—  MetaData æ ‡ç­¾ã€‚æœ‰åˆ™é€šè¿‡ï¼Œæ— åˆ™æ ¡éªŒã€‚</p><p>é¡ºä¾¿ä¹Ÿå°† <code>get</code> è¯·æ±‚ç±»å‹è¿‡æ»¤æ‰ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// common/decorators.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NoUser = <span class="function"><span class="params">()</span> =&gt;</span> SetMetadata(<span class="string">'no-user'</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p><code>user.guard.ts</code> æ”¹é€ </p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user.guard.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Reflector &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> UserGuard <span class="keyword">implements</span> CanActivate &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> reflector: Reflector</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  canActivate(</span><br><span class="line">    context: ExecutionContext,</span><br><span class="line">  ): <span class="built_in">boolean</span> | <span class="built_in">Promise</span>&lt;<span class="built_in">boolean</span>&gt; | Observable&lt;<span class="built_in">boolean</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> request = context.switchToHttp().getRequest();</span><br><span class="line">    <span class="keyword">const</span> user = request.body.user;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (request.method !== <span class="string">'POST'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> noCheck = <span class="keyword">this</span>.reflector.get&lt;<span class="built_in">string</span>[]&gt;(<span class="string">'no-user'</span>, context.getHandler());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (noCheck) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> UnauthorizedException(<span class="string">'need user field'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>NoUser</code> ä½¿ç”¨<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; User, NoUser &#125; <span class="keyword">from</span> <span class="string">'../common/decorators'</span>;</span><br><span class="line"><span class="comment">// ..</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="meta">@NoUser</span>()</span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'who-are-you'</span>)</span><br><span class="line">    whoAreYouPost(<span class="meta">@Body</span>() student: StudentDto) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.ImStudent(student.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å†è°ƒç”¨æ—¶ï¼Œå°±ä¸ä¼šå†æ ¡éªŒäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/who-are-you -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"name": "gdccwxx"&#125;'</span></span><br><span class="line">// =&gt; Im student gdccwxx%</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å®ç°äº†å…¨å±€å®ˆå«ï¼Œä½†æ˜¯éƒ¨åˆ†æ¥å£ä¸éœ€è¦å®ˆå«çš„æƒ…å†µã€‚</p><p>ç‰¹åˆ«é€‚ç”¨äºç™»å½•æ€çš„æ ¡éªŒï¼Œåªæœ‰ç™»é™†æ¥å£ä¸éœ€è¦ç™»å½•æ€ï¼Œå…¶ä»–æ¥å£éƒ½éœ€è¦ç™»é™†æ€æˆ–é‰´æƒã€‚</p><h1 id="æ‹¦æˆªå™¨-Interceptors"><a href="#æ‹¦æˆªå™¨-Interceptors" class="headerlink" title="æ‹¦æˆªå™¨ Interceptors"></a>æ‹¦æˆªå™¨ Interceptors</h1><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-4/interceptors.png" alt="interceptors"></p><p>æ‹¦æˆªå™¨å·¥ä½œåœ¨ <code>è¯·æ±‚å‰</code> å’Œ <code>å“åº”å</code>ã€‚å®ƒçš„åŸç†å’Œ <code>decorator</code> ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯èƒ½åšå…¨å±€çº§åˆ«ã€‚</p><p>å®ƒçš„åº”ç”¨åœºæ™¯ä¹Ÿéå¸¸å¹¿ï¼Œä¾‹å¦‚ï¼šæ¥å£è¯·æ±‚å‚æ•°å’Œè¯·æ±‚ç»“æœçš„æ•°æ®ä¿å­˜ã€è®¾è®¡æ¨¡å¼ä¸­çš„ adapter æ¨¡å¼ ç­‰â€¦</p><p>æˆ‘ä»¬æ¥ç”¨å®ƒå®ç°æ•æ„Ÿä¿¡æ¯çš„æ•°æ®ä¿å­˜ã€‚</p><p>å®ƒçš„åŸç†å’Œ <code>guards</code> ç±»ä¼¼, é€šè¿‡ <code>decorator</code> åŠ è½½åˆ°å†…å­˜ï¼ŒçŸ¥é“å“ªäº›æ¥å£éœ€è¦æ•æ„Ÿæ“ä½œè®°å½•ï¼Œç„¶ååœ¨è°ƒç”¨æ¥å£æ—¶å°† å…¥å‚å’Œç»“æœå­˜å…¥ã€‚</p><p>æ¶‰åŠåˆ°æ•°æ®åº“æ“ä½œï¼Œå› æ­¤éœ€è¦æ–°å¢æ¨¡å—å’Œæ•°æ®åº“è¿æ¥ã€‚</p><h2 id="æ–°å»ºæ•æ„Ÿæƒé™æ¨¡å—"><a href="#æ–°å»ºæ•æ„Ÿæƒé™æ¨¡å—" class="headerlink" title="æ–°å»ºæ•æ„Ÿæƒé™æ¨¡å—"></a>æ–°å»ºæ•æ„Ÿæƒé™æ¨¡å—</h2><p>æ–°å»ºæ•æ„Ÿæƒé™æ¨¡å—ï¼ŒåŒ…æ‹¬ controllerã€module å’Œ service<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nest g controller sensitive</span><br><span class="line">nest g module sensitive</span><br><span class="line">nest g service sensitive</span><br></pre></td></tr></table></figure><p></p><h2 id="åˆ›å»º-entity-æ–‡ä»¶"><a href="#åˆ›å»º-entity-æ–‡ä»¶" class="headerlink" title="åˆ›å»º entity æ–‡ä»¶"></a>åˆ›å»º entity æ–‡ä»¶</h2><p>æ–°å»º <code>sensitive.entity.ts</code> ã€‚</p><p>è¿™é‡Œä¼šç”¨åˆ° <code>transformer</code>, åŸå› æ˜¯ <code>mysql</code> åº•å±‚å¹¶æ²¡æœ‰ <code>Object</code> ç±»å‹ã€‚éœ€è¦é€šè¿‡ JS æŠŠå®ƒå­˜æˆ <code>string</code> æ ¼å¼ï¼Œåœ¨è¯»å–æ—¶ç”¨ <code>object</code> æ ¼å¼ã€‚è¿™æ ·ä»£ç å°±ä¸éœ€è¦æ„ŸçŸ¥æ˜¯å•¥ç±»å‹äº†ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Entity, Column, PrimaryGeneratedColumn, CreateDateColumn &#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveType &#125; <span class="keyword">from</span> <span class="string">'../constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// to å†™å…¥æ•°æ®åº“</span></span><br><span class="line"><span class="comment">// from ä»æ•°æ®åº“è¯»å–</span></span><br><span class="line"><span class="keyword">const</span> dataTransform = &#123;</span><br><span class="line">    to: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">JSON</span>.stringify(value || &#123;&#125;),</span><br><span class="line">    <span class="keyword">from</span>: <span class="function">(<span class="params">value: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">JSON</span>.parse(value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Sensitive &#123;</span><br><span class="line">  <span class="meta">@PrimaryGeneratedColumn</span>()</span><br><span class="line">  id: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="keyword">type</span>: <span class="string">'enum'</span>, <span class="keyword">enum</span>: SensitiveType &#125;)</span><br><span class="line">  <span class="keyword">type</span>: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="keyword">type</span>: <span class="string">'varchar'</span> &#125;)</span><br><span class="line">  pathname: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="keyword">type</span>: <span class="string">'text'</span>, transformer: dataTransform &#125;)</span><br><span class="line">  parameters: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="keyword">type</span>: <span class="string">'text'</span>, transformer: dataTransform &#125;)</span><br><span class="line">  results: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CreateDateColumn</span>()</span><br><span class="line">  createDate: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¼•ç”¨æ•°æ®åº“"><a href="#å¼•ç”¨æ•°æ®åº“" class="headerlink" title="å¼•ç”¨æ•°æ®åº“"></a>å¼•ç”¨æ•°æ®åº“</h2><p>å’Œä¹‹å‰ä»‹ç»æ•°æ®åº“ä¸€æ ·ï¼Œåœ¨ <code>sensitive.module.ts</code> ä¸­å¼•å…¥æ•°æ®åº“<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveController &#125; <span class="keyword">from</span> <span class="string">'./sensitive.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveService &#125; <span class="keyword">from</span> <span class="string">'./sensitive.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Sensitive &#125; <span class="keyword">from</span> <span class="string">'./entities/sensitive.entity'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  controllers: [SensitiveController],</span><br><span class="line">  imports: [TypeOrmModule.forFeature([Sensitive])],</span><br><span class="line">  providers: [Sensitive, SensitiveService],</span><br><span class="line">  exports: [SensitiveService],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> SensitiveModule &#123;&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="service-æ ¸å¿ƒé€»è¾‘"><a href="#service-æ ¸å¿ƒé€»è¾‘" class="headerlink" title="service æ ¸å¿ƒé€»è¾‘"></a>service æ ¸å¿ƒé€»è¾‘</h2><p>æ•æ„Ÿæ“ä½œæ¯”è¾ƒç®€å•ï¼Œservice ä»…éœ€å®ç°æ–°å¢å’ŒæŸ¥è¯¢ã€‚</p><p>å…ˆå®šä¹‰æ•æ„Ÿæ“ä½œç±»å‹<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/sensitive/constants.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> SensitiveType &#123;</span><br><span class="line">    Modify = <span class="string">'Modify'</span>,</span><br><span class="line">    Set = <span class="string">'Set'</span>,</span><br><span class="line">    Create = <span class="string">'Create'</span>,</span><br><span class="line">    Delete = <span class="string">'Delete'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨ä¿®æ”¹ serviceï¼Œå¼•å…¥dbæ“ä½œ</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/sensitive/sensitive.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Sensitive &#125; <span class="keyword">from</span> <span class="string">'./entities/sensitive.entity'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InjectRepository &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Repository &#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveType &#125; <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> SensitiveService &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="meta">@InjectRepository</span>(Sensitive)</span></span><br><span class="line"><span class="params">        <span class="keyword">private</span> readonly sensitiveRepository: Repository&lt;Sensitive&gt;,</span></span><br><span class="line"><span class="params">    </span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> setSensitive(<span class="keyword">type</span>: SensitiveType, pathname: <span class="built_in">string</span>, parameters: <span class="built_in">any</span>, results: <span class="built_in">any</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.sensitiveRepository.save(&#123;</span><br><span class="line">            <span class="keyword">type</span>,</span><br><span class="line">            pathname,</span><br><span class="line">            parameters,</span><br><span class="line">            results,</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">e</span> =&gt;</span> e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> getSensitive(<span class="keyword">type</span>: SensitiveType) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> <span class="keyword">this</span>.sensitiveRepository.find(&#123; </span><br><span class="line">            where: &#123;</span><br><span class="line">                <span class="keyword">type</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="controller-ä¿®æ”¹"><a href="#controller-ä¿®æ”¹" class="headerlink" title="controller ä¿®æ”¹"></a>controller ä¿®æ”¹</h2><p>controller æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦ç®€å•çš„æŸ¥è¯¢å³å¯ã€‚æ•æ„Ÿä¿¡æ¯å†™å…¥åˆ™æ˜¯é€šè¿‡ decorator + interceptor æ¥å®ç°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/sensitive/sensitive.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Query &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveService &#125; <span class="keyword">from</span> <span class="string">'./sensitive.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveType &#125; <span class="keyword">from</span> <span class="string">'./constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'sensitive'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> SensitiveController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly sensitiveService: SensitiveService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">'/get-by-type'</span>)</span><br><span class="line">    getSensitive(<span class="meta">@Query</span>(<span class="string">'type'</span>) <span class="keyword">type</span>: SensitiveType) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sensitiveService.getSensitive(<span class="keyword">type</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–°å¢è£…é¥°å™¨"><a href="#æ–°å¢è£…é¥°å™¨" class="headerlink" title="æ–°å¢è£…é¥°å™¨"></a>æ–°å¢è£…é¥°å™¨</h2><p>è£…é¥°å™¨çš„ç”¨åœºæ¥äº†ï¼Œåªéœ€è¦å‘Šè¯‰æŸä¸ªæ¥å£éœ€è¦æ•æ„Ÿæ“ä½œè®°å½•ï¼Œå¹¶æŒ‡å®šç±»å‹å³å¯ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/common/decorators</span></span><br><span class="line"><span class="keyword">import</span> &#123; SetMetadata &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveType &#125; <span class="keyword">from</span> <span class="string">'../sensitive/constants'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> SensitiveOperation = <span class="function">(<span class="params"><span class="keyword">type</span>: SensitiveType</span>) =&gt;</span> SetMetadata(<span class="string">'sensitive-operation'</span>, <span class="keyword">type</span>);</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¼ å‚çš„æ–¹å¼ï¼Œå®šä¹‰æ•æ„Ÿæ“ä½œçš„ç±»å‹ã€‚åœ¨æ•°æ®åº“ä¸­å¯ä»¥åˆ†ç±»ï¼Œé€šè¿‡ç´¢å¼•çš„æ–¹å¼æŸ¥æ‰¾ä¿®æ”¹å…¥å‚å’Œç»“æœã€‚</p><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><p>é‡ç‚¹æ¥äº†ï¼ï¼</p><p>å’Œå®ˆå«æƒé™æ ¡éªŒç±»ä¼¼ï¼Œé€šè¿‡ <code>reflector</code> å–å‡ºå†…å­˜ä¸­çš„ sensitive-operation ç±»å‹ã€‚</p><p>æ–°å»º <code>src/common/interceptors/sensitive.interceptor.ts</code></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/common/interceptors/sensitive.interceptor.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable, NestInterceptor, ExecutionContext, CallHandler &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Reflector &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveService &#125; <span class="keyword">from</span> <span class="string">'../../sensitive/sensitive.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveType &#125; <span class="keyword">from</span> <span class="string">'../../sensitive/constants'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; tap &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> SensitiveInterceptor <span class="keyword">implements</span> NestInterceptor &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> reflector: Reflector, <span class="keyword">private</span> sensitiveService: SensitiveService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  intercept(context: ExecutionContext, next: CallHandler): Observable&lt;<span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> request = context.switchToHttp().getRequest();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">type</span> = <span class="keyword">this</span>.reflector.get&lt;SensitiveType | <span class="literal">undefined</span>&gt;(<span class="string">'sensitive-operation'</span>, context.getHandler());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">type</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>  next.handle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> next</span><br><span class="line">      .handle()</span><br><span class="line">      .pipe(</span><br><span class="line">        tap(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="keyword">this</span>.sensitiveService.setSensitive(<span class="keyword">type</span>, request.url, request.body, data)),</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¹¶åœ¨ app.module.ts ä¸­å¼•å…¥å…¨å±€ã€‚<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; APP_GUARD, APP_INTERCEPTOR &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveInterceptor &#125; <span class="keyword">from</span> <span class="string">'./common/interceptors/sensitive.interceptor'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  providers: [</span><br><span class="line">    &#123;</span><br><span class="line">      provide: APP_INTERCEPTOR,</span><br><span class="line">      useClass: SensitiveInterceptor,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123; &#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="å…¶ä»–æ¨¡å—å¼•ç”¨"><a href="#å…¶ä»–æ¨¡å—å¼•ç”¨" class="headerlink" title="å…¶ä»–æ¨¡å—å¼•ç”¨"></a>å…¶ä»–æ¨¡å—å¼•ç”¨</h2><p>student æ¨¡å—å¼•å…¥<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/students/students.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveOperation &#125; <span class="keyword">from</span> <span class="string">'../common/decorators'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SensitiveType &#125; <span class="keyword">from</span> <span class="string">'../sensitive/constants'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@SensitiveOperation</span>(SensitiveType.Set)</span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'set-student-name'</span>)</span><br><span class="line">    setStudentName(<span class="meta">@User</span>() user: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.setStudent(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä»…éœ€è¦åœ¨æ¥å£å‰å¼•å…¥ <code>@SensitiveOperation(SensitiveType.Set)</code> å³å¯ï¼æ˜¯ä¸æ˜¯éå¸¸ä¼˜ç¾ã€‚</p><p>å†æ¥è°ƒç”¨ä¸‹ï¼<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// âœ… ä½¿ç”¨å‘½ä»¤è¡Œè°ƒç”¨</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/<span class="built_in">set</span>-student-name -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"user": "gdccwxx1"&#125;'</span></span><br><span class="line">// =&gt; &#123;<span class="string">"name"</span>:<span class="string">"gdccwxx1"</span>,<span class="string">"id"</span>:3,<span class="string">"updateDate"</span>:<span class="string">"2021-09-17T05:48:41.685Z"</span>,<span class="string">"createDate"</span>:<span class="string">"2021-09-17T05:48:41.685Z"</span>&#125;%</span><br><span class="line"></span><br><span class="line">// âœ… æ‰“å¼€æµè§ˆå™¨</span><br><span class="line">http://localhost:3000/sensitive/get-by-type?<span class="built_in">type</span>=<span class="built_in">set</span></span><br><span class="line">// =&gt; [&#123;</span><br><span class="line">//  id: 1,</span><br><span class="line">//  <span class="built_in">type</span>: <span class="string">"Set"</span>,</span><br><span class="line">//  pathname: <span class="string">"/students/set-student-name"</span>,</span><br><span class="line">//  parameters: &#123; user: <span class="string">"gdccwxx1"</span> &#125;,</span><br><span class="line">//  results: &#123; name: <span class="string">"gdccwxx1"</span>, id: 3, updateDate: <span class="string">"2021-09-17T05:48:41.685Z"</span>, createDate: <span class="string">"2021-09-17T05:48:41.685Z"</span> &#125;,</span><br><span class="line">//  createDate: <span class="string">"2021-09-17T05:48:41.719Z"</span></span><br><span class="line">// &#125;]</span><br></pre></td></tr></table></figure><p></p><p>bingoï¼è¿™æ ·å°±è¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç›®çš„ï¼</p><p>åœ¨ä¸å½±å“åŸæœ‰ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œä»…æ˜¯åœ¨æ¥å£å¤„åšæ ‡è¯†çš„ç®€å•è°ƒç”¨ã€‚å®ç°äº† <code>AOP</code> çš„è°ƒç”¨æ–¹å¼ã€‚å¯¹è€ä»£ç çš„æ”¹é€ å’Œæ–°ä¸šåŠ¡çš„ç¼–å†™éƒ½ååˆ†æœ‰ç”¨ã€‚</p><h1 id="ç®¡é“-Pipes"><a href="#ç®¡é“-Pipes" class="headerlink" title="ç®¡é“ Pipes"></a>ç®¡é“ Pipes</h1><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-4/pipes.png" alt="pipes"><br>NestJs <code>Pipes</code> çš„æ¦‚å¿µå’Œ linux <code>shell</code> çš„æ¦‚å¿µéå¸¸ç›¸ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡å‰è€…çš„è¾“å‡ºå†åšä¸€äº›äº‹æƒ…ã€‚</p><p>å®ƒçš„åº”ç”¨åœºæ™¯ä¹Ÿéå¸¸å¹¿ï¼Œä¾‹å¦‚ï¼šæ•°æ®è½¬åŒ–ï¼Œæ•°æ®æ ¡éªŒç­‰â€¦</p><p>å¯¹æ•°æ®è¾“å…¥æ—¶çš„æ“ä½œéå¸¸æœ‰ç”¨ã€‚å¯¹å¤æ‚æ•°æ®æ ¡éªŒï¼Œä¾‹å¦‚è¡¨å•æ•°æ®ç­‰ååˆ†æœ‰ç”¨ã€‚</p><p>æˆ‘ä»¬æ²¡æœ‰å¤æ‚è¾“å…¥ï¼Œæˆ‘ä»¬æ¥ä½¿ç”¨ç®€å•çš„æ•°æ®è½¬åŒ–ï¼Œå®ç°åœ¨åå­—å‰åŠ ä¸ŠğŸ‡¨ğŸ‡³</p><h2 id="æ–°å»º-Pipes"><a href="#æ–°å»º-Pipes" class="headerlink" title="æ–°å»º Pipes"></a>æ–°å»º Pipes</h2><p>æ–°å»º <code>src/common/pipes/name.pipes.ts</code>ã€‚<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/common/pipes/name.pipes.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; PipeTransform, Injectable, ArgumentMetadata &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> TransformNamePipe <span class="keyword">implements</span> PipeTransform &#123;</span><br><span class="line">  transform(name: <span class="built_in">string</span>, metadata: ArgumentMetadata) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`ğŸ‡¨ğŸ‡³ <span class="subst">$&#123;name.trim()&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å’Œå…¶ä»– NestJs ä¸€æ ·ï¼Œéƒ½éœ€è¦é‡è½½ä¸€è¾¹å†…ç½®å¯¹è±¡ã€‚<code>Pipes</code> ä¹Ÿéœ€è¦é‡è½½ <code>PipeTransform</code>ã€‚</p><h2 id="ä½¿ç”¨ç®¡é“"><a href="#ä½¿ç”¨ç®¡é“" class="headerlink" title="ä½¿ç”¨ç®¡é“"></a>ä½¿ç”¨ç®¡é“</h2><p>åœ¨ <code>controller</code> ä¸­ä½¿ç”¨ <code>pipes</code>ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; TransformNamePipe &#125; <span class="keyword">from</span> <span class="string">'../common/pipes/name.pipes'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">'who-are-you'</span>)</span><br><span class="line">    whoAreYou(<span class="meta">@Query</span>(<span class="string">'name'</span>, TransformNamePipe) name: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.ImStudent(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>query çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ pipes, ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ª pipes å¯¹æ•°æ®è¿ç»­å¤„ç†</p><h2 id="è°ƒç”¨æ¥å£"><a href="#è°ƒç”¨æ¥å£" class="headerlink" title="è°ƒç”¨æ¥å£"></a>è°ƒç”¨æ¥å£</h2><p>å†æµè§ˆå™¨è®¿é—®<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">http://localhost:3000/students/who-are-you?name=gdccwxx</span><br><span class="line">// =&gt; Im student ğŸ‡¨ğŸ‡³ gdccwxx</span><br></pre></td></tr></table></figure><p></p><p>è¿™æ ·å°±å®ç°äº†ç®€å•ç‰ˆæœ¬çš„æ•°æ®è½¬æ¢äº†ï¼</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è‡³æ­¤ï¼ŒNestJs çš„å…¥é—¨ç¯‡ç« å°±ç»“æŸäº†ã€‚</p><p>ç®€å•å›é¡¾ä¸‹æ•™ç¨‹å†…å®¹ï¼š</p><ul><li>é€šè¿‡ <code>nest cli</code> æ–°å»ºå·¥ç¨‹ã€æ–°å»ºæ¨¡å—</li><li>é€šè¿‡ <code>@Get</code> å’Œ <code>@Post</code> å®ç° getã€post è¯·æ±‚</li><li>é€šè¿‡ <code>dto</code> é™åˆ¶å¯¹å‚æ•°è¿›è¡Œé™åˆ¶</li><li>è‡ªå®šä¹‰ <code>decorator</code> å®ç°å‚æ•°è·å–ã€è®¾ç½® <code>metadata</code></li><li>è°ƒç”¨å†…ç½® <code>log</code> å®ç°æ—¥å¿—è§„èŒƒåŒ–</li><li>ä½¿ç”¨ <code>typeorm</code> å¯¹æ•°æ®åº“è¿æ¥å’ŒåŸºç¡€æ“ä½œï¼Œå¹¶è¿›è¡Œè”è¡¨æ“ä½œåŠæŸ¥è¯¢</li><li>ä½¿ç”¨ <code>guard</code> å¯¹å‚æ•°è¿›è¡Œæ ¡éªŒï¼ˆå¯æ‰©å±•æˆç™»å½•æ€ï¼‰</li><li>ä½¿ç”¨ <code>interceptor</code> å®ç°æ•æ„Ÿæ•°æ®è½åœ°</li><li>ä½¿ç”¨ <code>pipes</code> å®ç°æ•°æ®æ ¼å¼åŒ–</li></ul><p>ç¬”è€…ä¹Ÿåœ¨ NestJs é€æ¸æ¢ç´¢ä¸­ã€‚å®ƒä¸ä»…åŒ…æ‹¬ç®€å•çš„æ•°æ®æœåŠ¡ï¼Œè¿˜æ”¯æŒ <code>GraphQL</code>ã€<code>SSE</code>ã€<code>Microservice</code> ç­‰ç­‰ï¼Œæ˜¯ç»¼åˆæ€§éå¸¸å¼ºçš„æ¡†æ¶ã€‚</p><p>btwï¼šè¿™æ˜¯ç¬”è€…ç”¨è¿™ä¹ˆä¹…ä»¥æ¥æœ€å–œæ¬¢çš„ Node æ¡†æ¶äº†</p><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï½</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/nestJs/nest-js-tutorial-3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/nestJs/nest-js-tutorial-3/" itemprop="url">NestJs å…¥é—¨æ•™ç¨‹ä¹‹ä¸‰ï¼šæ•°æ®åº“</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-09-12T17:16:56+08:00">2021-09-12</time></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-3/nestjs.png" alt="nestjs"></p><p>è¿™ä¸ªç³»åˆ—çš„<a href="/nestJs/nest-js-tutorial-2/" title="ä¸Šä¸€ç¯‡">ä¸Šä¸€ç¯‡</a>æ–‡ç« ï¼Œå®ç°äº† <code>Post</code> æ¥å£å’Œå¯¹æ¥å£çš„åŸºç¡€æ“ä½œã€‚</p><p>è€ŒçœŸæ­£çš„æœåŠ¡å¾€å¾€åŒ…æ‹¬æ•°æ®å­˜å‚¨ã€‚</p><p>æœ¬ç¯‡å°†ä»‹ç»å¦‚ä½•å»ºç«‹ NestJs çš„æ•°æ®åº“è¿æ¥ã€å¹¶ä½¿ç”¨æ•°æ®åº“è”è¡¨æŸ¥è¯¢ã€‚è¿™æ ·å°±å°±æ˜¯å®Œæ•´çš„åå°æœåŠ¡äº†ã€‚</p><p>å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ <a href="https://github.com/gdccwxx/nest-test" target="_blank" rel="noopener">github</a> æ‰¾åˆ°ã€‚</p><p>æœ¬ç¯‡ä½¿ç”¨ <code>mysql</code> ä½œä¸ºæ•°æ®åº“è¿æ¥ã€‚ä½¿ç”¨ <code>NestJs</code> å†…ç½®çš„<a href="https://docs.nestjs.com/techniques/database" target="_blank" rel="noopener">æ•°æ®åº“è¿æ¥</a> <code>typeorm</code>ï¼Œå¯åœ¨ <a href="https://typeorm.io/" target="_blank" rel="noopener">è¿™é‡Œ</a> æŸ¥é˜… typeorm è¯¦ç»†æ–‡æ¡£</p><h1 id="ä¸€ã€å¼€å‘å‡†å¤‡"><a href="#ä¸€ã€å¼€å‘å‡†å¤‡" class="headerlink" title="ä¸€ã€å¼€å‘å‡†å¤‡"></a>ä¸€ã€å¼€å‘å‡†å¤‡</h1><ol><li><a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">ä¸‹è½½</a>å¹¶å®‰è£… Mysql</li><li><p>åˆ›å»º school åº“</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database school;</span><br></pre></td></tr></table></figure></li><li><p>å®‰è£… @nestjs/typeorm typeorm mysql2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save @nestjs/typeorm typeorm mysql2</span><br></pre></td></tr></table></figure></li></ol><h1 id="äºŒã€æ•°æ®åº“è¿æ¥"><a href="#äºŒã€æ•°æ®åº“è¿æ¥" class="headerlink" title="äºŒã€æ•°æ®åº“è¿æ¥"></a>äºŒã€æ•°æ®åº“è¿æ¥</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppController &#125; <span class="keyword">from</span> <span class="string">'./app.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppService &#125; <span class="keyword">from</span> <span class="string">'./app.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; StudentsController &#125; <span class="keyword">from</span> <span class="string">'./students/students.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [</span><br><span class="line">    StudentsModule,</span><br><span class="line">    TypeOrmModule.forRoot(&#123;</span><br><span class="line">      <span class="keyword">type</span>: <span class="string">'mysql'</span>,</span><br><span class="line">      host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">      port: <span class="number">3306</span>,</span><br><span class="line">      username: <span class="string">'root'</span>,</span><br><span class="line">      password: <span class="string">'1qaz2wsx'</span>,</span><br><span class="line">      database: <span class="string">'school'</span>,</span><br><span class="line">      autoLoadEntities: <span class="literal">true</span>,</span><br><span class="line">      synchronize: <span class="literal">true</span>, <span class="comment">// æ•°æ®åº“è‡ªåŠ¨åŒæ­¥ entity æ–‡ä»¶ä¿®æ”¹</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  controllers: [AppController],</span><br><span class="line">  providers: [AppService],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ã€‚</p><p><code>autoLoadEntities</code> è‡ªåŠ¨åŒ– load entity æ–‡ä»¶, æ‰€æœ‰åœ¨ Module ä¸­å¼•ç”¨çš„ Entity æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨åŠ è½½ã€‚è‡ªåŠ¨åŠ è½½è®¾ç½®ä¸º true å³å¯ã€‚</p><p><code>synchronize</code> è‡ªåŠ¨åŒ–åŒæ­¥è¡¨ï¼Œæœ¬åœ°å¯è‡ªåŠ¨æ‰“å¼€ï¼Œçº¿ä¸Šæ•°æ®åº“ä¸å»ºè®®æ‰“å¼€ã€‚</p><h1 id="ä¸‰ã€å®šä¹‰è¡¨ç»“æ„"><a href="#ä¸‰ã€å®šä¹‰è¡¨ç»“æ„" class="headerlink" title="ä¸‰ã€å®šä¹‰è¡¨ç»“æ„"></a>ä¸‰ã€å®šä¹‰è¡¨ç»“æ„</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    Entity,</span><br><span class="line">    Column,</span><br><span class="line">    PrimaryGeneratedColumn,</span><br><span class="line">    UpdateDateColumn,</span><br><span class="line">    CreateDateColumn,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Student &#123;</span><br><span class="line">  <span class="meta">@PrimaryGeneratedColumn</span>()</span><br><span class="line">  id: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="keyword">type</span>: <span class="string">'varchar'</span> &#125;)</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@UpdateDateColumn</span>()</span><br><span class="line">  updateDate: <span class="built_in">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CreateDateColumn</span>()</span><br><span class="line">  createDate: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>@Entity</code> æ³¨è§£ä»£è¡¨æ˜¯æ•°æ®åº“å…¥å£æ–‡ä»¶ï¼›</li><li><code>@Column</code> æ˜¯åŸºç¡€åˆ—æ–‡ä»¶ï¼Œä½¿ç”¨ <code>type</code> å­—æ®µå®šä¹‰åœ¨æ•°æ®åº“å®é™…å­˜å‚¨</li><li><code>@PrimaryGeneratedColumn</code> ä»£è¡¨å•è°ƒé€’å¢çš„ä¸»é”®</li><li><code>@UpdateDateColumn</code> å½“è®°å½•ä¿®æ”¹æ—¶ä¼šä¿®æ”¹æ—¶é—´</li><li><code>@CreateDateColumn</code> å½“è®°å½•æ–°å¢æ—¶ä¼šå†™å…¥æ—¶é—´</li></ul><h1 id="å››ã€å¼•ç”¨è¡¨"><a href="#å››ã€å¼•ç”¨è¡¨" class="headerlink" title="å››ã€å¼•ç”¨è¡¨"></a>å››ã€å¼•ç”¨è¡¨</h1><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Student &#125; <span class="keyword">from</span> <span class="string">'./entities/students.entity'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; TypeOrmModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; StudentsController &#125; <span class="keyword">from</span> <span class="string">'./students.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; StudentsService &#125; <span class="keyword">from</span> <span class="string">'./students.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">    imports: [TypeOrmModule.forFeature([Student])],</span><br><span class="line">    providers: [StudentsService, Student],</span><br><span class="line">    controllers: [StudentsController],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsModule &#123;&#125;</span><br></pre></td></tr></table></figure><ul><li><code>imports</code> å¼•ç”¨ typeorm æ¨¡å—ï¼Œ entity æ‰å¯ä»¥åœ¨ service ä¸­ä½¿ç”¨</li><li><code>providers</code> service çš„ constructor éœ€è¦å¼•ç”¨å“ªäº›æ¨¡å—</li><li><code>controllers</code> æ¨¡å—çš„ controller</li></ul><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable, Logger &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InjectRepository &#125; <span class="keyword">from</span> <span class="string">'@nestjs/typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Repository &#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Student &#125; <span class="keyword">from</span> <span class="string">'./entities/students.entity'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="meta">@InjectRepository</span>(Student)</span></span><br><span class="line"><span class="params">        <span class="keyword">private</span> readonly studentRepository: Repository&lt;Student&gt;,</span></span><br><span class="line"><span class="params">    </span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¼šåœ¨ db ä¸­å»ºç«‹ students æ–°è¡¨ã€‚</p><p>ä½¿ç”¨ <code>show create table</code> èƒ½çœ‹è¡¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">use school;</span><br><span class="line"></span><br><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">// =&gt; | student | CREATE TABLE `student` (</span><br><span class="line">//  `id` int NOT NULL AUTO_INCREMENT,</span><br><span class="line">//  `updateDate` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),</span><br><span class="line">//  `createDate` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),</span><br><span class="line">//  `name` varchar(255) NOT NULL,</span><br><span class="line">//  PRIMARY KEY (`id`)</span><br><span class="line">// ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci |</span><br></pre></td></tr></table></figure><h1 id="äº”ã€ä¸æ•°æ®åº“äº¤äº’"><a href="#äº”ã€ä¸æ•°æ®åº“äº¤äº’" class="headerlink" title="äº”ã€ä¸æ•°æ®åº“äº¤äº’"></a>äº”ã€ä¸æ•°æ®åº“äº¤äº’</h1><p>åˆ°è¿™ä¸€æ­¥ï¼Œç»ˆäºå¯ä»¥å’Œæ•°æ®åº“è¿›è¡Œäº¤äº’äº†ã€‚åŸºæœ¬ä¸Šå’Œæ•°æ®åº“äº¤äº’çš„éƒ¨åˆ†éƒ½ä¼šæ”¾åœ¨ service å±‚ï¼Œå› æ­¤ <code>æ–°å¢</code> å’Œ <code>æŸ¥è¯¢</code> éƒ½æ”¾åœ¨ service å±‚ã€‚</p><p>å…¶ä¸­åŒ…æ‹¬äº†</p><ul><li><code>getStudentName</code> çš„æ”¹é€ </li><li><code>setStudent</code> å‡½æ•°çš„æ–°å¢</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.service.ts</span></span><br><span class="line"><span class="comment">// import ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    <span class="comment">// logger, constructor ImStudent getStudentName ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> getStudentName(id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.logger.log(<span class="string">`get student id is <span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="keyword">this</span>.studentRepository.find(&#123; id &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> results ?? <span class="string">'not found'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> setStudent(name: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> results = <span class="keyword">this</span>.studentRepository.create(&#123; name &#125;);</span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨ <code>find</code> å’Œ <code>create</code> å¯¹å­¦ç”ŸæŸ¥è¯¢å’Œåˆ›å»ºã€‚ç»“æœä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚</p><p>ä¸‹é¢å¯¹ <code>controller</code> è¿›è¡Œæ”¹é€ ï¼Œä½¿å¾—å‡½æ•°è°ƒç”¨ä¸²èµ·æ¥ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.controller.ts</span></span><br><span class="line"><span class="comment">// import ...</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="comment">// constructor whoAreYou whoAreYouPost whoIsReq ..</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">'get-name-by-id'</span>)</span><br><span class="line">    getNameById(<span class="meta">@Query</span>(<span class="string">'id'</span>, ParseIntPipe) id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.getStudentName(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'set-student-name'</span>)</span><br><span class="line">    setStudentName(<span class="meta">@User</span>() user: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.setStudent(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¯¹ <code>service</code> çš„è°ƒç”¨, å†ç» <code>controller</code> è°ƒç”¨äº§ç”Ÿå¦‚ä¸‹ç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// âœ… å‘½ä»¤è¡Œè®¿é—®</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/<span class="built_in">set</span>-student-name -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"user": "gdccwxx"&#125;'</span></span><br><span class="line">// =&gt; &#123;<span class="string">"name"</span>:<span class="string">"gdccwxx"</span>,<span class="string">"id"</span>:1,<span class="string">"updateDate"</span>:<span class="string">"2021-09-12T15:57:14.599Z"</span>,<span class="string">"createDate"</span>:<span class="string">"2021-09-12T15:57:14.599Z"</span>&#125;%</span><br><span class="line"></span><br><span class="line">// âœ… æµè§ˆå™¨è®¿é—®</span><br><span class="line">http://localhost:3000/students/get-name-by-id?id=1</span><br><span class="line"></span><br><span class="line">// =&gt; [&#123;</span><br><span class="line">//  id: 1,</span><br><span class="line">//  name: <span class="string">"gdccwxx"</span>,</span><br><span class="line">//  updateDate: <span class="string">"2021-09-12T15:57:14.599Z"</span>,</span><br><span class="line">//  createDate: <span class="string">"2021-09-12T15:57:14.599Z"</span></span><br><span class="line">// &#125;]</span><br></pre></td></tr></table></figure><p>é€šè¿‡å¯¹ <code>service</code> çš„ saveã€find è°ƒç”¨ï¼Œå°±èƒ½å°†æ•°æ®å®Œæ•´å­˜å…¥æ•°æ®åº“äº†ã€‚</p><h1 id="å…­ã€è”è¡¨æŸ¥è¯¢"><a href="#å…­ã€è”è¡¨æŸ¥è¯¢" class="headerlink" title="å…­ã€è”è¡¨æŸ¥è¯¢"></a>å…­ã€è”è¡¨æŸ¥è¯¢</h1><p>æˆ‘ä»¬å‡†å¤‡æ–°å»ºè¯¾ç¨‹è¡¨<code>class</code>ï¼Œæ¯ä¸ªç­çº§å¯ä»¥æœ‰å¤šä¸ªå­¦ç”Ÿï¼Œä¸€ä¸ªå­¦ç”Ÿéš¶å±ä¸€ä¸ªç­çº§ã€‚</p><p>è¿™æ ·<code>å­¦ç”Ÿ</code>å’Œ<code>ç­çº§</code>å°±æ„æˆäº† <code>n:1</code> çš„å…³ç³»ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿å±•ç¤ºï¼Œåœ¨å­¦ç”Ÿæ¨¡å—ä¸‹ç›´æ¥æ–°å¢ <code>class.entity.ts</code> æ–‡ä»¶ã€‚å¹¶é€šè¿‡ <code>@OneToMany</code> å…³è” <code>students</code>ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// classes.entity.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Entity, Column, PrimaryGeneratedColumn, UpdateDateColumn, CreateDateColumn, OneToMany &#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Student &#125; <span class="keyword">from</span> <span class="string">'./students.entity'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Classes &#123;</span><br><span class="line">  <span class="meta">@PrimaryGeneratedColumn</span>()</span><br><span class="line">  id: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Column</span>(&#123; <span class="keyword">type</span>: <span class="string">'varchar'</span> &#125;)</span><br><span class="line">  className: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@OneToMany</span>(<span class="function"><span class="params">()</span> =&gt;</span> Student, <span class="function"><span class="params">student</span> =&gt;</span> student.class)</span><br><span class="line">  students: Student[]</span><br><span class="line"></span><br><span class="line">  <span class="meta">@UpdateDateColumn</span>()</span><br><span class="line">  updateDate: <span class="built_in">Date</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@CreateDateColumn</span>()</span><br><span class="line">  createDate: <span class="built_in">Date</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ—¶ä¿®æ”¹ <code>students.entity.ts</code>, é€šè¿‡ <code>@ManyToOne</code> å¼•å…¥ <code>Classes</code> ä¿®æ”¹</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.entity.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">    ManyToOne,</span><br><span class="line">    <span class="comment">// Entity...</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'typeorm'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Classes &#125; <span class="keyword">from</span> <span class="string">'./classes.entity'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> Student &#123;</span><br><span class="line">  <span class="comment">// id name updateDate, createDate...</span></span><br><span class="line">  <span class="meta">@ManyToOne</span>(<span class="function"><span class="params">()</span> =&gt;</span> Classes, <span class="function"><span class="params">classes</span> =&gt;</span> classes.students)</span><br><span class="line">  <span class="keyword">class</span>: Classes;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<code>classes</code> è¡¨å¼•ç”¨ <code>students</code> æ˜¯é€šè¿‡æ–°å»ºå­—æ®µ(<code>students\class</code>)è¿›è¡Œå…³è”ã€‚</p><p>å¼•ç”¨ä¼šæœ€ç»ˆåœ¨æ•°æ®åº“å˜æˆ<code>å¤–é”®</code>è¿æ¥ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">show create table student;</span><br><span class="line">// =&gt;  CREATE TABLE `student` (</span><br><span class="line">//   `id` int NOT NULL AUTO_INCREMENT,</span><br><span class="line">//   `name` varchar(255) NOT NULL,</span><br><span class="line">//   `updateDate` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),</span><br><span class="line">//   `createDate` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),</span><br><span class="line">//   `classId` int DEFAULT NULL,    // ğŸ‘ˆ æ³¨æ„è¿™é‡Œ</span><br><span class="line">//   PRIMARY KEY (`id`),</span><br><span class="line">//   KEY `FK_bd5c8f2ef67394162384a484ba1` (`classId`), // ğŸ‘ˆ æ³¨æ„è¿™é‡Œ</span><br><span class="line">//   CONSTRAINT `FK_bd5c8f2ef67394162384a484ba1` FOREIGN KEY (`classId`) REFERENCES `classes` (`id`) // ğŸ‘ˆ æ³¨æ„è¿™é‡Œ</span><br><span class="line">// ) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// è€Œ classes è¡¨å¹¶æ— é“¾æ¥</span><br><span class="line">show create table classes;</span><br><span class="line">// CREATE TABLE `classes` (</span><br><span class="line">//   `id` int NOT NULL AUTO_INCREMENT,</span><br><span class="line">//   `className` varchar(255) NOT NULL,</span><br><span class="line">//   `updateDate` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6) ON UPDATE CURRENT_TIMESTAMP(6),</span><br><span class="line">//   `createDate` datetime(6) NOT NULL DEFAULT CURRENT_TIMESTAMP(6),</span><br><span class="line">//   PRIMARY KEY (`id`)</span><br><span class="line">// ) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci</span><br></pre></td></tr></table></figure><p>å†å¼•å…¥è¡¨ï¼Œè¯¦ç»†æ“ä½œå¯çœ‹ç¬¬å››æ­¥ã€‚</p><p><code>students.module.ts</code> å¼•å…¥è¡¨<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.module.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Classes &#125; <span class="keyword">from</span> <span class="string">'./entities/classes.entity'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">    imports: [TypeOrmModule.forFeature([Student, Classes])],</span><br><span class="line">    providers: [StudentsService, Student, Classes],</span><br><span class="line">    <span class="comment">// ..</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsModule &#123;&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>students.service.ts</code> å¼•å…¥è¡¨, å¹¶å®ç° <code>setClass</code>, <code>getClass</code> æ–¹æ³•</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Classes &#125; <span class="keyword">from</span> <span class="string">'./entities/classes.entity'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"></span></span><br><span class="line"><span class="params">        <span class="meta">@InjectRepository</span>(Student)</span></span><br><span class="line"><span class="params">        <span class="keyword">private</span> readonly studentRepository: Repository&lt;Student&gt;,</span></span><br><span class="line"><span class="params">        <span class="meta">@InjectRepository</span>(Classes)</span></span><br><span class="line"><span class="params">        <span class="keyword">private</span> readonly classRepository: Repository&lt;Classes&gt;,</span></span><br><span class="line"><span class="params">    </span>) &#123;&#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">     <span class="keyword">async</span> setClass(name: <span class="built_in">string</span>, studentIds: <span class="built_in">number</span>[]) &#123;</span><br><span class="line">        <span class="keyword">const</span> students = <span class="keyword">await</span> <span class="keyword">this</span>.studentRepository.find(&#123; where: studentIds &#125;);</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.classRepository.save(&#123;</span><br><span class="line">            className: name,</span><br><span class="line">            students: students, <span class="comment">// æ­¤å¤„ç›´æ¥ä¿å­˜students çš„å®ä¾‹ï¼Œå³ç›´æ¥ä»æ•°æ®åº“å–å‡ºæ¥çš„æ•°æ®</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">async</span> findClass(id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="keyword">this</span>.classRepository.find(&#123;</span><br><span class="line">            where: &#123; id &#125;,</span><br><span class="line">            relations: [<span class="string">'students'</span>]</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å¢ <code>ClassesDto</code><br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// classes.dto.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; IsNotEmpty, IsString &#125; <span class="keyword">from</span> <span class="string">'class-validator'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> ClassesDto &#123;</span><br><span class="line">    <span class="meta">@IsNotEmpty</span>()</span><br><span class="line">    <span class="meta">@IsString</span>()</span><br><span class="line">    className: <span class="built_in">string</span>;</span><br><span class="line"></span><br><span class="line">    students: <span class="built_in">number</span>[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>students.controller.ts</code> ä¿®æ”¹<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.controller.ts</span></span><br><span class="line"><span class="comment">// import ...</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="comment">// constructor ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">'get-class'</span>)</span><br><span class="line">    getClass(<span class="meta">@Query</span>(<span class="string">'id'</span>, ParseIntPipe) id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.findClass(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'set-class'</span>)</span><br><span class="line">    setClass(<span class="meta">@Body</span>() classes: ClassesDto) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.setClass(classes.className, classes.students);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p><code>è°ƒç”¨æ¥å£</code>ï¼Œå…ˆæ’å…¥æ•°æ®å†æŸ¥è¯¢æ•°æ®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// å†æ–°å¢ä¸€æ¡æ•°æ®</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/<span class="built_in">set</span>-student-name -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"user": "gdccwxx1"&#125;'</span></span><br><span class="line"></span><br><span class="line">// æ’å…¥ classes æ•°æ®</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/<span class="built_in">set</span>-class -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"className": "blog", "students": [1,2]&#125;'</span></span><br><span class="line"></span><br><span class="line">// âœ… é€šè¿‡æµè§ˆå™¨ï¼ŒæŸ¥è¯¢é•¿å•¥æ ·</span><br><span class="line">http://localhost:3000/students/get-class?id=1</span><br><span class="line">// =&gt; [&#123;</span><br><span class="line">//  id: 1,</span><br><span class="line">    className: <span class="string">"blog"</span>,</span><br><span class="line">    updateDate: <span class="string">"2021-09-15T01:05:38.055Z"</span>,</span><br><span class="line">    createDate: <span class="string">"2021-09-15T01:05:38.055Z"</span>,</span><br><span class="line">    students: [&#123;</span><br><span class="line">        id: 1,</span><br><span class="line">        name: <span class="string">"gdccwxx"</span>,</span><br><span class="line">        updateDate: <span class="string">"2021-09-15T01:05:38.000Z"</span>,</span><br><span class="line">        createDate: <span class="string">"2021-09-15T01:05:23.988Z"</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">        id: 2,</span><br><span class="line">        name: <span class="string">"gdccwxx1"</span>,</span><br><span class="line">        updateDate: <span class="string">"2021-09-15T01:05:38.000Z"</span>,</span><br><span class="line">        createDate: <span class="string">"2021-09-15T01:05:28.084Z"</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;]</span><br></pre></td></tr></table></figure><h1 id="ä¸ƒã€ç®€å•å›é¡¾"><a href="#ä¸ƒã€ç®€å•å›é¡¾" class="headerlink" title="ä¸ƒã€ç®€å•å›é¡¾"></a>ä¸ƒã€ç®€å•å›é¡¾</h1><p>å†å›é¡¾ä¸‹æœ¬ç« ï¼š</p><ul><li>ä½¿ç”¨ <code>typeorm</code> å’Œ <code>mysql</code> å»ºç«‹è¿æ¥</li><li>ä½¿ç”¨ <code>entity</code> æ–‡ä»¶åˆ›å»ºæ•°æ®åº“è¡¨</li><li><code>service</code> ä½¿ç”¨å¯¹æ•°æ®åº“çš„ç®€å•è°ƒç”¨ï¼ŒåŒ…æ‹¬<code>å†™å…¥</code>å’Œ<code>è¯»å–</code></li><li>ä½¿ç”¨å…³ç³»æŸ¥è¯¢ï¼Œå°† <code>student</code> å’Œ <code>classes</code> è¿æ¥å†™å…¥å’ŒæŸ¥è¯¢</li></ul><p>è‡³æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>typeorm</code> å’Œ <code>mysql</code> è¿æ¥æ•°æ®åº“å°±å®Œæˆäº†ã€‚</p><p>å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ <a href="https://github.com/gdccwxx/nest-test" target="_blank" rel="noopener">github</a> æ‰¾åˆ°ã€‚</p><p><a href="/nestJs/nest-js-tutorial-4/" title="ä¸‹ç« ">ä¸‹ç« </a>æˆ‘ä»¬å°†ä¸»è¦è®² <code>NestJs</code> çš„é«˜çº§ç”¨æ³•ï¼ŒåŒ…æ‹¬ <code>ç®¡é“</code>ã€<code>å®ˆå«</code>å’Œ<code>æ‹¦æˆªå™¨</code>ã€‚æœŸå¾…ä½ çš„é˜…è¯»ã€‚</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/nestJs/nest-js-tutorial-2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/nestJs/nest-js-tutorial-2/" itemprop="url">NestJs å…¥é—¨æ•™ç¨‹ä¹‹äºŒï¼šå¤„ç†è¯·æ±‚</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-09-12T10:06:06+08:00">2021-09-12</time></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-2/nestjs.png" alt="nestjs"></p><p>è¿™ä¸ªç³»åˆ—çš„<a href="/nestJs/nest-js-tutorial-1/" title="ä¸Šä¸€ç¯‡">ä¸Šä¸€ç¯‡</a>æ–‡ç« ï¼Œæ•™å¤§å®¶å†™äº† hello world å’Œ æ–°å»º students æ¨¡å—ã€‚</p><p>ä½†æ˜¯ï¼Œé‚£åªæ˜¯å¾ˆå¹²çš„ Get è¯·æ±‚ï¼›å³æ²¡æœ‰ Post è¯·æ±‚ï¼Œä¹Ÿæ²¡æœ‰ç»™å‚æ•°åšæ£€æŸ¥ï¼›æ›´æ²¡æœ‰æ—¥å¿—çš„ä½¿ç”¨ã€‚</p><p>æœ¬ç¯‡æ¥ç€å¾€ä¸‹è®²ï¼Œé€šè¿‡ NestJs çš„åŸç”Ÿèƒ½åŠ›ï¼Œæ¥å®ç° Post è¯·æ±‚ï¼Œå¹¶åšå‚æ•°æ£€æŸ¥ï¼Œæœ€ååˆ©ç”¨åŸç”Ÿæ—¥å¿—æ¨¡å—å®ç°æ ‡å‡†åŒ–æ—¥å¿—ã€‚</p><p>å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ <a href="https://github.com/gdccwxx/nest-test" target="_blank" rel="noopener">github</a> æ‰¾åˆ°ã€‚</p><h1 id="ä¸€ã€Post-è¯·æ±‚"><a href="#ä¸€ã€Post-è¯·æ±‚" class="headerlink" title="ä¸€ã€Post è¯·æ±‚"></a>ä¸€ã€Post è¯·æ±‚</h1><p>ç»è¿‡ä¸Šç¯‡çš„ä»‹ç»ï¼Œæ€»ä½“è¯·æ±‚å…ˆä¼šç»è¿‡ students.controller.ts -&gt; å†åˆ° students.service.tsã€‚</p><p>åœ¨ students.service.ts ä¸Šæ–°å¢ <code>Post</code> æ–¹æ³•<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Post &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// @Get('who-are-you') ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'who-are-you'</span>)</span><br><span class="line">    whoAreYouPost() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.ImStudent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡ curl è®¿é—®åœ°å€<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">curl -X POST  http://127.0.0.1:3000/students/who-are-you</span><br><span class="line">// =&gt; Im student%</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡æ›¿æ¢è£…é¥°å™¨ï¼Œå°±å¯ä»¥å¿«é€Ÿå®ç° <code>Post</code> è¯·æ±‚ã€‚</p><h1 id="äºŒã€è¯·æ±‚å‚æ•°"><a href="#äºŒã€è¯·æ±‚å‚æ•°" class="headerlink" title="äºŒã€è¯·æ±‚å‚æ•°"></a>äºŒã€è¯·æ±‚å‚æ•°</h1><p>æ­£å¸¸è¯·æ±‚éƒ½ä¼šåŠ ä¸Šå‚æ•°ï¼Œ<code>Get</code> å’Œ <code>Post</code> æ–¹æ³•åŠ å‚æ•°ç•¥æœ‰ä¸åŒã€‚</p><p>å…ˆçœ‹ Get è¯·æ±‚</p><h2 id="Get-è¯·æ±‚å‚æ•°"><a href="#Get-è¯·æ±‚å‚æ•°" class="headerlink" title="Get è¯·æ±‚å‚æ•°"></a>Get è¯·æ±‚å‚æ•°</h2><p>Get è¯·æ±‚çš„å‚æ•°ä¸€èˆ¬ä¼šæ”¾åœ¨ URL ä¸Šï¼Œè¿™æ˜¯ <code>@Query</code> è£…é¥°å™¨å°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p>å…ˆæ”¹é€  controller</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Post, Query &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">'who-are-you'</span>)</span><br><span class="line">    whoAreYou(<span class="meta">@Query</span>(<span class="string">'name'</span>) name: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.ImStudent(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†æ”¹é€  service</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    ImStudent(name?: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Im student '</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æµè§ˆå™¨è®¿é—® url<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">http://localhost:3000/students/who-are-you?name=gdccwxx</span><br><span class="line">// =&gt; Im student gdccwxx</span><br></pre></td></tr></table></figure><p></p><p>è¿™æ · Get è¯·æ±‚å°±èƒ½è·å–åˆ° name å‚æ•°äº†</p><h2 id="Post-å‚æ•°"><a href="#Post-å‚æ•°" class="headerlink" title="Post å‚æ•°"></a>Post å‚æ•°</h2><p>Post å‚æ•°æœ‰äº›ä¸åŒï¼Œä¼šç”¨åˆ° <a href="https://baike.baidu.com/item/DTO/16016821" target="_blank" rel="noopener">DTO</a> çš„ä¼ è¾“ã€‚å› ä¸ºæ•°æ®é€šè¿‡ HTTP ä¼ è¾“æ˜¯æ–‡æœ¬ç±»å‹ï¼Œå› æ­¤éœ€è¦å°†æ–‡æœ¬ç±»å‹è½¬åŒ–æˆä»£ç å¯è¯†åˆ«çš„å˜é‡ã€‚</p><p>æ–°å»º students.dto.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/students/dtos/students.dto.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentDto &#123;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¼–è¾‘ students.controller.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Body, Controller, Get, Post, Query &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; StudentDto &#125; <span class="keyword">from</span> <span class="string">'./dtos/students.dto'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; StudentsService &#125; <span class="keyword">from</span> <span class="string">'./students.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// @Get('who-are-you') ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'who-are-you'</span>)</span><br><span class="line">    whoAreYouPost(<span class="meta">@Body</span>() student: StudentDto) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.ImStudent(student.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å‘½ä»¤è¡Œè®¿é—®<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">curl -X POST -d&quot;name=gdccwxx&quot;  http://127.0.0.1:3000/students/who-are-you</span><br><span class="line">// =&gt; Im student gdccwxx%</span><br></pre></td></tr></table></figure><p></p><p>post æ–¹æ³•ä¼ é€’çš„å‚æ•°æ˜¯é€šè¿‡è¯·æ±‚ body ç»™åˆ°åå°çš„ã€‚éœ€è¦é€šè¿‡ <code>@Body</code> è£…é¥°å™¨è§£æ Body ä¸­çš„æ•°æ®ã€‚</p><h1 id="ä¸‰ã€å‚æ•°é™åˆ¶ä¸è½¬æ¢"><a href="#ä¸‰ã€å‚æ•°é™åˆ¶ä¸è½¬æ¢" class="headerlink" title="ä¸‰ã€å‚æ•°é™åˆ¶ä¸è½¬æ¢"></a>ä¸‰ã€å‚æ•°é™åˆ¶ä¸è½¬æ¢</h1><p>è¿™éƒ¨åˆ†å…¶å®ç”¨åˆ°äº† <a href="https://docs.nestjs.com/pipes" target="_blank" rel="noopener">ç®¡é“</a> çš„æ¦‚å¿µï¼Œæˆ‘ä»¬ç”¨åŸºç¡€ç®¡é“æ¥å®ç°ï¼Œæ›´é«˜é˜¶ç”¨æ³•å°†ä¼šæ”¾åœ¨<a href="/nestJs/nest-js-tutorial-4/" title="ç¬¬å››ç« ">ç¬¬å››ç« </a>ä¸­</p><h2 id="Get-è¯·æ±‚"><a href="#Get-è¯·æ±‚" class="headerlink" title="Get è¯·æ±‚"></a>Get è¯·æ±‚</h2><p>get è¯·æ±‚éœ€è¦ç”¨åˆ° <code>ParseIntPipe</code>, æ›´å¤šçš„å†…ç½®ç®¡é“åˆ—è¡¨å¯æŸ¥çœ‹<a href="https://docs.nestjs.com/pipes#built-in-pipes" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>æµè§ˆå™¨è®¿é—®çš„ url é»˜è®¤æ˜¯ string ç±»å‹ï¼Œ<code>ParseIntPipe</code> ç®¡é“èƒ½å°† string ç±»å‹è½¬åŒ–æˆ number ç±»å‹</p><p>è¿™æ¬¡æˆ‘ä»¬å®ç°çš„æ˜¯é€šè¿‡ id æŸ¥æ‰¾å­¦ç”Ÿå§“åã€‚</p><p>ä¿®æ”¹ students.service.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    <span class="comment">// ImStudent...</span></span><br><span class="line"></span><br><span class="line">    getStudentName(id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> ID_NAME_MAP = &#123;</span><br><span class="line">            <span class="number">1</span>: <span class="string">'gdccwxx'</span>,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ID_NAME_MAP[id] ?? <span class="string">'not found'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹ students.controller.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Body, Controller, Get, Post, Query, ParseIntPipe &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="comment">// ... </span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// @Get('who-are-you') ..</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// @Post('who-are-you') ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>(<span class="string">'get-name-by-id'</span>)</span><br><span class="line">    getNameById(<span class="meta">@Query</span>(<span class="string">'id'</span>, ParseIntPipe) id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.studentsService.getStudentName(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æµè§ˆå™¨ä½¿ç”¨å‚æ•°è®¿é—®<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// âŒ</span><br><span class="line">http://localhost:3000/students/get-name-by-id?id=gdccwxx</span><br><span class="line">// =&gt; &#123;</span><br><span class="line">//     statusCode: 400,</span><br><span class="line">//     message: &quot;Validation failed (numeric string is expected)&quot;,</span><br><span class="line">//     error: &quot;Bad Request&quot;</span><br><span class="line">// &#125; </span><br><span class="line"></span><br><span class="line">// âœ…</span><br><span class="line">http://localhost:3000/students/get-name-by-id?id=1</span><br><span class="line">// =&gt; gdccwxx</span><br></pre></td></tr></table></figure><p></p><p>å½“ä½¿ç”¨éæ³•è¯·æ±‚ï¼Œå¯¼è‡´æ— æ³•è½¬æ¢æ—¶ï¼ŒNestJs ä¼šå°†è¯·æ±‚æŠ¥é”™å¤„ç†ï¼Œè€Œæ­£ç¡®å‚æ•°åˆ™ä¼šè½¬æ¢åè°ƒç”¨è°ƒç”¨ç›¸åº”å‡½æ•°ã€‚é€šè¿‡ç®€å•çš„è£…é¥°å™¨å¼•ç”¨ï¼Œ NestJs æ¡†æ¶å°±å¯ä»¥è‡ªåŠ¨åšäº†å‚æ•°æ£€æŸ¥ä¸è½¬æ¢äº†</p><h2 id="Post-è¯·æ±‚"><a href="#Post-è¯·æ±‚" class="headerlink" title="Post è¯·æ±‚"></a>Post è¯·æ±‚</h2><p>Post è¯·æ±‚ç•¥å¾®æœ‰äº›ä¸ä¸€æ ·ï¼Œè¦ç”¨åˆ° class-validator</p><p>å®‰è£… class-validator<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i --save class-validator class-transformer</span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹ main.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; NestFactory &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ValidationPipe &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppModule &#125; <span class="keyword">from</span> <span class="string">'./app.module'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create(AppModule);</span><br><span class="line">  app.useGlobalPipes(<span class="keyword">new</span> ValidationPipe());</span><br><span class="line">  <span class="keyword">await</span> app.listen(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line">bootstrap();</span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹ student.dto.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; IsNotEmpty, IsString &#125; <span class="keyword">from</span> <span class="string">'class-validator'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentDto &#123;</span><br><span class="line">    <span class="meta">@IsNotEmpty</span>()</span><br><span class="line">    <span class="meta">@IsString</span>()</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡å‘½ä»¤è¡Œè®¿é—®<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// âŒ</span><br><span class="line">curl -X POST  http://127.0.0.1:3000/students/who-are-you</span><br><span class="line">// =&gt; &#123;&quot;statusCode&quot;:400,&quot;message&quot;:[&quot;name must be a string&quot;,&quot;name should not be empty&quot;],&quot;error&quot;:&quot;Bad Request&quot;&#125;%</span><br><span class="line"></span><br><span class="line">// âŒ</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/who-are-you -H &apos;Content-Type: application/json&apos; -d &apos;&#123;&quot;name&quot;: 1&#125;&apos;</span><br><span class="line">// =&gt; &#123;&quot;statusCode&quot;:400,&quot;message&quot;:[&quot;name must be a string&quot;],&quot;error&quot;:&quot;Bad Request&quot;&#125;% </span><br><span class="line"></span><br><span class="line">// âœ…</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/who-are-you -H &apos;Content-Type: application/json&apos; -d &apos;&#123;&quot;name&quot;: &quot;gdccwxx&quot;&#125;&apos;</span><br><span class="line">// =&gt; Im student gdccwxx%</span><br></pre></td></tr></table></figure><p></p><p>åˆ°æ­¤ï¼Œå‚æ•°æ ¡éªŒéƒ¨åˆ†ä¹Ÿå°±å®Œæˆã€‚</p><h1 id="å››ã€è‡ªå®šä¹‰è£…é¥°å™¨"><a href="#å››ã€è‡ªå®šä¹‰è£…é¥°å™¨" class="headerlink" title="å››ã€è‡ªå®šä¹‰è£…é¥°å™¨"></a>å››ã€è‡ªå®šä¹‰è£…é¥°å™¨</h1><p>åœ¨ post è¯·æ±‚ç”¨åˆ°äº†å¤§é‡çš„è£…é¥°å™¨ï¼Œç³»ç»Ÿè£…é¥°å™¨èƒ½æ»¡è¶³å¤§éƒ¨åˆ†åœºæ™¯ï¼Œä½†æ˜¯æœ‰äº›ç‰¹å®šéœ€æ±‚æ—¶ï¼Œéœ€è¦è‡ªå®šä¹‰è£…é¥°å™¨ã€‚</p><p>ä¾‹å¦‚è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šæ¯ä¸ªè¯·æ±‚éƒ½ä¼šå¸¦ä¸Š <code>user</code> å­—æ®µã€‚ä»£è¡¨æ˜¯è°åšçš„è¯·æ±‚ï¼Œæ¯æ¬¡åœ¨ä»£ç é‡Œ getUser æ˜¯éå¸¸éš¾å—çš„äº‹æƒ…ï¼Œè¿™æ—¶è‡ªå®šä¹‰è£…é¥°å™¨å°±æ´¾ä¸Šäº†ç”¨åœºã€‚</p><p>æ–°å»º src/common/decorators.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/common/decorators.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; createParamDecorator, ExecutionContext &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> User = createParamDecorator(</span><br><span class="line">  (data: unknown, ctx: ExecutionContext) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> request = ctx.switchToHttp().getRequest(); <span class="comment">// æ‹¿åˆ°è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">return</span> request.body.user;</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹ students.controller.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Body, Controller, Get, Post, Query, ParseIntPipe &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; StudentsService &#125; <span class="keyword">from</span> <span class="string">'./students.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">'../common/decorators'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'students'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsController &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> readonly studentsService: StudentsService</span>) &#123;&#125;</span><br><span class="line">    <span class="comment">// @Get('who-are-you') ...</span></span><br><span class="line">    <span class="comment">// @Post('who-are-you') ...</span></span><br><span class="line">    <span class="comment">// @Get('get-name-by-id')...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>(<span class="string">'who-is-request'</span>)</span><br><span class="line">    whoIsReq(<span class="meta">@User</span>() user: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å‘½ä»¤è¡Œè®¿é—®<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">curl -X POST http://127.0.0.1:3000/students/who-is-request -H <span class="string">'Content-Type: application/json'</span> -d <span class="string">'&#123;"user": "gdccwxx"&#125;'</span></span><br><span class="line">// =&gt; gdccwxx%</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡è‡ªå®šä¹‰è£…é¥°å™¨ï¼Œå¹¶å°†å…¶æŒ‚åœ¨å‡½æ•°ä¸Šï¼Œä»£ç å°±èƒ½ä¼˜é›…çš„è·å–æ˜¯è°è¯·æ±‚çš„å€Ÿå£ã€‚</p><h1 id="äº”ã€æ—¥å¿—"><a href="#äº”ã€æ—¥å¿—" class="headerlink" title="äº”ã€æ—¥å¿—"></a>äº”ã€æ—¥å¿—</h1><p>åå°æ¥å£è¯·æ±‚å¸¸ä¼´éšæ—¥å¿—äº§ç”Ÿï¼Œæ—¥å¿—å¯¹åå°æŸ¥é—®é¢˜è‡³å…³é‡è¦ã€‚NestJs æ¡†æ¶ä¹Ÿé›†æˆäº†æ—¥å¿—ï¼Œå¼€ç®±å³ç”¨ã€‚</p><p>ä½¿ç”¨æ—¥å¿—åˆ†ä¸ºä¸‰æ­¥:</p><ul><li>main.ts å¼•å…¥ <code>Logger</code></li><li>æ¨¡å—å¼•å…¥æ—¥å¿—ç»„å»º: <code>private readonly logger = new Logger(StudentsService.name)</code>;</li><li>åœ¨éœ€è¦æ‰“å°çš„åœ°æ–¹å¼•å…¥: this.logger.log(`student name is ${name}`);</li></ul><p>ä¿®æ”¹main.ts<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; NestFactory &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ValidationPipe, Logger &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppModule &#125; <span class="keyword">from</span> <span class="string">'./app.module'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create(AppModule, &#123;</span><br><span class="line">    logger: <span class="keyword">new</span> Logger(),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p></p><p>å¼•ç”¨ Logger ç»„å»º<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable, Logger &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    <span class="keyword">private</span> readonly logger = <span class="keyword">new</span> Logger(StudentsService.name);</span><br><span class="line"></span><br><span class="line">    ImStudent(name?: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.logger.log(<span class="string">`student name is <span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Im student '</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getStudentName(id: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.logger.log(<span class="string">`get student id is <span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">const</span> ID_NAME_MAP = &#123;</span><br><span class="line">            <span class="number">1</span>: <span class="string">'gdccwxx'</span>,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ID_NAME_MAP[id] ?? <span class="string">'not found'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è®¿é—®æ¥å£ï¼Œæ§åˆ¶å°è¾“å‡º<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST http://127.0.0.1:3000/students/who-are-you -H &apos;Content-Type: application/json&apos; -d &apos;&#123;&quot;name&quot;: &quot;gdccwxx&quot;&#125;&apos;</span><br></pre></td></tr></table></figure><p></p><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-2/log.png" alt="logger"></p><p>å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ <a href="https://github.com/gdccwxx/nest-test" target="_blank" rel="noopener">github</a> æ‰¾åˆ°ã€‚</p><p>å¤„ç†è¯·æ±‚çš„åŸºæœ¬æ–¹æ³•å°±è®²åˆ°è¿™é‡Œï¼Œ<a href="/nestJs/nest-js-tutorial-3/" title="ä¸‹ä¸€ç¯‡">ä¸‹ä¸€ç¯‡</a>ä¼šè®²è§£å¦‚ä½•è¿æ¥æ•°æ®åº“å¹¶ä½¿ç”¨</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/nestJs/nest-js-tutorial-1/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/nestJs/nest-js-tutorial-1/" itemprop="url">NestJs å…¥é—¨æ•™ç¨‹ä¹‹ä¸€ï¼šåˆæ¬¡ä¸Šæ‰‹</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-09-11T23:45:27+08:00">2021-09-11</time></span></div></header><div class="post-body" itemprop="articleBody"><p>è‡ªä» Node å‡ºä¸–ä»¥æ¥ï¼Œè®¸å¤š Javascript åç«¯æ¡†æ¶éƒ½æ›¾å¤„ä¸ç©·ï¼Œå‰ç«¯å¼€å‘åå°çš„éœ€æ±‚ä¹Ÿé€æ¸åºå¤§ã€‚</p><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-1/nodejs.png" alt="nodejs"></p><p>Node åšåç«¯å·²ç»æˆä¸ºå‰ç«¯çš„é‡è¦ä¸šåŠ¡ï¼Œéšç€å‰ç«¯ä¸šåŠ¡çš„ä¸æ–­æ›´è¿­ï¼ŒNode ä¹Ÿåœ¨å‰ç«¯é¢†åŸŸä¹Ÿé€æ¸ç«™ç¨³è„šè·Ÿï¼Œå¸‚åœºæ‹›è˜éœ€æ±‚é€æ¸æ—ºç››ï¼Œä¼ä¸šéƒ½æŠ¢ç€è¦ã€‚</p><p>å°½ç®¡ Node æ¡†æ¶å·²ç»é€æ¸å®Œå–„ï¼Œä½†æ˜¯çº¯ TS çš„æ¡†æ¶å´ååˆ†ç¨€ç¼ºï¼Œå›½å¤–çš„ NestJs å¡«è¡¥äº†è¿™ä¸€ç©ºç™½ã€‚</p><p>å¯å›½å†…ä½¿ç”¨ NestJs çš„å›¢é˜Ÿå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œè€Œä¸”æ•™ç¨‹ã€æ–‡æ¡£éƒ½è‰¯è ä¸é½ï¼Œå¯¹åˆæ¬¡ä¸Šæ‰‹è€…ååˆ†ä¸å‹å¥½ã€‚æ°å¥½ç¬”è€…æœ‰å¹¸åœ¨å·¥ç¨‹ä¸­ä½¿ç”¨è¿‡ NestJsï¼Œè¸©è¿‡éå¸¸å¤šçš„å‘ã€‚æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦è®²æˆ‘åœ¨å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ¢³ç†æˆæ•™ç¨‹æ–¹å¼ï¼Œå¸Œæœ›å¯¹åˆå­¦è€…æœ‰ç”¨ã€‚</p><p>æ•™ç¨‹ç›®æ ‡æ˜¯ç»è¿‡æ­¤ä¸ªç³»åˆ—æ–‡ç« ï¼Œèƒ½æ­å»ºä¸€å¥— NestJs åœ¨æ—¥å¸¸ç¼–ç è¿‡ç¨‹ä¸­ä¼šç”¨åˆ°çš„åŠŸèƒ½ã€‚</p><p>è€ƒè™‘åˆ° NestJs åŠŸèƒ½æ¯”è¾ƒå¤šï¼Œæœ¬æ•™ç¨‹ä¼šé€‰è¾ƒä¸ºå¸¸ç”¨çš„åŠŸèƒ½ï¼Œåˆ†ä¸ºå››æ¬¡æ¬¡è¿è½½ã€‚</p><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-1/nestjs.png" alt="nestjs"></p><h1 id="ä¸€ã€NestJs-æ˜¯å•¥"><a href="#ä¸€ã€NestJs-æ˜¯å•¥" class="headerlink" title="ä¸€ã€NestJs æ˜¯å•¥"></a>ä¸€ã€NestJs æ˜¯å•¥</h1><p>å­¦ä¹  NestJS ä¹‹å‰ï¼Œå…ˆç®€å•è¯´ä¸€ä¸‹ï¼Œå®ƒåˆ°åº•æ˜¯å•¥ã€‚</p><p>å­—é¢æ„æ€æ¥è®²ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»¥ JS ä»£ç çš„æ–¹å¼è¿è¡Œ JS çš„æ¡†æ¶ã€‚</p><p>ä» <a href="https://nestjs.com/" target="_blank" rel="noopener">NestJs å®˜ç½‘</a> æ¥çœ‹ï¼ŒNestJS æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ä¸€ä¸ª JS æ¡†æ¶ã€‚å®ƒè¿è¡Œæ—¶æ˜¯ <code>JavaScript</code>ï¼Œç¼–ç¨‹æ—¶ä½¿ç”¨<code>TypeScript</code>, æ˜¯ç»“åˆçµæ´»æ€§ã€å¯æ‰©å±•æ€§çš„æ¡†æ¶ã€‚å¹¶ä¸”ç»“åˆäº†é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)ã€å‡½æ•°å¼ç¼–ç¨‹(FP)å’Œå‡½æ•°å“åº”å¼ç¼–ç¨‹(FRP)</p><p>å®ƒçš„ç‰¹æ®Šä¹‹å¤„åœ¨äºï¼Œä»¥å‰ä½¿ç”¨ JS æ–¹å¼å†™åå°ä»£ç ï¼Œç°åœ¨é€šè¿‡å†™ TS, å†ç¼–è¯‘æˆ JS è¿è¡Œã€‚æ—¢åŒ…å«äº† JS çš„çµæ´»æ€§ï¼Œåˆæœ‰ TS çš„çº¦æŸã€‚</p><h1 id="äºŒã€NestJS-çš„ä¼˜åŠ¿"><a href="#äºŒã€NestJS-çš„ä¼˜åŠ¿" class="headerlink" title="äºŒã€NestJS çš„ä¼˜åŠ¿"></a>äºŒã€NestJS çš„ä¼˜åŠ¿</h1><p>NestJS æœ€å¤§çš„ä¼˜åŠ¿ï¼Œæ˜¯ä»–åŸºäº TypeScriptã€‚</p><p>åå°æ¥å£éœ€è¦æ¸…æ™°çš„å…¥å‚å’Œå‡ºå‚ï¼Œéœ€è¦å¯¹å‡½æ•°å’Œæ¥å£å¼ºçº¦æŸï¼Œç»´æŠ¤æ—¶æ‰èƒ½ä¿è¯æ¥å£çš„å¯é æ€§ã€‚</p><p>è€Œä¸”ï¼ŒNestJs çš„æ˜¯åŸºäº Express çš„è¿›è¡Œå¼€å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®Œç¾çš„å¤ç”¨æˆç†Ÿçš„ç”Ÿæ€ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å»å¸‚åœºæ‰¾ç¬¬ä¸‰æ–¹åŒ…ã€‚</p><h1 id="ä¸‰ã€çŸ¥è¯†å‡†å¤‡"><a href="#ä¸‰ã€çŸ¥è¯†å‡†å¤‡" class="headerlink" title="ä¸‰ã€çŸ¥è¯†å‡†å¤‡"></a>ä¸‰ã€çŸ¥è¯†å‡†å¤‡</h1><p>ç”±äº NestJs æ˜¯åŸºäº Node çš„ç¯å¢ƒï¼Œå› æ­¤éœ€è¦å…·å¤‡åŸºç¡€çš„çŸ¥è¯†ã€‚</p><ul><li>HTTP: äº†è§£åŸºæœ¬çš„ Getã€Post è¯·æ±‚</li><li>Nodeï¼šåŸºæœ¬æ˜ç™½æ¥å£è¯·æ±‚ï¼ŒçŸ¥é“æœåŠ¡ä¸æ¥å£å…³ç³»å³å¯</li><li>Typescriptï¼šåŸºæœ¬æ‡‚è¯­æ³•ï¼Œèƒ½å¤§è‡´çŸ¥é“è£…é¥°å™¨å’Œ interface</li></ul><p>æœ€å¥½ä¹‹å‰ç”¨è¿‡ Node ç›¸å…³æœåŠ¡ï¼Œä½¿ç”¨ Node æ­å»ºè¿‡åå°æœåŠ¡ï¼Œä½†è¿™ä¸æ˜¯å¿…è¦çš„ã€‚</p><h1 id="å››ã€å¼€å‘å‡†å¤‡"><a href="#å››ã€å¼€å‘å‡†å¤‡" class="headerlink" title="å››ã€å¼€å‘å‡†å¤‡"></a>å››ã€å¼€å‘å‡†å¤‡</h1><p>1ã€å®‰è£… Node ç¯å¢ƒï¼šè®¿é—® <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener">Node ä¸‹è½½åœ°å€</a>. ä¸‹è½½å®‰è£…åï¼ŒNode &gt;= 10.13.0 å³å¯, å¯é€šè¿‡å‘½ä»¤è¡Œæ£€æŸ¥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure><p>2ã€å®‰è£… NestJS cli</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g @nestjs/cli</span><br></pre></td></tr></table></figure><h1 id="äº”ã€Hello-World"><a href="#äº”ã€Hello-World" class="headerlink" title="äº”ã€Hello World"></a>äº”ã€Hello World</h1><h2 id="åˆ›å»º-nest-test-é¡¹ç›®"><a href="#åˆ›å»º-nest-test-é¡¹ç›®" class="headerlink" title="åˆ›å»º nest-test é¡¹ç›®"></a>åˆ›å»º nest-test é¡¹ç›®</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// step1</span><br><span class="line">nest new nest-test</span><br><span class="line"></span><br><span class="line">// step2 Which package manager would you</span><br><span class="line">é€‰æ‹©: npm</span><br></pre></td></tr></table></figure><h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>è¿™æ ·å°±å¾—åˆ°äº† src/ ç›®å½•ä¸ºè¿™æ ·çš„æ–‡ä»¶åˆ—è¡¨äº†<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">  |- app.controller.spec.ts // controller çš„æµ‹è¯•æ–‡ä»¶</span><br><span class="line">  |- app.controller.ts      // controllerï¼Œè·¯ç”±å’Œé¢„å¤„ç†</span><br><span class="line">  |- app.module.ts          // moduleï¼Œä¸ºæ¨¡å—æ³¨å†Œç”¨</span><br><span class="line">  |- app.service.ts         // service çœŸæ­£çš„é€»è¾‘</span><br><span class="line">  |- main.ts                // ç¨‹åºå…¥å£</span><br></pre></td></tr></table></figure><p></p><p>NestJS ä¹Ÿä¸»å¼ çš„æ˜¯ <a href="https://zh.wikipedia.org/wiki/MVC" target="_blank" rel="noopener">MVC</a> çš„æ ¼å¼ã€‚</p><h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-1/module.png" alt="module"></p><p>module çš„ä½œç”¨æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç»™æ¨¡å—å¤„ç†ä¾èµ–ã€‚å¥½å¤„æ˜¯æ‰€æœ‰æ¨¡å—çš„ä¾èµ–éƒ½å¯ä»¥åœ¨ module ä¸­æ¸…æ™°æ˜äº†çš„çŸ¥é“å¼•ç”¨è¿˜æ˜¯è¢«å¼•ç”¨</p><h2 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h2><p><img src="/img/loading.gif" data-original="/nestJs/nest-js-tutorial-1/controllers.png" alt="controller"></p><p>controller çš„ä½œç”¨æ˜¯å¤„ç†è¯·æ±‚ï¼Œæ‰€æœ‰çš„è¯·æ±‚ä¼šå…ˆåˆ° controllerï¼Œå†ç» controller è°ƒç”¨å…¶ä»–æ¨¡å—ä¸šåŠ¡é€»è¾‘</p><h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><p>æ˜¯çœŸæ­£å¤„ç†ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡é€»è¾‘éƒ½ä¼šåœ¨è¿™é‡Œå¤„ç†ã€‚å®ƒå¯ç»è¿‡ module å¼•ç”¨å…¶ä»–æ¨¡å—çš„serviceï¼Œä¹Ÿå¯ç»è¿‡ module æš´éœ²å‡ºå»ã€‚</p><h2 id="hello-world"><a href="#hello-world" class="headerlink" title="hello-world"></a>hello-world</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// step1: è¿›å…¥ç›®å½•</span><br><span class="line">cd nest-test</span><br><span class="line"></span><br><span class="line">// step2: å®‰è£…ä¾èµ–æˆ–æ›´æ–°ä¾èµ–</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">// step3: è¿è¡Œç¨‹åº</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure><p>æœ€åæµè§ˆå™¨è®¿é—®url</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">è®¿é—®: http://localhost:3000/</span><br><span class="line">// =&gt; Hello World!</span><br></pre></td></tr></table></figure><p>è¯´æ˜ç¨‹åºå·²ç»æˆåŠŸè®¿é—®äº†ï¼</p><h1 id="å…­ã€ç”Ÿæˆæ–°æ¨¡å—"><a href="#å…­ã€ç”Ÿæˆæ–°æ¨¡å—" class="headerlink" title="å…­ã€ç”Ÿæˆæ–°æ¨¡å—"></a>å…­ã€ç”Ÿæˆæ–°æ¨¡å—</h1><h2 id="æ‰§è¡Œå‘½ä»¤"><a href="#æ‰§è¡Œå‘½ä»¤" class="headerlink" title="æ‰§è¡Œå‘½ä»¤"></a>æ‰§è¡Œå‘½ä»¤</h2><p>èƒ½è®¿é—®æ–°æ¨¡å—äº†ï¼Œå†è¿›ä¸€æ­¥æœŸæœ›ç”Ÿæˆæ–‡ä»¶å¤¹å’Œæ–‡ä»¶å¤¹çš„æ¨¡å—ã€‚NestJS cli ä¹Ÿæ”¯æŒç”¨å‘½ä»¤è¡Œå½¢å¼æ¥åˆ›å»ºï¼Œè¿™æ ·å°±ä¸éœ€è¦åšé‡å¤çš„åˆ›å»ºæ–‡ä»¶çš„åŠ¨ä½œäº†ã€‚<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nest g controller students</span><br><span class="line">nest g service students</span><br><span class="line">nest g module students</span><br></pre></td></tr></table></figure><p></p><h2 id="ç›®å½•ç»“æ„-1"><a href="#ç›®å½•ç»“æ„-1" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h2><p>å†å‘½ä»¤è¡Œåˆ†åˆ«æ‰§è¡Œä»¥ä¸Šä¸‰æ¡å‘½ä»¤ï¼Œsrc/ ç›®å½•å˜æˆäº†å¦‚ä¸‹æ ·å­<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">  |- app.controller.spec.ts</span><br><span class="line">  |- app.controller.ts     </span><br><span class="line">  |- app.module.ts         </span><br><span class="line">  |- app.service.ts        </span><br><span class="line">  |- main.ts               </span><br><span class="line">  |- students/</span><br><span class="line">        |- students.controller.spec.ts</span><br><span class="line">        |- students.controller.ts     </span><br><span class="line">        |- students.module.ts         </span><br><span class="line">        |- students.service.spec.ts</span><br><span class="line">        |- students.service.ts</span><br></pre></td></tr></table></figure><p></p><h2 id="ç¼–è¾‘æ–‡ä»¶"><a href="#ç¼–è¾‘æ–‡ä»¶" class="headerlink" title="ç¼–è¾‘æ–‡ä»¶"></a>ç¼–è¾‘æ–‡ä»¶</h2><p>ç¼–è¾‘å¦‚ä¸‹æ–‡ä»¶:<br></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.service.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    ImStudent() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Im student'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// students.controller.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> StudentsService &#123;</span><br><span class="line">    ImStudent() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Im student'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡, åŠ ä¸Š dev å°±èƒ½ç›‘å¬æ–‡ä»¶ä¿®æ”¹äº†ã€‚<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run start:dev</span><br></pre></td></tr></table></figure><p></p><p>æœ€åæµè§ˆå™¨è®¿é—®url</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// âœ…</span><br><span class="line">http://localhost:3000/students/who-are-you</span><br><span class="line">// =&gt; Im student</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ¨¡å—æ·»åŠ å®Œæˆäº†</p><p>å¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œè¯´æ˜ä½ çœŸçš„å¯¹ NestJS å¾ˆæ„Ÿå…´è¶£ã€‚<a href="/nestJs/nest-js-tutorial-2/" title="ä¸‹ç« ">ä¸‹ç« </a>å°†ä¼šå¯¹æ¥å£å†æ·±å…¥ç»†åŒ–ã€‚</p><p>å®Œæ•´ç¤ºä¾‹å¯ä»¥åœ¨ <a href="https://github.com/gdccwxx/nest-test" target="_blank" rel="noopener">github</a> æ‰¾åˆ°</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/éšç¬”/2021-middle-summary/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/éšç¬”/2021-middle-summary/" itemprop="url">ç®—æ˜¯ 2021 çš„å¹´ä¸­æ€»ç»“</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-09-10T23:10:30+08:00">2021-09-10</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©æ˜¯9æœˆå¹³å¸¸çš„å‘¨äº”ï¼Œå¯æ˜¯å¯¹æˆ‘æ¥è¯´æœ‰ä¸€ç‚¹ç‚¹ä¸ä¸€æ ·ï¼Œæ™šä¸Š10ç‚¹ç»ˆäºæŠŠè´Ÿè´£5ä¸ªæœˆçš„é¡¹ç›®å‘å‡ºå»äº†ã€‚é‚£æ˜¯æˆ‘4æœˆä¸­åˆ°ç°åœ¨åšçš„é¡¹ç›®ï¼Œè™½ç„¶å·²ç»å‘äº†å‡ ç‰ˆï¼Œä½†ä»Šå¤©æ˜¯æˆ‘æœ€åä¸€æ¬¡è´Ÿè´£å‘å¸ƒå®ƒã€‚ä¸‹å‘¨å°±è¦å¼€å§‹è´Ÿè´£æ–°çš„é¡¹ç›®äº†ã€‚</p><p>æˆ‘æœ‰äº›ç–²æƒ«çš„åˆ°äº†å®¶é—¨å£ï¼Œä¸‹æ„è¯†æ‹¿å‡ºäº†è£¤å­å£è¢‹çš„é’¥åŒ™ï¼Œç„¶åæ’è¿›äº†é’¥åŒ™å­”ï¼Œç†Ÿç»ƒçš„æ—‹è½¬äº†2åœˆã€‚è¿›é—¨åçœ‹äº†çœ‹æ‰‹è¡¨ï¼Œå·²ç»22:25äº†ï¼Œè¿˜æœ‰5åˆ†é’Ÿå°±è¦ä¸Šå¤–æ•™è¯¾ã€‚ç„¶åæœ‰äº›æ€¥ä¿ƒçš„è·‘åˆ°é˜³å°ï¼Œæ”¶æ‹¾å·²ç»è‰¯å¥½çš„è¡£æœï¼Œå†æŠŠè¡£æœå è¿›è¡£æŸœã€‚</p><p>çœ‹äº†çœ‹æ—¶é—´ï¼Œè¿˜æœ‰3åˆ†é’Ÿã€‚æˆ‘ç«‹é©¬å†²è¿›å•æ‰€æ´—äº†æŠŠè„¸ï¼Œå¸Œæœ›æ¸…é†’ä¸€äº›ï¼Œä¹Ÿå¸Œæœ›ç»™å¤–æ•™ç•™ä¸ªå¥½å°è±¡ã€‚</p><p>è¯¾ç¨‹å¼€å§‹äº†ï¼Œåˆæ˜¯ç†Ÿæ‚‰çš„è‡ªæˆ‘ä»‹ç»ç¯èŠ‚ï¼Œå†å˜˜å¯’é—®æš–äº†ä¸€ç•ªã€‚ä»èŠå¤©ä¸­å¾—çŸ¥å¤–æ•™æ˜¯å—éäººï¼Œæ¯”æˆ‘ä»¬æ™š6ä¸ªå°æ—¶ï¼Œè€Œä¸”åœ¨å—åŠçƒï¼Œç°åœ¨æ˜¯å†¬å¤©ã€‚æˆ‘è¡¨ç¤ºåƒæƒŠï¼Œå¥¹ä¹Ÿçœ‹äº†çœ‹æ—¶é—´ï¼Œå¤¸æˆ‘æœ‰æ¯…åŠ›ã€‚åœ¨ä¸€é¡¿æ¬¢å£°ç¬‘è¯­ä¸­ç»“æŸäº†ã€‚</p><p>æˆ‘æ‹¿ç€æ´—å¥½çš„è¡£æœå’Œæ¯›å·¾ï¼Œè¿›å…¥å•æ‰€çš„é‚£ä¸€åˆ»ï¼Œä¸€å¤©çš„é‡æ‹…ä»¿ä½›æ‰å¸ä¸‹æ¥ï¼Œè¿™æ®µæ—¶é—´çš„é‡æ‹…ä»¿ä½›æ‰å¸ä¸‹æ¥ã€‚</p><h2 id="é¡¹ç›®å’‹æ ·"><a href="#é¡¹ç›®å’‹æ ·" class="headerlink" title="é¡¹ç›®å’‹æ ·"></a>é¡¹ç›®å’‹æ ·</h2><p>è¿™ç®—æ˜¯æˆ‘åœ¨å›¢é˜Ÿè´Ÿè´£æœ€ä¹…çš„é¡¹ç›®ä¹‹ä¸€ï¼Œå†æ—¶5ä¸ªåŠæœˆã€‚è¿™ç®—æ˜¯ä¸€æ¬¡å®Œæ•´ç‰ˆçš„ä¸­å°é¡¹ç›®ï¼Œå®Œå…¨ç”± Typescript æ­å»ºã€‚åŒ…æ‹¬ React åšå‰ç«¯ã€Nest js åšåå°ã€Nginx åšè½¬å‘ã€Docker åšå®¹çš„å®Œæ•´ä¸­å°ï¼Œå‡ ä¹æ‰€æœ‰çš„æ¶æ„ä»£ç éƒ½æ˜¯æˆ‘æ­å»ºçš„ã€‚å®ƒåŒ…æ‹¬ æ•°æ®åº“åšå­˜å‚¨ã€log4js åšæ—¥å¿—ã€æƒé™æ§åˆ¶ã€é…ç½®å‘å¸ƒã€å•å…ƒæµ‹è¯•ç­‰ç­‰ï¼Œå‡ ä¹æ˜¯å®Œæ•´çš„åå°äº†ã€‚å®ƒçš„ä½œç”¨æ˜¯è´Ÿè´£è¿è¥é…ç½®ç›¸å…³ï¼ŒåŒ…æ‹¬å‡çº§ã€å¢é‡å‡çº§ã€é…ç½®ä¸‹å‘ã€é‚®ä»¶æ¨¡ç‰ˆç­‰åŠŸèƒ½ã€‚</p><p>æ­å»ºçš„å†å¥½ï¼Œä¹Ÿéƒ½äº¤ç»™å…¶ä»–åŒå­¦è´Ÿè´£äº†ã€‚äººæ€»æ˜¯è¦æˆé•¿ï¼Œä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆä¹Ÿå¾—åšç‚¹çº¯å‰ç«¯çš„äº‹æƒ…ã€‚ä½†æ˜¯æ€»æœ‰äº›èˆä¸å¾—ã€‚è°å¿å¿ƒæŠŠè‡ªå·±ä¸€æ‰‹æŠšå…»é•¿å¤§çš„ baby ç»™å…¶ä»–äººç…§é¡¾ï¼Ÿæ›´ä½•å†µæ˜¯æˆ‘å¸¦ç€å¥½å‡ ä¸ªåŒå­¦æ‰“é€ å‡ºæ¥çš„â€œæ°ä½œâ€ï¼Ÿï¼ˆè‡³å°‘å¯¹æˆ‘æ¥è¯´æ˜¯æ°ä½œï¼ï¼‰</p><p>ä¸ç®¡å’‹æ ·ï¼Œå¥½å¥½ä¼‘æ¯ä¸€ç•ªï¼Œå†åŠ æ²¹æäº‹å§ï¼</p><h2 id="ç”Ÿæ´»å‘¢"><a href="#ç”Ÿæ´»å‘¢" class="headerlink" title="ç”Ÿæ´»å‘¢"></a>ç”Ÿæ´»å‘¢</h2><p>ç”Ÿæ´»æ˜¯å‘ç”Ÿäº†ç¿»å¤©è¦†åœ°çš„å˜åŒ–ã€‚å’Œæˆ‘å¥èº«çš„å¥½å‹ç›¸ç»§ç¦»å¼€äº†è…¾è®¯ï¼Œä¸€ä¸ªå½’èœ€ï¼Œä¸€ä¸ªæ‹¥æŠ±ç¾ŠåŸäº†ã€‚è¯´å®è¯ï¼Œä»–ä»¬ç¦»å¼€æ·±åœ³æ—¶ï¼Œæˆ‘çœŸçš„æœ‰äº›åŠ¨æ‘‡äº†ã€‚è¦ä¸è¦ç¦»å¼€æ·±åœ³ï¼Œè¦ä¸è¦ç¦»å¼€å…¬å¸ï¼Œæˆäº†æˆ‘å‰ä¸¤ä¸ªæœˆé—®è‡ªå·±æœ€å¤šçš„é—®é¢˜ã€‚å¥½åœ¨æˆ‘ç•™ä¸‹æ¥äº†ï¼Œç”Ÿæ´»ä¹Ÿç»™æˆ‘äº†äº›æƒŠå–œã€‚</p><p><strong>å†æ¬¡ä¸Šé•œï¼ï¼</strong><br>(è´´ä¸¤å¼ å¸…ç…§å˜»å˜». è§†é¢‘å· è…¾è®¯CSIG â€œæˆ‘åœ¨é¹…å‚åšTo Bâ€ ç¬¬5æœŸ)<br><img src="/img/loading.gif" data-original="/éšç¬”/2021-middle-summary/me-with-my-girl.jpg" alt="withMyGirl"><br><img src="/img/loading.gif" data-original="/éšç¬”/2021-middle-summary/me.jpg" alt="me"></p><p>çœ‹åˆ°å¾ˆå¤šäººè¯„è®ºï¼Œå…¶ä¸­æœ‰å¾ˆå¤šå¥½å…„å¼Ÿå¥½æœ‹å‹ä»¬ã€‚å¥½å…„å¼Ÿã€æˆ‘å´‡æ‹œçš„å­¦é•¿ã€æ€»ç›‘ã€é«˜ä¸­è€å¸ˆç­‰ç­‰éƒ½ä¸ºæˆ‘è½¬å‘åŠ æ²¹ï¼Œå†…å¿ƒä¹Ÿååˆ†çš„è‡ªè±ªï¼Œè¢«è®¤å¯çš„æ„Ÿè§‰çœŸå¥½ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä¹Ÿå¼€å§‹å†™ä¸€äº›æ–‡ç« ã€‚è™½ç„¶æ•ˆæœä¸€èˆ¬èˆ¬ï¼Œé˜…è¯»çš„äººä¸å¤šï¼Œä½†æ˜¯æ¯å½“æˆ‘æ¢ç©¶å¤šæ·±å…¥ä¸€æ¬¡ï¼Œæˆ‘æ„Ÿè§‰è‡ªå·±çš„åŸºç¡€çŸ¥è¯†æ›´åŠ ç‰¢å›ºã€‚ä¹Ÿè®©æˆ‘æœ‰æ›´å¤šçš„åŠ¨åŠ›å†™æ–‡ç« äº†ã€‚</p><h2 id="è¯´è¯´å…´è¶£å§"><a href="#è¯´è¯´å…´è¶£å§" class="headerlink" title="è¯´è¯´å…´è¶£å§"></a>è¯´è¯´å…´è¶£å§</h2><p>è‡ªæ‹”ç‰™å‰åï¼Œä½“é‡ä» 142 -&gt; 134 -&gt; 140ã€‚ä»ç˜¦äº†ä¸€åœˆåˆå›æ¥ã€‚æˆ‘çš„å…´è¶£ä¹Ÿç»å†äº†ä¸€æ¬¡è¿‡å±±è½¦ã€‚</p><p>å¾ˆä¹…æ²¡æœ‰æ‰“ç¾½æ¯›çƒçš„æˆ‘ï¼Œå†æ¬¡æ‹¿èµ·äº†ç¾½æ¯›çƒæ‹ï¼›çŸ¥é“å¥½å‹è¦ç¦»å¼€æ—¶ï¼Œç–¯ç‹‚çº¦å¥èº«ã€‚ç„¶åå°±æ˜¯ä¸€ä¸ªå¤šæœˆæ²¡åŠ¨å¼¹ã€‚å› ä¸ºæ‹”ç‰™åï¼Œå•¥ä¹Ÿä¸æƒ³å¹²ï¼Œå•¥ä¹Ÿä¸èƒ½å¹²ã€‚ä¹‹ååˆç–¯ç‹‚åå™¬ï¼Œç€äº†é­”ä¸€æ ·å¥èº«ã€‚</p><p>æœ€è¿‘çš„å…´è¶£çˆ±å¥½æ˜¯çœ‹æºç å’Œçœ‹ä¹¦ã€‚æˆ‘æŠŠnodeéƒ½æ‹‰ä¸‹å‡†å¤‡å¥½å¥½çœ‹çœ‹ï¼Œé¡ºä¾¿ææprï¼›ä¹Ÿè¿·ä¸Šäº†ä¸€æœ¬ä¹¦å«ã€Šæ²‰æ€å½•ã€‹ã€‚</p><p>ç¬¬ä¸€æ¬¡å¬è¯´ æ–¯å¤šè‘›å­¦æ´¾ æ˜¯åœ¨å¾—åˆ°ä¸Šï¼Œæ¯å¤©æ—©ä¸Šéƒ½ä¼šå¬ä¸€èŠ‚è¯¾ã€‚å¬å®Œä¹‹åå‘ç°æ­£æ˜¯æˆ‘ä¸€ç›´è¿½æ±‚çš„å¿ƒæ€ä¸å“è´¨ï¼Œä¸€è¾¹çœ‹ä¹¦ä¸€è¾¹ç»ƒä¹ äº†èµ·æ¥ã€‚çœŸåˆ«è¯´ï¼Œæ•ˆæœç‰¹åˆ«å¥½ï¼Œå› ä¸ºåˆšç»ƒè‚¡ç¥¨å°±é•¿èµ·æ¥äº†å“ˆå“ˆå“ˆã€‚å†…å¿ƒçªƒå–œä¹‹å¤–ï¼Œä¹Ÿå‘Šè¯‰è‡ªå·±é‚£å°±æ¥ç€ç»ƒä¹ å§ã€‚</p><p>å…´è¶£åŸºæœ¬ä¸Šå°±è¿™äº›äº†</p><h2 id="è¯´è¯´æ¥ä¸‹æ¥çš„è§„åˆ’å§"><a href="#è¯´è¯´æ¥ä¸‹æ¥çš„è§„åˆ’å§" class="headerlink" title="è¯´è¯´æ¥ä¸‹æ¥çš„è§„åˆ’å§"></a>è¯´è¯´æ¥ä¸‹æ¥çš„è§„åˆ’å§</h2><p>é¦–å…ˆæ˜¯å‡†å¤‡å¥½å¥½å†™æ–‡ç« ã€‚å¤šæ²‰æ·€æ²‰æ·€è‡ªå·±ï¼Œå­¦ä¹ æ–°æŠ€æœ¯ï¼Œå¸æ”¶å¥½èƒ½åŠ›ã€‚å¸Œæœ›å¹´åº•å‰å†™å®Œ10ç¯‡æ–‡ç« å§</p><p>ç„¶åæ˜¯è‹±è¯­ï¼Œ12æœˆä»½é©¬ä¸Šå°±ä¸€å¹´äº†ã€‚ä¹Ÿç»“æŸäº†å¤–æ•™è¯¾ï¼Œå¸Œæœ›å†æ€»ç»“æ€»ç»“</p><p>å†æ˜¯å¥èº«ï¼Œæ™šé¥­å‰æŠ½æ—¶é—´å¥èº«å§ï¼Œä¿æŒä¿æŒèº«æï¼Œä¸ç„¶èµ°å½¢äº†å˜»å˜»</p><p>æœ€åæ˜¯ç”Ÿæ´»ï¼Œå¸Œæœ›10æœˆä»½å»è¶Ÿä¸œåŒ—ï¼Œå…«å­—çš„ä¸€æ’‡å…ˆä¿ä½å’¯ï¼Œç•¥ç•¥ç•¥ï½</p><p>æœ€åä¹Ÿç¥é˜…è¯»åˆ°è¿™é‡Œçš„ä½ ï¼Œå¿ƒæƒ³äº‹æˆï¼Œä¸‡äº‹å¦‚æ„ï¼</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/typescript/best-practice-of-decorator/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/typescript/best-practice-of-decorator/" itemprop="url">Decorator æœ€ä½³å®è·µ</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-09-05T20:22:01+08:00">2021-09-05</time></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¾ˆå¤šè¯­è¨€å’Œæ–¹æ³•éƒ½æœ‰ AOP ç¼–ç¨‹ã€‚AOP çš„å¥½å¤„æ˜¯åªéœ€è¦å†™ä¸€æ¬¡å‡½æ•°æ£€æŸ¥ï¼Œåœ¨å‡½æ•°è°ƒç”¨å‰åªåšå¼•ç”¨å³å¯ã€‚æå¤§çš„å‡å°‘äº†é‡å¤ä»£ç çš„ç¼–å†™ã€‚</p><p>è¯•æƒ³ä¸€ä¸‹ï¼šåœ¨å‡½æ•°å…¥å‚æ£€æŸ¥ç±»å‹æ—¶éœ€è¦åå¤ç”¨ <code>typeof parameter === &#39;ç±»å‹&#39;</code> æ¥åšæ£€æŸ¥æ—¶ä¸€ä»¶éå¸¸ç—›è‹¦çš„äº‹æƒ…ã€‚è™½ç„¶ç”¨äº† <code>Typescript</code>ï¼Œä½†åªæ˜¯è§£å†³äº†ç¼–ç æ—¶å€™çš„ç±»å‹æ ¡éªŒï¼Œè€Œè¿è¡Œæ—¶çš„æ ¡éªŒä¾æ—§éœ€è¦ç¼–ç æ¥åšæ£€æŸ¥ã€‚</p><p>æœ¬ç¯‡ä»‹ç»çš„ <code>Decorator</code> ç”¨æ³•ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€å›°æ‰°è€Œå‡ºç°çš„ã€‚å®ƒä¸ä»…ä¸€è¡Œä»£ç è§£å†³äº†è¿è¡Œæ—¶çš„å…¥å‚ç±»å‹æ£€æŸ¥ï¼›è¿˜èƒ½ç”¨ä¸€è¡Œä»£ç åšå‡½æ•°æƒé™æ£€æŸ¥ï¼Œåªè®©æœ‰æƒé™çš„äººè°ƒç”¨ï¼›æ›´èƒ½ä¸€è¡Œä»£ç è§£å†³å…¥å‚å’Œç»“æœçš„æ—¥å¿—æ‰“å°ã€‚è®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤çš„åŒæ—¶ï¼Œä¹Ÿæ›´ä¸“æ³¨äºä¸šåŠ¡çš„å®ç°ã€‚</p><p>å¦‚æœæ‚¨å¯¹ä¾‹å­æ„Ÿå…´è¶£ï¼Œå¯ä»¥ç›´æ¥åˆ°<a href="#ä½¿ç”¨ä¸¾ä¾‹">ä½¿ç”¨ä¸¾ä¾‹</a></p><h3 id="å•¥æ˜¯-Decorator"><a href="#å•¥æ˜¯-Decorator" class="headerlink" title="å•¥æ˜¯ Decorator?"></a>å•¥æ˜¯ Decorator?</h3><p>Decorator æ˜¯ ES6 ä¸­çš„ææ¡ˆä¹‹ä¸€ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸ª wrapperï¼Œå¯ä»¥ä¸ºç±»ã€å±æ€§æˆ–å‡½æ•°æä¾›é¢å¤–åŠŸèƒ½ã€‚ä¸¾ä¸ªğŸŒ°ï¼š<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">key: <span class="built_in">string</span></span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"evaluate: "</span>, key);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"call: "</span>, key);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@f</span>(<span class="string">"Class Decorator"</span>)</span><br><span class="line"><span class="keyword">class</span> A &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="meta">@f</span>(<span class="string">"Constructor Parameter"</span>) foo</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@f</span>(<span class="string">"Instance Method"</span>) <span class="comment">// 1</span></span><br><span class="line">  method(<span class="meta">@f</span>(<span class="string">"Instance Method Parameter"</span>) foo) &#123;&#125; <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@f</span>(<span class="string">"Instance Property"</span>)</span><br><span class="line">  prop?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŸºæœ¬ä¸Šï¼Œè£…é¥°å™¨ä¼šçš„è¡Œä¸ºå°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@f</span>()</span><br><span class="line"><span class="keyword">class</span> A</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰åŒäº</span></span><br><span class="line">A = f(A) || A</span><br></pre></td></tr></table></figure><p></p><h2 id="ä½¿ç”¨å‰çš„å‡†å¤‡"><a href="#ä½¿ç”¨å‰çš„å‡†å¤‡" class="headerlink" title="ä½¿ç”¨å‰çš„å‡†å¤‡"></a>ä½¿ç”¨å‰çš„å‡†å¤‡</h2><p>è™½ç„¶ Decorator åªæ˜¯ä¸€ä¸ªææ¡ˆï¼Œä½†å¯é€šè¿‡å·¥å…·æ¥ä½¿ç”¨å®ƒï¼š</p><h3 id="Babel"><a href="#Babel" class="headerlink" title="Babel:"></a>Babel:</h3><blockquote><p>babel-plugin-syntax-decorators<br>babel-plugin-transform-decorators-legacy</p></blockquote><h3 id="Typescript"><a href="#Typescript" class="headerlink" title="Typescript:"></a>Typescript:</h3><p>å‘½ä»¤è¡Œï¼š<br></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --target ES5 --experimentalDecorators</span><br></pre></td></tr></table></figure><p></p><p>tsconfig.json:<br></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"ES5"</span>,</span><br><span class="line">    <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p><img src="/img/loading.gif" data-original="/typescript/best-practice-of-decorator/xmind.png" alt="decorators"></p><h3 id="ç±»è£…é¥°å™¨"><a href="#ç±»è£…é¥°å™¨" class="headerlink" title="ç±»è£…é¥°å™¨"></a>ç±»è£…é¥°å™¨</h3><p>ğŸ“Œ å‚æ•°ï¼š</p><ul><li><code>target</code>: ç±»çš„ <code>æ„é€ å™¨ï¼ˆconstructorï¼‰</code></li></ul><p>â¬…ï¸ è¿”å›å€¼: undefined | æ›¿ä»£åŸæœ‰æ„é€ å™¨</p><p>å› æ­¤ï¼Œç±»è£…é¥°å™¨é€‚åˆç”¨äºç»§æ‰¿ä¸€ä¸ªç°æœ‰ç±»å¹¶æ·»åŠ ä¸€äº›å±æ€§å’Œæ–¹æ³•ã€‚<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rewirteClassConstructor</span>&lt;<span class="title">T</span> <span class="title">extends</span> </span>&#123; <span class="keyword">new</span> (...args: <span class="built_in">any</span>[]): &#123;&#125; &#125;&gt;(<span class="keyword">constructor</span>: T) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="keyword">extends</span> <span class="keyword">constructor</span> &#123;</span><br><span class="line">    words = <span class="string">"rewrite constructor"</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@rewirteClassConstructor</span></span><br><span class="line"><span class="keyword">class</span> Speak &#123;</span><br><span class="line">  words: <span class="built_in">string</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params">t: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">this</span>.words = t;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> say = <span class="keyword">new</span> Speak(<span class="string">"hello world"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(say.words) <span class="comment">// rewrite constructor</span></span><br></pre></td></tr></table></figure><p></p><h3 id="å±æ€§è£…é¥°å™¨"><a href="#å±æ€§è£…é¥°å™¨" class="headerlink" title="å±æ€§è£…é¥°å™¨"></a>å±æ€§è£…é¥°å™¨</h3><p>ğŸ“Œ å‚æ•°:</p><ul><li><code>target</code>: å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å™¨ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´æ˜¯ç±»çš„åŸå‹é“¾</li><li><code>propertyKey</code>: å±æ€§åç§°</li></ul><p>â¬…ï¸ è¿”å›å€¼: è¿”å›çš„ç»“æœå°†è¢«å¿½ç•¥</p><p>é™¤äº†ç”¨äºæ”¶é›†ä¿¡æ¯å¤–ï¼Œå±æ€§è£…é¥°å™¨ä¹Ÿå¯ä»¥ç”¨æ¥ç»™ç±»æ·»åŠ é¢å¤–çš„æ–¹æ³•å’Œå±æ€§ã€‚ ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè£…é¥°å™¨æ¥ç»™æŸäº›å±æ€§æ·»åŠ ç›‘å¬å™¨ã€‚<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"reflect-metadata"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">capitalizeFirstLetter</span>(<span class="params">str: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.charAt(<span class="number">0</span>).toUpperCase() + str.slice(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">observable</span>(<span class="params">target: <span class="built_in">any</span>, key: <span class="built_in">string</span></span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="comment">// prop -&gt; onPropChange</span></span><br><span class="line">  <span class="keyword">const</span> targetKey = <span class="string">"on"</span> + capitalizeFirstLetter(key) + <span class="string">"Change"</span>;</span><br><span class="line"></span><br><span class="line">  target[targetKey] = <span class="function"><span class="keyword">function</span> (<span class="params">fn: (prev: <span class="built_in">any</span>, next: <span class="built_in">any</span>) =&gt; <span class="built_in">void</span></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> prev = <span class="keyword">this</span>[key];</span><br><span class="line">      <span class="comment">// tsconfig.json target to ES6</span></span><br><span class="line">      Reflect.defineProperty(<span class="keyword">this</span>, key, &#123;</span><br><span class="line">        <span class="keyword">set</span>(next) &#123;</span><br><span class="line">          fn(prev, next);</span><br><span class="line">          prev = next;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> C &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  foo = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">  onFooChange(arg0: <span class="function">(<span class="params">prev: <span class="built_in">any</span>, next: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> C();</span><br><span class="line"></span><br><span class="line">c.onFooChange(<span class="function">(<span class="params">prev, next</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`prev: <span class="subst">$&#123;prev&#125;</span>, next: <span class="subst">$&#123;next&#125;</span>`</span>))</span><br><span class="line"></span><br><span class="line">c.foo = <span class="number">100</span>; <span class="comment">// -&gt; prev: -1, next: 100</span></span><br><span class="line">c.foo = <span class="number">-3.14</span>; <span class="comment">// -&gt; prev: 100, next: -3.14</span></span><br></pre></td></tr></table></figure><p></p><h3 id="æ–¹æ³•è£…é¥°å™¨"><a href="#æ–¹æ³•è£…é¥°å™¨" class="headerlink" title="æ–¹æ³•è£…é¥°å™¨"></a>æ–¹æ³•è£…é¥°å™¨</h3><p>ğŸ“Œ å‚æ•°ï¼š</p><ul><li><code>target</code>: å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å™¨ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´æ˜¯ç±»çš„åŸå‹é“¾</li><li><code>propertyKey</code>: å±æ€§åç§°</li><li><code>descriptor</code>: å±æ€§çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor" target="_blank" rel="noopener">æè¿°å™¨</a></li></ul><p>â¬…ï¸ è¿”å›å€¼ï¼šundefined | æ›¿ä»£å±æ€§çš„æè¿°å™¨ã€‚</p><p>æ–¹æ³•è£…é¥°å™¨<code>descriptor</code>çš„keyä¸ºï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">value</span><br><span class="line">writable</span><br><span class="line">enumerable</span><br><span class="line">configurable</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡è¿™ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æ–¹æ³•åŸæœ¬çš„å®ç°ï¼Œæ·»åŠ ä¸€äº›å…±ç”¨é€»è¾‘ã€‚ ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥ç»™ä¸€äº›æ–¹æ³•æ·»åŠ æ‰“å°è¾“å…¥ä¸è¾“å‡ºçš„èƒ½åŠ›:<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params">target: <span class="built_in">any</span>, propertyKey: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> original = descriptor.value;</span><br><span class="line"></span><br><span class="line">  descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'params: '</span>, ...args);</span><br><span class="line">    <span class="keyword">const</span> result = original.call(<span class="keyword">this</span>, ...args);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'result: '</span>, result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> C &#123;</span><br><span class="line">  <span class="meta">@logger</span></span><br><span class="line">  add(x: <span class="built_in">number</span>, y:<span class="built_in">number</span> ) &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> C();</span><br><span class="line">c.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">// -&gt; params: 1, 2</span></span><br><span class="line"><span class="comment">// -&gt; result: 3</span></span><br></pre></td></tr></table></figure><p></p><h3 id="è®¿é—®å™¨è£…é¥°å™¨"><a href="#è®¿é—®å™¨è£…é¥°å™¨" class="headerlink" title="è®¿é—®å™¨è£…é¥°å™¨"></a>è®¿é—®å™¨è£…é¥°å™¨</h3><p>ğŸ“Œ å‚æ•°ï¼š</p><ul><li><code>target</code>: å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å™¨ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´æ˜¯ç±»çš„åŸå‹é“¾</li><li><code>propertyKey</code>: å±æ€§åç§°</li><li><code>descriptor</code>: å±æ€§çš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/getOwnPropertyDescriptor" target="_blank" rel="noopener">æè¿°å™¨</a></li></ul><p>â¬…ï¸ è¿”å›å€¼ï¼šundefined | æ›¿ä»£å±æ€§çš„æè¿°å™¨ã€‚</p><p>è®¿é—®å™¨è£…é¥°å™¨<code>descriptor</code>çš„keyä¸ºï¼š<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get</span><br><span class="line">set</span><br><span class="line">enumerable</span><br><span class="line">configurable</span><br></pre></td></tr></table></figure><p></p><p>è®¿é—®å™¨è£…é¥°å™¨æ€»ä½“ä¸Šè®²å’Œæ–¹æ³•è£…é¥°å™¨å¾ˆæ¥è¿‘ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºæè¿°å™¨ä¸­æœ‰çš„keyä¸åŒä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŸä¸ªå±æ€§è®¾ä¸ºä¸å¯å˜å€¼ï¼š<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">immutable</span>(<span class="params">target: <span class="built_in">any</span>, propertyKey: <span class="built_in">string</span>, descriptor: PropertyDescriptor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> original = descriptor.set;</span><br><span class="line"></span><br><span class="line">  descriptor.set = <span class="function"><span class="keyword">function</span> (<span class="params">value: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> original.call(<span class="keyword">this</span>, &#123; ...value &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> C &#123;</span><br><span class="line">  <span class="keyword">private</span> _point = &#123; x: <span class="number">0</span>, y: <span class="number">0</span> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@immutable</span></span><br><span class="line">  <span class="keyword">set</span> point(value: &#123; x: <span class="built_in">number</span>, y: <span class="built_in">number</span> &#125;) &#123;</span><br><span class="line">    <span class="keyword">this</span>._point = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> point() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>._point;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="keyword">new</span> C();</span><br><span class="line"><span class="keyword">const</span> point = &#123; x: <span class="number">1</span>, y: <span class="number">1</span> &#125;</span><br><span class="line">c.point = point;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(c.point === point)</span><br><span class="line"><span class="comment">// -&gt; false</span></span><br></pre></td></tr></table></figure><p></p><h3 id="å‚æ•°è£…é¥°å™¨"><a href="#å‚æ•°è£…é¥°å™¨" class="headerlink" title="å‚æ•°è£…é¥°å™¨"></a>å‚æ•°è£…é¥°å™¨</h3><p>ğŸ“Œ å‚æ•°ï¼š</p><ul><li><code>target</code>: å¯¹äºé™æ€æˆå‘˜æ¥è¯´æ˜¯ç±»çš„æ„é€ å™¨ï¼Œå¯¹äºå®ä¾‹æˆå‘˜æ¥è¯´æ˜¯ç±»çš„åŸå‹é“¾</li><li><code>propertyKey</code>: å±æ€§çš„åç§°(æ³¨æ„æ˜¯æ–¹æ³•çš„åç§°ï¼Œè€Œä¸æ˜¯å‚æ•°çš„åç§°)</li><li><code>paramerterIndex</code>: å‚æ•°åœ¨æ–¹æ³•ä¸­æ‰€å¤„çš„ä½ç½®çš„ä¸‹æ ‡</li></ul><p>â¬…ï¸ è¿”å›å€¼ï¼šè¿”å›çš„å€¼å°†ä¼šè¢«å¿½ç•¥ã€‚</p><p>å•ç‹¬çš„å‚æ•°è£…é¥°å™¨èƒ½åšçš„äº‹æƒ…å¾ˆæœ‰é™ï¼Œå®ƒä¸€èˆ¬éƒ½è¢«ç”¨äºè®°å½•å¯è¢«å…¶å®ƒè£…é¥°å™¨ä½¿ç”¨çš„ä¿¡æ¯ã€‚<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// parameter.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">"reflect-metadata"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">required</span>(<span class="params">target: <span class="built_in">Object</span>, propertyKey: <span class="built_in">string</span> | symbol, parameterIndex: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> existingRequiredParameters: <span class="built_in">number</span>[] = Reflect.getOwnMetadata(<span class="string">'required'</span>, target, propertyKey) || [];</span><br><span class="line">    existingRequiredParameters.push(parameterIndex);</span><br><span class="line">    Reflect.defineMetadata(<span class="string">'required'</span>, existingRequiredParameters, target, propertyKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params">target: <span class="built_in">any</span>, propertyName: <span class="built_in">string</span>, descriptor: TypedPropertyDescriptor&lt;<span class="built_in">Function</span>&gt;</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> method = descriptor.value!;</span><br><span class="line">   </span><br><span class="line">    descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">let</span> requiredParameters: <span class="built_in">number</span>[] = Reflect.getOwnMetadata(<span class="string">'required'</span>, target, propertyName);</span><br><span class="line">      <span class="keyword">if</span> (requiredParameters) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> parameterIndex of requiredParameters) &#123;</span><br><span class="line">          <span class="keyword">if</span> (parameterIndex &gt;= <span class="built_in">arguments</span>.length || <span class="built_in">arguments</span>[parameterIndex] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Missing required argument."</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> method.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> BugReport &#123;</span><br><span class="line">    <span class="keyword">type</span> = <span class="string">"report"</span>;</span><br><span class="line">    title: <span class="built_in">string</span>;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">t: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">      <span class="keyword">this</span>.title = t;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@validate</span></span><br><span class="line">    print(<span class="meta">@required</span> verbose: <span class="built_in">boolean</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (verbose) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`type: <span class="subst">$&#123;<span class="keyword">this</span>.<span class="keyword">type</span>&#125;</span>\ntitle: <span class="subst">$&#123;<span class="keyword">this</span>.title&#125;</span>`</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.title; </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> report = <span class="keyword">new</span> BugReport(<span class="string">'mode error'</span>);</span><br></pre></td></tr></table></figure><p></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// test.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; report &#125; = <span class="built_in">require</span>(<span class="string">'./paramerter.js'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(report.print()); <span class="comment">// Error: Missing required argument.</span></span><br></pre></td></tr></table></figure><h2 id="æ‰§è¡Œé¡ºåº"><a href="#æ‰§è¡Œé¡ºåº" class="headerlink" title="æ‰§è¡Œé¡ºåº"></a>æ‰§è¡Œé¡ºåº</h2><p>ä¸åŒç±»å‹çš„è£…é¥°å™¨æ‰§è¡Œé¡ºåºæ˜¯æ˜ç¡®çš„ï¼š<br>1ã€ å®ä¾‹æˆå‘˜ï¼šå‚æ•°è£…é¥°å™¨ -&gt; æ–¹æ³•/è®¿é—®å™¨/å±æ€§ è£…é¥°å™¨<br>2ã€ é™æ€æˆå‘˜ï¼šå‚æ•°è£…é¥°å™¨ -&gt; æ–¹æ³•/è®¿é—®å™¨/å±æ€§ è£…é¥°å™¨<br>3ã€ æ„é€ å‡½æ•°ï¼šå‚æ•°è£…é¥°å™¨<br>4ã€ ç±»è£…é¥°å™¨<br>ä¾‹å¦‚ï¼š</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">key: <span class="built_in">string</span></span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"evaluate: "</span>, key);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"call: "</span>, key);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@f</span>(<span class="string">"Class Decorator"</span>)</span><br><span class="line"><span class="keyword">class</span> A &#123;</span><br><span class="line">  <span class="meta">@f</span>(<span class="string">"Static Property"</span>)</span><br><span class="line">  <span class="keyword">static</span> prop?: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@f</span>(<span class="string">"Static Method"</span>)</span><br><span class="line">  <span class="keyword">static</span> method(<span class="meta">@f</span>(<span class="string">"Static Method Parameter"</span>) foo) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="meta">@f</span>(<span class="string">"Constructor Parameter"</span>) foo</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@f</span>(<span class="string">"Instance Method"</span>)</span><br><span class="line">  method(<span class="meta">@f</span>(<span class="string">"Instance Method Parameter"</span>) foo) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@f</span>(<span class="string">"Instance Property"</span>)</span><br><span class="line">  prop?: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œé¡ºåº</span></span><br><span class="line">evaluate:  Instance Method</span><br><span class="line">evaluate:  Instance Method Parameter</span><br><span class="line">call:  Instance Method Parameter</span><br><span class="line">call:  Instance Method</span><br><span class="line">evaluate:  Instance Property</span><br><span class="line">call:  Instance Property</span><br><span class="line">evaluate:  Static Property</span><br><span class="line">call:  Static Property</span><br><span class="line">evaluate:  Static Method</span><br><span class="line">evaluate:  Static Method Parameter</span><br><span class="line">call:  Static Method Parameter</span><br><span class="line">call:  Static Method</span><br><span class="line">evaluate:  Class Decorator</span><br><span class="line">evaluate:  Constructor Parameter</span><br><span class="line">call:  Constructor Parameter</span><br><span class="line">call:  Class Decorator</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œåœ¨åŒä¸€æ–¹æ³•ä¸­çš„ä¸åŒå‚æ•°æ„é€ å™¨é¡ºåºæ˜¯ç›¸åçš„ï¼Œæœ€åå‚æ•°å›çš„è£…é¥°å™¨ä¼šå…ˆè¢«æ‰§è¡Œï¼š<br></p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params">key: <span class="built_in">string</span></span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"evaluate: "</span>, key);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"call: "</span>, key);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> B &#123;</span><br><span class="line">  <span class="meta">@f</span>(<span class="string">'first'</span>)</span><br><span class="line">  <span class="meta">@f</span>(<span class="string">'second'</span>)</span><br><span class="line">  method() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œé¡ºåº</span></span><br><span class="line">evaluate:  first</span><br><span class="line">evaluate:  second</span><br><span class="line">call:  second</span><br><span class="line">call:  first</span><br></pre></td></tr></table></figure><p></p><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><ul><li>Before/Afteré’©å­ã€‚</li><li>ç›‘å¬å±æ€§æ”¹å˜æˆ–è€…æ–¹æ³•è°ƒç”¨ã€‚</li><li>å¯¹æ–¹æ³•çš„å‚æ•°åšè½¬æ¢ã€‚</li><li>æ·»åŠ é¢å¤–çš„æ–¹æ³•å’Œå±æ€§ã€‚</li><li>è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ã€‚</li><li>è‡ªåŠ¨ç¼–è§£ç ã€‚</li><li>ä¾èµ–æ³¨å…¥ã€‚</li></ul><h3 id="ä½¿ç”¨ä¸¾ä¾‹"><a href="#ä½¿ç”¨ä¸¾ä¾‹" class="headerlink" title="ä½¿ç”¨ä¸¾ä¾‹"></a>ä½¿ç”¨ä¸¾ä¾‹</h3><ul><li><p>æ—¥å¿—æ‰“å°</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>): <span class="title">any</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target, key, descriptor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> method = descriptor.value;</span><br><span class="line">    descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'param: '</span>, <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>));</span><br><span class="line">      <span class="keyword">const</span> value = method.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'result: '</span>, value);</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> B &#123;</span><br><span class="line">  <span class="meta">@f</span>()</span><br><span class="line">  say(name: <span class="built_in">string</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`name is <span class="subst">$&#123;name&#125;</span>`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é‰´æƒ:</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auth</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">target, key, descriptor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> originalMethod = descriptor.value; <span class="comment">// ä¿ç•™åŸæœ‰å‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (!user.isAuth) &#123;</span><br><span class="line">      descriptor.value = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// æœªç™»å½•å°†è¿”å›æç¤º</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'å½“å‰æœªç™»å½•ï¼Œè¯·ç™»å½•!'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123; <span class="comment">// å·²ç™»å½•å°†åŸæœ‰å‡½æ•°</span></span><br><span class="line">        originalMethod.apply(<span class="keyword">this</span>, args);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> descriptor;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@auth</span>(app.user)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleStar</span>(<span class="params"><span class="keyword">new</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">new</span>.like++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç±»å‹æ£€æŸ¥</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"reflect-metadata"</span>;</span><br><span class="line"><span class="keyword">const</span> stringMetaDataTag = <span class="string">"IsString"</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsString</span>(<span class="params">target: <span class="built_in">Object</span>, propertyKey: <span class="built_in">string</span> | symbol, parameterIndex: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> existingRequiredParameters: <span class="built_in">number</span>[] = Reflect.getOwnMetadata(stringMetaDataTag, target, propertyKey) || [];</span><br><span class="line">  existingRequiredParameters.push(parameterIndex);</span><br><span class="line">  Reflect.defineMetadata( stringMetaDataTag, existingRequiredParameters, target, propertyKey);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params">target: <span class="built_in">any</span>, propertyName: <span class="built_in">string</span>, descriptor: TypedPropertyDescriptor&lt;<span class="built_in">Function</span>&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> method = descriptor.value!;</span><br><span class="line"> </span><br><span class="line">  descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> stringMetaTags: <span class="built_in">number</span>[] = Reflect.getOwnMetadata(stringMetaDataTag, target, propertyName);</span><br><span class="line">    <span class="keyword">if</span> (stringMetaTags) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> parameterIndex of stringMetaTags) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = <span class="built_in">arguments</span>[parameterIndex];</span><br><span class="line">        <span class="keyword">if</span> (!(value <span class="keyword">instanceof</span> <span class="built_in">String</span> || <span class="keyword">typeof</span> value === <span class="string">'string'</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'not string'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> method.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> A &#123;</span><br><span class="line">    a: <span class="built_in">string</span> = <span class="string">'123'</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@validate</span></span><br><span class="line">    value (<span class="meta">@IsString</span> value: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(value);</span><br><span class="line">        <span class="keyword">this</span>.a = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>ç¬”è€…åœ¨ åå°æ¥å£ã€Js Bridgeã€React é¡¹ç›®ä¸Šéƒ½æœ‰å®è·µè¿‡ã€‚ä¸å¾—ä¸è¯´ï¼Œè£…é¥°å™¨æ¨¡å¼åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹(AOP)å‡ ä¹æ˜¯ â€œæœ€ä½³å®è·µâ€ï¼Œæå¤§çš„æå‡äº†ç¼–ç¨‹æ•ˆç‡ã€‚ä¹Ÿå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©åˆ°ä½ ğŸ˜Š</p><h3 id="npm-åŒ…"><a href="#npm-åŒ…" class="headerlink" title="npm åŒ…"></a>npm åŒ…</h3><p><a href="https://github.com/typestack/class-validator" target="_blank" rel="noopener">class-validator</a><br><a href="https://github.com/jayphelps/core-decorators" target="_blank" rel="noopener">core-decorators</a><br><a href="https://github.com/nestjs/nest" target="_blank" rel="noopener">Nest åå°æ¡†æ¶</a></p><h3 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><p><a href="https://github.com/tc39/proposal-decorators" target="_blank" rel="noopener">tc39-proposal</a><br><a href="https://www.typescriptlang.org/docs/handbook/decorators.html" target="_blank" rel="noopener">typescript</a><br><a href="https://saul-mirone.github.io/a-complete-guide-to-typescript-decorator/" target="_blank" rel="noopener">a-complete-guide-to-typescript-decorator</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/éœ€æ±‚å¼€å‘/the-skills-of-develop/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/éœ€æ±‚å¼€å‘/the-skills-of-develop/" itemprop="url">åšéœ€æ±‚ææ˜ç™½è¿™å‡ ç‚¹ï¼Œå’ŒåŠ ç­è¯´å†è§</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-08-23T13:39:15+08:00">2021-08-23</time></span></div></header><div class="post-body" itemprop="articleBody"><p><img src="/img/loading.gif" data-original="/éœ€æ±‚å¼€å‘/the-skills-of-develop/xmind.png" alt="xmind"></p><h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>ä½ æ˜¯ä¸æ˜¯æ¥éœ€æ±‚åæ‰‹è¶³æ— æªï¼Ÿæ˜¯ä¸æ˜¯å¤©å¤©å¿™ç¢Œï¼Œä½†åˆæ•ˆç‡ä¸é«˜ï¼Ÿæ˜¯ä¸æ˜¯éœ€æ±‚æ²Ÿé€šå‰åä¸ä¸€è‡´ï¼Œå¯¼è‡´é‡å¤ä¿®æ”¹ï¼Ÿå‡ å¹´å‰åˆšè¸å…¥èŒåœºç”Ÿæ´»çš„æˆ‘ï¼Œå¯¹æ­¤æ·±æœ‰ä½“ä¼šã€‚ç»è¿‡æ²‰æ·€ï¼Œç»ˆäºææ˜ç™½æ€ä¹ˆé«˜æ•ˆå¼€å‘ï¼Œé«˜æ•ˆä¼šè®®ï¼Œæ€»ç»“è¿™å‡ ç‚¹ç»éªŒï¼šå’Œäº§å“åšæœ‹å‹ã€éœ€æ±‚å¯¹é½å’Œæ’æœŸã€éœ€æ±‚æ–¹æ¡ˆè®¾è®¡ä¸å‘å¸ƒä¸Šçº¿ã€äº‹æ•…ä¸å¤ç›˜ã€‚ä»æ­¤é«˜æ•ˆå·¥ä½œï¼Œæ—©æ—©ä¸‹ç­ã€‚</p><h2 id="æ ‘ç«‹æ­£ç¡®çš„è§‚ç‚¹"><a href="#æ ‘ç«‹æ­£ç¡®çš„è§‚ç‚¹" class="headerlink" title="æ ‘ç«‹æ­£ç¡®çš„è§‚ç‚¹"></a>æ ‘ç«‹æ­£ç¡®çš„è§‚ç‚¹</h2><p>é˜…è¯»ä¹‹å‰ï¼Œä¸å¦¨é—®é—®è‡ªå·±ï¼Œå·¥ä½œçš„ç›®çš„æ˜¯å•¥ï¼Ÿ<br>ä¹Ÿè®¸æ¯ä¸ªäººæœ‰ä¸åŒçš„è§‚ç‚¹ã€‚æœ‰äººè§‰å¾—äº‹æƒ…æ°¸è¿œéƒ½å¹²ä¸å®Œï¼Œä¸å¦‚æ…¢æ…¢åšï¼Œè‡ªå·±ä¹Ÿæ›´è½»æ¾ã€‚ä½†æœ‰ç§é«˜çº§çš„æ€ç»´æ–¹å¼æ˜¯ï¼šå°½è‡ªå·±åŠªåŠ›åšå¥½æ¯ä»¶äº‹æƒ…ã€‚å› ä¸ºåªæœ‰å¥½å¥½å¯¹å·¥ä½œï¼Œå‡èŒåŠ è–ªæ‰ä¼šå¥½å¥½å¯¹ä½ ï¼›åªæœ‰å¯¹å·¥ä½œè¡¨ç°å‡ºçƒ­æƒ…ï¼Œè€æ¿æ‰ä¼šå¯¹ä½ æœ‰ä¿¡å¿ƒï¼Œæ‰æ›´å¯èƒ½åœ¨èŒåœºæ¿€çƒˆçš„ç«äº‰ä¸­è„±é¢–è€Œå‡ºã€‚</p><h2 id="å’Œäº§å“åšæœ‹å‹"><a href="#å’Œäº§å“åšæœ‹å‹" class="headerlink" title="å’Œäº§å“åšæœ‹å‹"></a>å’Œäº§å“åšæœ‹å‹</h2><p>äº§å“æ˜¯ä¸€ç¾¤æœ‰æƒ³è±¡åŠ›ï¼Œèƒ½æŠŠæŠ½è±¡çš„äº‹æƒ…å…·ä½“åŒ–çš„äººã€‚ä»–ä»¬ä¸ä»…æœ‰è®¸å¤šæ–°é¢–çš„ç‚¹å­ï¼Œè¿˜èƒ½è¿…é€Ÿçš„ get åˆ°ä½ è¯´çš„æƒ³æ³•ã€‚å’Œäº§å“åŒå­¦åšæœ‹å‹ä¸ä»…èƒ½æ›´åŠ é¡ºåˆ©çš„åˆä½œï¼Œè¿˜èƒ½å¼€æ‹“è§†é‡ï¼Œå¢é•¿è§è¯†ã€‚æ¯”å¦‚å’Œäº§å“ä¸€èµ·åç”µæ¢¯ï¼Œä»–ä»¬å¯èƒ½ä¼šæƒ³ä¸ºä»€ä¹ˆè¦è£…é•œå­ï¼Œè€Œä½ ä¼šæƒ³ç”µæ¢¯ç³»ç»Ÿæ˜¯æ€ä¹ˆå®ç°çš„ã€‚åœ¨ä¸åŒè§’åº¦çœ‹åŒä¸€ä»¶äº‹æƒ…ä¸ä»…ååˆ†æœ‰è¶£ï¼Œè¿˜èƒ½æ‰©å±•æ›´å¤šå¯èƒ½ï¼Œä¸å¦¨è¯•è¯•çœ‹ã€‚</p><h3 id="ç¬¬ä¸€æ‰‹éœ€æ±‚"><a href="#ç¬¬ä¸€æ‰‹éœ€æ±‚" class="headerlink" title="ç¬¬ä¸€æ‰‹éœ€æ±‚"></a>ç¬¬ä¸€æ‰‹éœ€æ±‚</h3><p>å’Œäº§å“åšæœ‹å‹ï¼Œèƒ½æ¯”åˆ«äººæ›´å¿«çš„æ‹¿åˆ°ç¬¬ä¸€æ‰‹éœ€æ±‚ã€‚<br>äº§å“çš„éœ€æ±‚å¹¶ä¸æ˜¯å‡­ç©ºè€Œæ¥ï¼Œå®ƒå¯èƒ½æ˜¯ä»ç«å“ã€å®¢æˆ·éœ€æˆ–è€æ¿æå‡ºçš„ï¼Œäº§å“å¾€å¾€æ˜¯æŠŠéœ€æ±‚å…·ä½“åŒ–çš„äººã€‚ä»–ä»¬æ›´å¤šçš„å…³æ³¨æ˜¯éœ€æ±‚æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ä»¥åŠè”åŠ¨çš„åŠŸèƒ½å’Œå¼‚å¸¸åœºæ™¯ã€‚è€Œå¼€å‘åˆ™ä¼šæŠŠå…·ä½“çš„éœ€æ±‚é€šè¿‡ç¼–ç å®ç°ã€‚<br>å½“ç„¶ï¼Œæ­£å› ä¸ºäº§å“çš„è§’åº¦æ›´å¤šçš„æ˜¯æ€ä¹ˆå®ç°éœ€æ±‚ï¼Œä¹Ÿæ›´å®¹æ˜“è¿‡äºå…³æ³¨éœ€æ±‚å®ç°ï¼Œè€ŒæŠŠåŸæœ¬ç”¨æˆ·è¯‰æ±‚æ— é™æ”¾å¤§ï¼Œå¿½ç•¥äº†éœ€æ±‚æœ¬èº«ã€‚<br>å¼€å‘æ‹¿åˆ°ç¬¬ä¸€æ‰‹éœ€æ±‚æœ€å¥½çš„æ–¹å¼æ˜¯å¦‚ä½•å®ç°éœ€æ±‚å‡ºå‘ï¼Œå¯ä»¥é€šè¿‡å“ªäº›æ–¹å¼æ¥è§£å†³ã€‚ä¹Ÿè®¸éœ€æ±‚å¯ä»¥ä¸ç”¨å¼€å‘ï¼Œåªéœ€æ¢ä¸ªè§’åº¦çœ‹é—®é¢˜å°±èƒ½è½»æ¾è§£å†³ã€‚</p><p>æ ¸å¿ƒæ€æƒ³: why</p><h2 id="éœ€æ±‚å¯¹é½å’Œæ’æœŸ"><a href="#éœ€æ±‚å¯¹é½å’Œæ’æœŸ" class="headerlink" title="éœ€æ±‚å¯¹é½å’Œæ’æœŸ"></a>éœ€æ±‚å¯¹é½å’Œæ’æœŸ</h2><h3 id="éœ€æ±‚å®£è®²"><a href="#éœ€æ±‚å®£è®²" class="headerlink" title="éœ€æ±‚å®£è®²"></a>éœ€æ±‚å®£è®²</h3><p><img src="/img/loading.gif" data-original="/éœ€æ±‚å¼€å‘/the-skills-of-develop/discuss.png" alt="discuss"><br>éœ€æ±‚å®£è®²æ˜¯äº§å“ä¸å¼€å‘ã€æµ‹è¯•æŠŠæ–¹æ¡ˆå†…å®¹è¾“å‡ºçš„ä¸»è¦é€”å¾„ã€‚ä¸€ä»½éœ€æ±‚çš„å®£è®²è¿‡ç¨‹ï¼Œå¤§è‡´å¯åˆ†ä¸ºéœ€æ±‚å®£è®²å‰ã€éœ€æ±‚å®£è®²ä¸­ã€éœ€æ±‚å®£è®²åã€‚éµå¾ªä¸€å¥—æµç¨‹èƒ½æœ‰æ•ˆé¿å…è¸©å‘å’Œé«˜æ•ˆç‡ä¼šè®®ã€‚</p><h4 id="éœ€æ±‚å®£è®²å‰ï¼š"><a href="#éœ€æ±‚å®£è®²å‰ï¼š" class="headerlink" title="éœ€æ±‚å®£è®²å‰ï¼š"></a>éœ€æ±‚å®£è®²å‰ï¼š</h4><p>äºšé©¬é€Šçš„é«˜ç®¡ä¼šè®®ï¼Œä¼šåœ¨å¼€ä¼šå‰åŠå°æ—¶é˜…è¯»ä¼šè®®å†…å®¹ï¼Œå†æ ¹æ®æ¢³ç†çš„ç–‘é—®è¿›è¡Œè®¨è®ºã€‚<br>é˜…è¯»éœ€æ±‚æ–‡æ¡£æ˜¯å¿…ä¸å¯å°‘çš„è¿‡ç¨‹ã€‚æœ‰æ•ˆçš„é˜…è¯»æ–‡æ¡£ï¼Œèƒ½åœ¨éœ€æ±‚å®£è®²æ—¶æ›´èƒ½æå‡ºè‡ªå·±çš„ç–‘é—®ä¸è§‚ç‚¹ï¼Œèƒ½é¿å…å‰æœŸå› ä¸ºå‡†å¤‡ä¸è¶³ï¼Œå¯¼è‡´çš„ä¼šè®®æ•ˆç‡ä½ä¸‹ã€‚è¿™æ ·çš„é«˜æ•ˆå·¥ä½œæ–¹å¼æ›´å€¼å¾—ä½œä¸ºæ‰“å·¥äººçš„æˆ‘ä»¬å€Ÿé‰´ã€‚éœ€æ±‚å®£è®²å‰å¯ä»¥ä»ï¼š</p><ul><li>çœ‹éœ€æ±‚ï¼šäº†è§£éœ€æ±‚çš„èƒŒæ™¯ï¼Œå’Œç±»ä¼¼åœºæ™¯å…¶ä»–äº§å“æ€ä¹ˆå®ç°çš„</li><li>æç–‘é—®ï¼šèåˆ Whyã€Howã€What å»æ€è€ƒ</li><li>ç»™æ–¹æ¡ˆï¼šå¯¹ç°æœ‰çš„æŠ€æœ¯ç»™éœ€æ±‚çš„æ–¹æ¡ˆ</li><li>ç»™æ’æœŸï¼šç»™å‡ºå¤§æ¦‚çš„æ’æœŸï¼Œä»¥ äºº/å¤© ä¸ºå•ä½è¿›è¡Œä¼°ç®—</li></ul><h4 id="éœ€æ±‚å®£è®²ä¸­ï¼š"><a href="#éœ€æ±‚å®£è®²ä¸­ï¼š" class="headerlink" title="éœ€æ±‚å®£è®²ä¸­ï¼š"></a>éœ€æ±‚å®£è®²ä¸­ï¼š</h4><p>éœ€æ±‚å®£è®²ä¸­ä¸»è¦æ˜¯å¯¹é½æ–¹æ¡ˆï¼Œè§£å†³ç–‘æƒ‘ã€‚ä½œä¸ºå¼€å‘è€…æœŸæœ›çš„æ˜¯å¯¹æ‰€æœ‰å¼‚å¸¸åœºæ™¯ä¸æ–¹æ¡ˆæœ‰å¤§æ¦‚çš„äº†è§£ï¼Œä¸”é«˜æ•ˆä¼šè®®ï¼Œä¸€æ¬¡é€šè¿‡ã€‚éœ€æ±‚å®£è®²ä¸­å›´ç»•ï¼š</p><ul><li>æå‡ºç–‘é—®ï¼šæå‡ºä¼šå‰å‡†å¤‡çš„ç–‘é—®ï¼Œå¹¶å‘æ•£å‡ºæ–°çš„ç–‘é—®</li><li>ç¡®è®¤éœ€æ±‚ï¼šå’Œäº§å“ã€æµ‹è¯•æ–¹æ²Ÿé€šå¯¹é½è¡¨ç°å’Œå¼‚å¸¸åœºæ™¯ï¼Œæœ€å¥½æœ‰å½•å±ä½œä¸ºè¯æ®</li><li>ä¸€æ¬¡é€šè¿‡ï¼šæœ‰ä¸ç¡®å®šçš„ç‚¹ä¼šä¸­ç«‹é©¬æ‹‰ä¸Šç›¸å…³åŒå­¦å¯¹é½ï¼Œäº‰å–ä¸€æ¬¡æ€§é€šè¿‡ä¼šè®®ï¼Œä¸å¼€ç¬¬äºŒæ¬¡</li><li>ç¡®è®¤ deadline: ä¸ä¼°ç®—çš„ äºº/å¤© è¿›è¡ŒåŒ¹é…ï¼Œæœ‰ç–‘é—®å¯å‘è´Ÿè´£äººæå‡º</li></ul><h4 id="éœ€æ±‚å®£è®²åï¼š"><a href="#éœ€æ±‚å®£è®²åï¼š" class="headerlink" title="éœ€æ±‚å®£è®²åï¼š"></a>éœ€æ±‚å®£è®²åï¼š</h4><p>ä¼šè®®åé€šå¸¸éœ€è¦ç»“è®ºçš„æ²‰æ·€ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯åœ¨ä¸è®°å¾—éœ€æ±‚ç»†èŠ‚æ—¶å¯ä»¥ç¿»çœ‹å­˜æ¡£æ¥ç¡®è®¤ç»†èŠ‚ã€é˜²æ­¢äº§å“ç”©é”…ç­‰ã€‚å®£è®²å†…å®¹æ²‰æ·€çš„æ–¹å¼ï¼š</p><ul><li>å½•åƒå›æ”¾ï¼šæœ‰é—®é¢˜å¯å°†å½•åƒå›æ”¾ï¼Œæ‰¾åˆ°è®¨è®ºçš„åœ°æ–¹</li><li>ä¼šè®®çºªè¦ï¼šå°†æœ¬æ¬¡çš„ç»“è®ºã€éœ€è¦è·Ÿè¿›çš„ç‚¹å†™ä¸‹æ¥ï¼Œå‘ç¾¤é‡Œï¼Œå¹¶è‰¾ç‰¹ç›¸å…³åŒå­¦</li></ul><p>ä¼šè®®çºªè¦å¸¸ç”¨æ¨¡ç‰ˆï¼š<br>ç»è¿‡ä¸äº§å“æ–¹ã€xxæ–¹çš„æ²Ÿé€šï¼Œæœ‰ä»¥ä¸‹ç»“è®ºä¸è·Ÿè¿›äº‹é¡¹ï¼š<br>ç»“è®ºï¼š<br>1ã€xxx<br>è·Ÿè¿›äº‹é¡¹ï¼š<br>1ã€ xxxx @xxxx åŒå­¦<br>è¾›è‹¦ @xxxx å…³æ³¨å¹¶ç¡®è®¤</p><p>æ ¸å¿ƒæ€æƒ³: How</p><h3 id="ç›®æ ‡æ‹†è§£ä¸ç”˜ç‰¹å›¾"><a href="#ç›®æ ‡æ‹†è§£ä¸ç”˜ç‰¹å›¾" class="headerlink" title="ç›®æ ‡æ‹†è§£ä¸ç”˜ç‰¹å›¾"></a>ç›®æ ‡æ‹†è§£ä¸ç”˜ç‰¹å›¾</h3><p>æœ‰äº†å…·ä½“çš„éœ€æ±‚åï¼Œå°±æ¥åˆ°äº†æ’æœŸç¼“è§£ã€‚äº§å“åŒå­¦å¸Œæœ›è¶Šå¿«è¶Šå¥½ï¼Œè€Œ PMï¼ˆProject Managerï¼‰ ä¼šæ ¹æ®ç‰ˆæœ¬çš„æ—¶é—´ç‚¹æ’æœŸã€‚ä¹Ÿæ­£å› ä¸ºäºŒè€…çš„ç›®æ ‡ä¸åŒï¼Œä¼šå­˜åœ¨ PM çš„æ’æœŸä¸äº§å“æœŸæœ›æ—¶é—´å¹¶ä¸æ˜¯ç›¸åŒæ—¶é—´ç‚¹ã€‚ä¸ºäº†ä¿è¯éœ€æ±‚ä¸å› ä¸ºè‡ªå·± delayï¼Œåˆç†çš„äººåŠ›ä¼°ç®—å’Œç›®æ ‡æ‹†è§£å˜å¾—å¿…ä¸å¯å°‘ã€‚</p><h4 id="ç›®æ ‡æ‹†è§£"><a href="#ç›®æ ‡æ‹†è§£" class="headerlink" title="ç›®æ ‡æ‹†è§£"></a>ç›®æ ‡æ‹†è§£</h4><p>å¥½çš„ç›®æ ‡æ‹†è§£é€šå¸¸ä¼šä»¥å¤§ç›®æ ‡å’Œå°ç›®æ ‡æ¥è¿›è¡Œæ‹†åˆ†ã€‚å¤§ç›®æ ‡åŒ…æ‹¬éœ€æ±‚è¯„å®¡æ—¶é—´ã€å¼€å‘æ—¶é—´ã€è”è°ƒæ—¶é—´ã€æµ‹è¯•æ—¶é—´ã€code review æ—¶é—´ã€å‘å¸ƒæ—¶é—´ï¼Œä»¥æ—¶é—´èŠ‚ç‚¹ä¸ºé¢—ç²’ï¼›å°ç›®æ ‡åŒ…æ‹¬å¼€å‘è¿›åº¦ã€è”è°ƒè¿›åº¦ï¼Œä»¥æ¯å¤©çš„äº‹ä»¶ä¸ºé¢—ç²’ã€‚<br>è¯„ä¼°åšä¸å®Œéœ€æ±‚è¯¥æ€ä¹ˆåŠï¼Ÿ</p><ul><li>éœ€æ±‚ä¸Šï¼šè¿­ä»£å¤„ç†ï¼Œåˆ†æˆæœ¬æœŸå¿…ä¿ã€æœ¬æœŸå†²åˆºã€æœ¬æœŸä¸åšçš„å‡ ç§ç±»å‹</li><li>äººåŠ›ä¸Šï¼šè¯„ä¼°åŠ äººèƒ½å¦è§£å†³</li><li>æ—¶é—´ä¸Šï¼šdeadline delay è¿˜æ˜¯éœ€æ±‚ delay</li></ul><h4 id="éœ€æ±‚æ‹†åˆ†çš„å°-tips"><a href="#éœ€æ±‚æ‹†åˆ†çš„å°-tips" class="headerlink" title="éœ€æ±‚æ‹†åˆ†çš„å° tips"></a>éœ€æ±‚æ‹†åˆ†çš„å° tips</h4><p>å°†å¼€å‘ã€è”è°ƒäº‹ä»¶æ‹†è§£ï¼Œç»†åˆ†åˆ°æ¯å‘¨ã€æ¯å¤©çš„å·¥ä½œã€‚è®©æ¯å¤©çš„è¿›åº¦å¯æ§ï¼ŒæŒ‰æ—¶å®Œæˆå·¥ä½œï¼ŒæŒ‰æ—¶å›å®¶ã€‚å‡ºç°è¿›åº¦ä¸å¯æ§åˆ™å‘¨æœ«é€‚å½“è°ƒæ•´ä¸‹ã€‚<br>å¯¹ç›®æ ‡æ‹†è§£åˆ°å…·ä½“å†…å®¹ï¼š</p><ul><li>éœ€æ±‚ deadline å€’æ¨å‡ºéœ€æ±‚å¼€å‘å®Œæˆã€ææµ‹ã€å‘å¸ƒæ—¶é—´ç‚¹</li><li>æ ¹æ®æ—¶é—´ç‚¹å®šå…·ä½“å¼€å‘å†…å®¹ï¼Œæ¯å‘¨ç›®æ ‡ã€æ¯æ—¥ç›®æ ‡</li></ul><p>å°ç›®æ ‡æ‹†è§£åï¼Œç”˜ç‰¹å›¾å°±æ›´èƒ½æ˜¾ç¤ºå·¥ä½œå†…å®¹å’Œè¿›åº¦äº†ã€‚</p><h3 id="ç”˜ç‰¹å›¾"><a href="#ç”˜ç‰¹å›¾" class="headerlink" title="ç”˜ç‰¹å›¾"></a>ç”˜ç‰¹å›¾</h3><p><img src="/img/loading.gif" data-original="/éœ€æ±‚å¼€å‘/the-skills-of-develop/gantt-chart.png" alt="gantt-chart"></p><p>ç”˜ç‰¹å›¾èƒ½æ¸…æ™°çš„çŸ¥é“å·¥ä½œè¿›åº¦ã€‚ä¸ªäººä½¿ç”¨ç”˜ç‰¹å›¾èƒ½æ¸…æ™°çš„å®šå¥½æ¯å¤©çš„ç›®æ ‡ï¼Œé«˜æ•ˆå·¥ä½œï¼›å¤šäººåˆä½œä½¿ç”¨ç”˜ç‰¹å›¾èƒ½åˆ’åˆ†æ¯ä¸ªäººçš„å·¥ä½œå†…å®¹ä»¥åŠè¿›åº¦åŒæ­¥ã€‚<br>ä½¿ç”¨ç”˜ç‰¹å›¾çš„å¥½å¤„å¾ˆå¤šï¼Œå®ƒä¸ä»…èƒ½ç›´è§‚ã€å®šé‡çš„çœ‹åˆ°è¿›åº¦ï¼Œè¿˜èƒ½çŸ¥é“é¢„æœŸç›®æ ‡å’Œå®é™…äº§å‡ºçš„å·®å€¼ï¼Œèƒ½æœ‰æ•ˆçŸ¥é“è¿›åº¦å¿«ã€æ…¢çš„åŸå› ã€‚æ›´é‡è¦çš„æ˜¯æœ‰æ²‰æ·€ï¼Œæœ‰åˆ©äºéœ€æ±‚å®Œæˆåçš„å›é¡¾ï¼ŒåŠæ—¶å‡ å¹´åçœ‹åˆ°è‡ªå·±ç”»çš„ç”˜ç‰¹å›¾ï¼Œä¹Ÿèƒ½å¾ˆå¿«çš„å›å¿†èµ·å½“æ—¶åšéœ€æ±‚çš„é—®é¢˜ä¸å›°éš¾ï¼Œå……å½“éœ€æ±‚å¿«ç…§çš„ä½œç”¨ã€‚</p><p>æ ¸å¿ƒæ€æƒ³: When</p><h2 id="ä»æ–¹æ¡ˆè®¾è®¡åˆ°å‘å¸ƒä¸Šçº¿"><a href="#ä»æ–¹æ¡ˆè®¾è®¡åˆ°å‘å¸ƒä¸Šçº¿" class="headerlink" title="ä»æ–¹æ¡ˆè®¾è®¡åˆ°å‘å¸ƒä¸Šçº¿"></a>ä»æ–¹æ¡ˆè®¾è®¡åˆ°å‘å¸ƒä¸Šçº¿</h2><p>ä»æ–¹æ¡ˆè®¾è®¡åˆ°å‘å¸ƒä¸Šçº¿ï¼ŒåŸºæœ¬å±äºå¼€å‘å’Œæµ‹è¯•çš„å·¥ä½œã€‚æ–¹æ¡ˆè®¾è®¡èƒ½å…·ä½“é‡åŒ–éœ€æ±‚æ–¹æ¡ˆï¼Œä¹Ÿèƒ½æœ‰æ•ˆä¿è¯å¼€å‘è¿›åº¦ï¼Œè¿™ä¸€ç¯èŠ‚å¿…ä¸å¯å°‘ã€‚å¼€å‘å’Œæµ‹è¯•çš„æœ‰æ•ˆæ²Ÿé€šä¹Ÿèƒ½å¸®åŠ©å¼€å‘æ‰¾åˆ°ä»£ç æ¼æ´ï¼Œé¿å…å‘å¸ƒä¸Šçº¿åå¸¦æ¥çš„äº‹æ•…ï¼Œè¿™äº›ç¯èŠ‚ååˆ†é‡è¦ã€‚</p><h3 id="æ–¹æ¡ˆè®¾è®¡"><a href="#æ–¹æ¡ˆè®¾è®¡" class="headerlink" title="æ–¹æ¡ˆè®¾è®¡"></a>æ–¹æ¡ˆè®¾è®¡</h3><p>æ–¹æ¡ˆè®¾è®¡æœ‰å¤šé¦™ï¼Œä½“éªŒè¿‡çš„äººéƒ½çŸ¥é“ã€‚å®ƒçš„å¥½å¤„åœ¨äºå…¨å±€çš„æ€è€ƒéœ€æ±‚ï¼Œæ¯”è¾ƒå®¹æ˜“ç»™å‡ºå…¨å±€æœ€ä¼˜ï¼Œè€Œä¸ä»…ä»…æ˜¯å±€éƒ¨æœ€ä¼˜ã€‚æ–¹æ¡ˆè®¾è®¡ä¸ä»…åœ¨å¼€å‘é˜¶æ®µèµ·ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ï¼Œè¿˜å¯¹åç»­ç»´æŠ¤æœ‰å¾ˆå¤§çš„ä¾¿åˆ©ã€‚æ–¹æ¡ˆè®¾è®¡å¯ä»¥å›´ç»•è¿™å‡ ç‚¹å†™ï¼š</p><ul><li>æ—¶é—´äººç‰©ï¼šæ ‡æ³¨éœ€æ±‚å…³é”®çš„æ—¶é—´èŠ‚ç‚¹å’Œå‚ä¸æ–¹</li><li>ä¸šå†…æ–¹æ¡ˆï¼šä¾‹å¦‚ä¸šå†…å®ç°å’Œç«å“åˆ†æç­‰</li><li>æ–¹æ¡ˆè®¾è®¡ï¼šæ–¹æ¡ˆçš„å…·ä½“é€»è¾‘ï¼ŒåŒ…æ‹¬è®¾è®¡ç¨¿ã€æµç¨‹å›¾ã€åº“è¡¨å­—æ®µç­‰</li><li>å…¶ä»–ï¼šæµç¨‹å¡ç‚¹ã€è‡ªæˆ‘åæ€æˆ–ç»“è®ºç•™åº•ç­‰<h3 id="å¤„ç†-bug-çš„è§„çŸ©"><a href="#å¤„ç†-bug-çš„è§„çŸ©" class="headerlink" title="å¤„ç† bug çš„è§„çŸ©"></a>å¤„ç† bug çš„è§„çŸ©</h3>äº§å“æ˜¯å¼€å‘çš„ä¸Šæ¸¸ï¼Œæµ‹è¯•æ˜¯å¼€å‘çš„ä¸‹æ¸¸ã€‚æµ‹è¯•åŒå­¦å¯¹äº§å“å½¢æ€çš„è¡¨ç°ç”šè‡³æ¯”äº§å“è¿˜æ›´å…³å¿ƒï¼Œå¤šå’Œæµ‹è¯•åŒå­¦æ²Ÿé€šï¼Œä¹Ÿèƒ½è®©äº§å“æœ‰æ›´è‰¯å¥½çš„å‘å±•ã€‚è¦å’Œæµ‹è¯•åšæœ‹å‹ï¼Œä»æ¥ä¸€æ¯å¥¶èŒ¶åšèµ·ã€‚å½“ç„¶ç«‹å¥½è§„çŸ©ä¹Ÿèƒ½é¿å…åœ¨éœ€æ±‚æµ‹è¯•è¿‡ç¨‹ä¸­å¢åŠ æ²Ÿé€šæˆæœ¬ã€‚</li><li>æå•å‰ï¼šå…ˆæ²Ÿé€šåˆ°åº•æ˜¯å¼€å‘åŸå› è¿˜æ˜¯å…¶ä»–åŸå› ï¼Œå®šå¥½è´£ä»»æ–¹ä¸ä¼˜å…ˆçº§</li><li>æå•æ—¶ï¼šå¿…é¡»åŒ…å«å¤ç°è·¯å¾„åŠæˆªå›¾ï¼Œæœ€å¥½åŒ…å«è´¦å·ä¿¡æ¯å’Œå½•å±</li><li>æå•åï¼šéå¿…è¦åœºæ™¯æ²Ÿé€šèƒ½å¦é™ä½ä¼˜å…ˆçº§ï¼Œä¸å¥½è§£å†³çš„é—®é¢˜èƒ½å¦è½¬æˆéœ€æ±‚å•<h3 id="å‘å¸ƒæ¡ä¾‹"><a href="#å‘å¸ƒæ¡ä¾‹" class="headerlink" title="å‘å¸ƒæ¡ä¾‹"></a>å‘å¸ƒæ¡ä¾‹</h3>æµç¨‹çš„å»ºç«‹å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å¯¹äººçš„ä¿æŠ¤ï¼Œéµå¾ªæµç¨‹èƒ½æœ‰æ•ˆç¨‹åº¦ä¸Šä¿æŠ¤è‡ªå·±ã€‚</li><li>å‘å¸ƒè®¡åˆ’ï¼šåˆ—å¥½å‘å¸ƒè®¡åˆ’ï¼Œä» MRã€ä»£ç åˆ°é…ç½®ï¼Œä½¿ç”¨å‘å¸ƒæ ‡è®°è®°å½•æ¯ä¸ªå‘å¸ƒæ—¶é—´ç‚¹</li><li>å‘å¸ƒé€æ˜ï¼šéœ€è¦å‘çš„åŠŸèƒ½ã€bugfixå’Œå‹æµ‹æ¥å£æ˜ç¡®çŸ¥ä¼š</li><li>åšå¥½ç°åº¦ï¼šå‘å¸ƒçš„åŠŸèƒ½éµå¾ªä¸€å®šè§„åˆ™ç°åº¦</li><li>ç«‹åˆ»éªŒè¯ï¼šå‘å¸ƒåçš„ç¬¬ä¸€æ—¶é—´çº¿ä¸ŠéªŒè¯ï¼Œä¿è¯å‘å¸ƒåŠŸèƒ½æ­£å¸¸</li><li>ç•™å®ˆä¿éšœï¼šç•™å®ˆä¸€å®šçš„æ—¶é—´ï¼Œä¿è¯å‘å¸ƒåæ— æ˜æ˜¾æ³¢åŠ¨ï¼Œæ–¹ä¾¿æœ‰é—®é¢˜åŠæ—¶å“åº”<br>æ ¸å¿ƒæ€æƒ³: è§„çŸ©</li></ul><h2 id="äº‹æ•…ä¸å¤ç›˜"><a href="#äº‹æ•…ä¸å¤ç›˜" class="headerlink" title="äº‹æ•…ä¸å¤ç›˜"></a>äº‹æ•…ä¸å¤ç›˜</h2><p>åœ¨éœ€æ±‚å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œäº‹æ•…éš¾å…ä¼šå‘ç”Ÿã€‚åŠæ—¶ã€æ­£ç¡®çš„å¤„ç†äº‹æ•…ï¼Œåœ¨èŒåœºä¸Šæ˜¯å¯¹è‡ªå·±çš„ä¿æŠ¤ã€‚åŒæ ·èƒ½å¸®åŠ©è‡ªå·±æ›´å¿«çš„æˆé•¿ï¼Œå‡å°‘ç›¸åŒé”™è¯¯çš„å‘ç”Ÿã€‚</p><h3 id="é€æ˜åŸåˆ™"><a href="#é€æ˜åŸåˆ™" class="headerlink" title="é€æ˜åŸåˆ™"></a>é€æ˜åŸåˆ™</h3><p>äº‹æ•…å‘ç”Ÿåç¬¬ä¸€æ—¶é—´å‘ä¸Šçº§æ±‡æŠ¥ï¼Œå¹¶å®šæ—¶æ±‡æŠ¥è¿›åº¦ï¼Œå³ä¾¿æ˜¯è‡ªå·±é—¯å‡ºæ¥çš„ã€‚é‡åˆ°äº‹æ•…å»ºè®®å¤„ç†æ–¹å¼ï¼š</p><ul><li>äº‹æ•…å‘ç”Ÿæ—¶ï¼š<br>1ã€å¤§ç¾¤é‡Œè‰¾ç‰¹ç›¸å…³åŒå­¦åŠä¸Šçº§ï¼Œå¹¶åŒæ—¶ç”µè¯ä¸Šçº§ï¼Œç¡®è®¤ä¿¡æ¯åŒæ­¥å®Œå…¨<br>2ã€èƒ½æ¢å¤ç«‹åˆ»æ¢å¤<br>3ã€æ¯éš”å‡ åˆ†é’Ÿå‘ä¸Šæ±‡æŠ¥ï¼Œå³ä½¿æ²¡æœ‰è¿›åº¦<br>4ã€å‘ä¸Šçº§å¯»æ±‚å¸®åŠ©ï¼Œç›´åˆ°é—®é¢˜è§£å†³</li><li>äº‹æ•…å‘ç”Ÿåï¼šåæ€ä¸æ²‰æ·€</li></ul><h3 id="å¤„ç†äº‹æ•…çš„äº”è¦ç´ "><a href="#å¤„ç†äº‹æ•…çš„äº”è¦ç´ " class="headerlink" title="å¤„ç†äº‹æ•…çš„äº”è¦ç´ "></a>å¤„ç†äº‹æ•…çš„äº”è¦ç´ </h3><ul><li>å®šä¹‰é—®é¢˜ï¼šèƒ½ä¸èƒ½é‡åŒ–æŒ‡æ ‡ï¼Œæ¯”å¦‚å‡ºç°è·¯å¾„ã€æŒ‡æ ‡æ•°æ®ç¯</li><li>å‘ç°é—®é¢˜ï¼šèƒ½ä¸èƒ½æœ‰ç›‘æ§ï¼ŒåŠæ—¶å’Œå‡†ç¡®çš„å‘Šè­¦</li><li>åˆ†æé—®é¢˜ï¼šèƒ½ä¸èƒ½æœ‰å·¥å…·è¾…åŠ©ï¼Œæå‡åˆ†æé—®é¢˜çš„æ•ˆç‡</li><li>è§£å†³é—®é¢˜ï¼šèƒ½ä¸èƒ½ç¬¬ä¸€æ—¶é—´ä¿®å¤ï¼Œä¸ºç”¨æˆ·è§£å†³é—®é¢˜</li><li>é¢„é˜²é—®é¢˜ï¼šèƒ½ä¸èƒ½è¡¥å……ç›¸å…³caseï¼Œä¿è¯çŠ¯è¿‡çš„é”™è¯¯ä¸å†çŠ¯</li></ul><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å†™åˆ°è¿™é‡ŒåŸºæœ¬å®Œæˆäº†ï¼Œæ¯ä¸ªç‚¹ç¬”è€…éƒ½äº²èº«ç»å†è¿‡ä¹Ÿå®è·µè¿‡ã€‚ä»â€œå¹´è½»â€åˆ°â€œè€â€ç¨‹åºå‘˜ï¼Œç£¨å¹³äº†å¾ˆå¤šå†²åŠ¨ä¸è½æ’ï¼Œæ²‰æ·€äº†å„ä¸ªæµç¨‹çš„â€œæœ€ä½³å®è·µâ€ã€‚å¦‚ä»Šå¸¦å°æœ‹å‹ä¸€èµ·å¹²æ´»ï¼Œå¯¹æˆ‘è€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸ªå…¨æ–°çš„é˜¶æ®µã€‚è¿™ç¯‡æ–‡ç« ä¹Ÿç®—ä¸ºä¸Šé˜¶æ®µçš„æ€è€ƒåšæ²‰æ·€å§ï¼Œä¹Ÿå¸Œæœ›å¸®åŠ©åˆ°æœ‰éœ€è¦çš„äººã€‚<br>æ„Ÿè°¢ä½ é˜…è¯»åˆ°è¿™é‡Œã€‚</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://blog.gdccwxx.com/å‰ç«¯/font-end-optimize/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="gdccwxx"><meta itemprop="description" content><meta itemprop="image" content="/img/logo-gray.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="gdccwxx"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/å‰ç«¯/font-end-optimize/" itemprop="url">å‰ç«¯æ€§èƒ½ä¼˜åŒ–</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">å‘è¡¨äº</span> <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-05-11T23:46:04+08:00">2019-05-11</time></span></div></header><div class="post-body" itemprop="articleBody"><h3 id="èµ„æºåˆå¹¶ä¸å‹ç¼©-httpè¯·æ±‚çš„è¿‡ç¨‹åŠæ½œåœ¨çš„æ€§èƒ½ä¼˜åŒ–"><a href="#èµ„æºåˆå¹¶ä¸å‹ç¼©-httpè¯·æ±‚çš„è¿‡ç¨‹åŠæ½œåœ¨çš„æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="èµ„æºåˆå¹¶ä¸å‹ç¼©-httpè¯·æ±‚çš„è¿‡ç¨‹åŠæ½œåœ¨çš„æ€§èƒ½ä¼˜åŒ–"></a>èµ„æºåˆå¹¶ä¸å‹ç¼©-httpè¯·æ±‚çš„è¿‡ç¨‹åŠæ½œåœ¨çš„æ€§èƒ½ä¼˜åŒ–</h3><p>æµè§ˆå™¨çš„ä¸€ä¸ªè¯·æ±‚ä»å‘é€åˆ°è¿”å›éƒ½ç»å†äº†ä»€ä¹ˆ</p><p><img src="/img/loading.gif" data-original="/å‰ç«¯/font-end-optimize/page-process.png" alt="http"></p><p>æ€è€ƒ</p><ul><li>dnsæ˜¯å¦å¯ä»¥é€šè¿‡ç¼“å­˜å‡å°‘dnsæŸ¥è¯¢æ—¶é—´ï¼Ÿ</li><li>ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹èµ°æœ€è¿‘çš„ç½‘ç»œç¯å¢ƒï¼Ÿ</li><li>ç›¸åŒçš„é™æ€èµ„æºæ˜¯å¦å¯ä»¥ç¼“å­˜ï¼Ÿ</li><li>èƒ½å¦å‡å°‘è¯·æ±‚httpè¯·æ±‚å¤§å°ï¼Ÿ</li><li>å‡å°‘httpè¯·æ±‚</li><li>æœåŠ¡ç«¯æ¸²æŸ“<h2 id="é‡ç»˜å’Œå›æµ"><a href="#é‡ç»˜å’Œå›æµ" class="headerlink" title="é‡ç»˜å’Œå›æµ"></a>é‡ç»˜å’Œå›æµ</h2><h3 id="cssä¼šè®©JavaScriptå˜æ…¢å—"><a href="#cssä¼šè®©JavaScriptå˜æ…¢å—" class="headerlink" title="cssä¼šè®©JavaScriptå˜æ…¢å—"></a>cssä¼šè®©JavaScriptå˜æ…¢å—</h3>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒJavaScript<br>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ¸²æŸ“<br>é¢‘ç¹è§¦å‘é‡ç»˜å’Œå›æµï¼Œå¯¼è‡´UIæ¸²æŸ“é¢‘ç¹ï¼Œæœ€é‡å¯¼è‡´jså˜æ…¢<h3 id="å•¥æ˜¯é‡ç»˜å’Œå›æµ"><a href="#å•¥æ˜¯é‡ç»˜å’Œå›æµ" class="headerlink" title="å•¥æ˜¯é‡ç»˜å’Œå›æµ"></a>å•¥æ˜¯é‡ç»˜å’Œå›æµ</h3><h4 id="å›æµ"><a href="#å›æµ" class="headerlink" title="å›æµ"></a>å›æµ</h4></li><li>å½“render treeä¸­çš„ä¸€éƒ¨åˆ†æˆ–å…¨éƒ¨å› ä¸ºå…ƒç´ è§„æ¨¡å°ºå¯¸ï¼Œå¸ƒå±€ï¼Œéšè—ç­‰æ”¹å˜éœ€è¦é‡æ–°æ„å»ºï¼Œç§°ä½œä¸ºå›æµï¼ˆreflowï¼‰</li><li>å½“é¡µé¢å¸ƒå±€å’Œå‡ ä½•å±æ€§å˜åŒ–æ—¶ï¼Œå°±éœ€è¦å›æµ<h4 id="é‡ç»˜"><a href="#é‡ç»˜" class="headerlink" title="é‡ç»˜"></a>é‡ç»˜</h4>å½“render treeä¸­çš„ä¸€äº›å…ƒç´ éœ€è¦æ›´æ–°å±æ€§ï¼Œè€Œè¿™äº›å±æ€§åªæ˜¯å½±å“å…ƒç´ å¤–è§‚ï¼Œé£æ ¼ï¼Œè€Œä¸ä¼šå½±å“å¸ƒå±€çš„ï¼Œæ¯”å¦‚background-colorï¼Œåˆ™ç§°ä¹‹ä¸ºé‡ç»˜</li></ul><p>å›æµä¸€å®šä¼šé‡ç»˜ï¼Œé‡ç»˜ä¸ä¸€å®šä¼šå›æµ</p><h3 id="è§¦å‘é¡µé¢é‡å¸ƒå±€çš„å±æ€§"><a href="#è§¦å‘é¡µé¢é‡å¸ƒå±€çš„å±æ€§" class="headerlink" title="è§¦å‘é¡µé¢é‡å¸ƒå±€çš„å±æ€§"></a>è§¦å‘é¡µé¢é‡å¸ƒå±€çš„å±æ€§</h3><ul><li>ç›’å­æ¨¡å‹ç›¸å…³å±æ€§ä¼šè§¦å‘é‡å¸ƒå±€</li><li>å®šä½å±æ€§åŠæµ®åŠ¨ä¼šè§¦å‘é¡µé¢é‡å¸ƒå±€</li><li>æ”¹å˜èŠ‚ç‚¹å†…éƒ¨æ–‡å­—ç»“æ„ä¼šè§¦å‘é‡å¸ƒå±€<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">width			top			text-align</span><br><span class="line">height			bottom		overflow-y</span><br><span class="line">padding			left		font-weight</span><br><span class="line">margin			right		overflow</span><br><span class="line">display			position	font-family</span><br><span class="line">border-width	float		line-height</span><br><span class="line">border			clear		vertical-align</span><br><span class="line">min-height					white-space</span><br><span class="line">							font-size</span><br></pre></td></tr></table></figure></li></ul><h3 id="è§¦å‘é¡µé¢é‡ç»˜çš„å±æ€§"><a href="#è§¦å‘é¡µé¢é‡ç»˜çš„å±æ€§" class="headerlink" title="è§¦å‘é¡µé¢é‡ç»˜çš„å±æ€§"></a>è§¦å‘é¡µé¢é‡ç»˜çš„å±æ€§</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">color				border-style</span><br><span class="line">border-radius		visibility</span><br><span class="line">text-decoration		background</span><br><span class="line">background-image	background-position</span><br><span class="line">background-repeat	background-size</span><br><span class="line">outline-color		outline</span><br><span class="line">outline-style		outline-width</span><br><span class="line">box-shadow</span><br></pre></td></tr></table></figure><h3 id="æ–°å»ºDOMè¿‡ç¨‹"><a href="#æ–°å»ºDOMè¿‡ç¨‹" class="headerlink" title="æ–°å»ºDOMè¿‡ç¨‹"></a>æ–°å»ºDOMè¿‡ç¨‹</h3><p>1ã€ è·å–DOMååˆ†å‰²ä¸ºå¤šä¸ªå›¾å±‚<br>2ã€ å¯¹æ¯ä¸ªå›¾å±‚çš„é˜¶æ®µè®¡ç®—æ ·å¼ç»“æœ(recalulate style â€” æ ·å¼é‡è®¡ç®—)<br>3ã€ ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆå›¾å½¢å’Œä½ç½®(Layoutâ€” å›æµå’Œé‡å¸ƒå±€)<br>4ã€ å°†æ¯ä¸ªèŠ‚ç‚¹ç»˜åˆ¶å¡«å……åˆ°å›¾å±‚ä½ç½®ä¸­(Paint setup å’ŒPaint â€” é‡ç»˜)<br>5ã€ å›¾å±‚ä½œä¸ºçº¹ç†ä¸Šä¼ è‡³gpu<br>6ã€ ç¬¦åˆå¤šä¸ªå›¾å±‚åˆ°é¡µé¢ä¸Šç”Ÿæˆæœ€ç»ˆå±å¹•å›¾åƒ(composite layers â€” å›¾å±‚é‡ç»„)</p><h3 id="å‡å°‘é‡ç»˜å’Œå›æµ"><a href="#å‡å°‘é‡ç»˜å’Œå›æµ" class="headerlink" title="å‡å°‘é‡ç»˜å’Œå›æµ"></a>å‡å°‘é‡ç»˜å’Œå›æµ</h3><p>é¿å…é‡ç»˜å›æµçš„css<br>å°†é¢‘ç¹é‡ç»˜å’Œå›æµçš„domå…ƒç´ å•ç‹¬ä½œä¸ºç‹¬ç«‹å›¾å±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªdomå…ƒç´ åªä¼šå½±å“è¿™ä¸ªç‹¬ç«‹å›¾å±‚</p><h3 id="å¦‚ä½•å°†DOMåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾å±‚"><a href="#å¦‚ä½•å°†DOMåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾å±‚" class="headerlink" title="å¦‚ä½•å°†DOMåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾å±‚"></a>å¦‚ä½•å°†DOMåˆ›å»ºä¸€ä¸ªæ–°çš„å›¾å±‚</h3><p>1ã€3Dæˆ–è€…é€è§†å˜åŒ–CSSå±æ€§(perspective transform)<br>2ã€ ä½¿ç”¨åŠ é€Ÿè§†å±è§£ç çš„ video èŠ‚ç‚¹<br>3ã€æ‹¥æœ‰3D(webGL)ä¸Šä¸‹æ–‡æˆ–åŠ é€Ÿçš„2Dä¸Šä¸‹æ–‡çš„ canvas èŠ‚ç‚¹<br>4ã€æ··åˆæ’ä»¶(å¦‚flash)<br>5ã€å¯¹è‡ªå·±çš„opacityåšcssåŠ¨ç”»æˆ–ä½¿ç”¨ä¸€ä¸ªåŠ¨ç”»webkitå˜æ¢çš„å…ƒç´ <br>6ã€ä½¿ç”¨åŠ é€ŸCSSè¿‡æ»¤å™¨çš„å…ƒç´ (translate3D..)<br>7ã€å…ƒç´ æœ‰ä¸€ä¸ªåŒ…å«å¤åˆå±‚çš„åä»£èŠ‚ç‚¹(ä¸€ä¸ªå…ƒç´ æ‹¥æœ‰ä¸€ä¸ªå­å…ƒç´ ï¼Œè¯¥å…ƒç´ åœ¨è‡ªå·±çš„å±‚é‡Œ)<br>8ã€å…ƒç´ æœ‰ä¸€ä¸ªz-indexè¾ƒä½ä¸”åŒ…å«ä¸€ä¸ªç¬¦åˆå±‚çš„å…„å¼Ÿå…ƒç´ (è¯¥å…ƒæ¸²æŸ“åœ¨ç¬¦åˆå±‚ä¸Šé¢æ¸²æŸ“)</p><h3 id="é¿å…é‡ç»˜å›æµ"><a href="#é¿å…é‡ç»˜å›æµ" class="headerlink" title="é¿å…é‡ç»˜å›æµ"></a>é¿å…é‡ç»˜å›æµ</h3><p>1ã€ç”¨translateæ›¿ä»£topï¼štopä¼šè§¦å‘å›æµè€Œtranslateä¸ä¼š<br>2ã€ç”¨opacityæ›¿ä»£visibilityï¼švisibilityä¼šè§¦å‘é‡ç»˜è€Œopacityä¸ä¼š<br>3ã€ä¸è¦ä¸€æ¡æ¡ä¿®æ”¹DOMä¿®æ”¹æ ·å¼ï¼Œå¯ä»¥æ”¾åœ¨ä¸€ä¸ªclasså†…ï¼Œæ›¿æ¢class<br>4ã€ç¦»çº¿ä¿®æ”¹ï¼Œä½¿ç”¨display-noneä¿®æ”¹å…ƒç´ å†æ˜¾ç¤º<br>5ã€ä¸è¦æŠŠDOMèŠ‚ç‚¹å±æ€§å€¼æ”¾åœ¨ä¸€ä¸ªå¾ªç¯é‡Œçš„å˜é‡é‡Œï¼ˆoffsetHightï¼Œ offsetWidthï¼‰<br>6ã€ä¸ä½¿ç”¨tableå¸ƒå±€ï¼Œå¯èƒ½å¾ˆå°çš„ä¿®æ”¹å¯¼è‡´æ•´ä¸ªtableé‡æ–°å¸ƒå±€<br>7ã€åŠ¨ç”»å®ç°çš„é€Ÿåº¦çš„é€‰æ‹©<br>8ã€å¯¹äºåŠ¨ç”»æ–°å»ºå›¾å±‚ (gitå›¾åŠ ä¸Šwill-change, transform)<br>9ã€ä½¿ç”¨GPUç¡¬ä»¶åŠ é€Ÿ(trasform: translateZ, trasform: transform3d(0,0,0))</p><h2 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h2><ul><li>HTML5è®¾è®¡å‡ºæ¥ä¸“é—¨ç”¨äºæµè§ˆå™¨å­˜å‚¨çš„</li><li>å¤§å°ä¸º5Må·¦å³</li><li>å°½åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¸å’ŒæœåŠ¡ç«¯é€šä¿¡</li><li>æ¥å£å°è£…æ¯”è¾ƒå¥½</li><li>æµè§ˆå™¨æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆ</li></ul><h2 id="SessionStorage"><a href="#SessionStorage" class="headerlink" title="SessionStorage"></a>SessionStorage</h2><ul><li>ä¼šè¯çº§åˆ«çš„æµè§ˆå™¨å­˜å‚¨</li><li>å¤§å°ä¸º5Må·¦å³</li><li>ä»…åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œä¸å’ŒæœåŠ¡å™¨ç«¯é€šä¿¡</li><li>æ¥å£å°è£…è¾ƒå¥½</li><li>å¯¹äºè¡¨å•ä¿¡æ¯çš„ç»´æŠ¤</li></ul><h2 id="indexDB"><a href="#indexDB" class="headerlink" title="indexDB"></a>indexDB</h2><ul><li>IndexedDB æ˜¯ä¸€ç§ä½çº§APIï¼Œç”¨äºå®¢æˆ·ç«¯å­˜å‚¨å¤§é‡ç»“æ„åŒ–æ•°æ®(åŒ…æ‹¬, æ–‡ä»¶/ blobs)ã€‚è¯¥APIä½¿ç”¨ç´¢å¼•æ¥å®ç°å¯¹è¯¥æ•°æ®çš„é«˜æ€§èƒ½æœç´¢ã€‚è™½ç„¶ Web Storage å¯¹äºå­˜å‚¨è¾ƒå°‘é‡çš„æ•°æ®å¾ˆæœ‰ç”¨ï¼Œä½†å¯¹äºå­˜å‚¨æ›´å¤§é‡çš„ç»“æ„åŒ–æ•°æ®æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•ä¸å¤ªæœ‰ç”¨ã€‚IndexedDBæä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚</li><li>ä¸ºåº”ç”¨åˆ›å»ºç¦»çº¿ç‰ˆæœ¬</li></ul><h2 id="PWA"><a href="#PWA" class="headerlink" title="PWA"></a>PWA</h2><p>Progressive Web App, ç®€ç§° PWAï¼Œæ˜¯æå‡ Web App çš„ä½“éªŒçš„ä¸€ç§æ–°æ–¹æ³•ï¼Œèƒ½ç»™ç”¨æˆ·åŸç”Ÿåº”ç”¨çš„ä½“éªŒã€‚</p><p>PWA èƒ½åšåˆ°åŸç”Ÿåº”ç”¨çš„ä½“éªŒä¸æ˜¯é ç‰¹æŒ‡æŸä¸€é¡¹æŠ€æœ¯ï¼Œè€Œæ˜¯ç»è¿‡åº”ç”¨ä¸€äº›æ–°æŠ€æœ¯è¿›è¡Œæ”¹è¿›ï¼Œåœ¨å®‰å…¨ã€æ€§èƒ½å’Œä½“éªŒä¸‰ä¸ªæ–¹é¢éƒ½æœ‰å¾ˆå¤§æå‡ï¼ŒPWA æœ¬è´¨ä¸Šæ˜¯ Web Appï¼Œå€ŸåŠ©ä¸€äº›æ–°æŠ€æœ¯ä¹Ÿå…·å¤‡äº† Native App çš„ä¸€äº›ç‰¹æ€§ï¼Œå…¼å…· Web App å’Œ Native App çš„ä¼˜ç‚¹ã€‚</p><p>PWA çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ä¸‹é¢ä¸‰ç‚¹ï¼š</p><p>å¯é  - å³ä½¿åœ¨ä¸ç¨³å®šçš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¹Ÿèƒ½ç¬é—´åŠ è½½å¹¶å±•ç°<br>ä½“éªŒ - å¿«é€Ÿå“åº”ï¼Œå¹¶ä¸”æœ‰å¹³æ»‘çš„åŠ¨ç”»å“åº”ç”¨æˆ·çš„æ“ä½œ<br>ç²˜æ€§ - åƒè®¾å¤‡ä¸Šçš„åŸç”Ÿåº”ç”¨ï¼Œå…·æœ‰æ²‰æµ¸å¼çš„ç”¨æˆ·ä½“éªŒï¼Œç”¨æˆ·å¯ä»¥æ·»åŠ åˆ°æ¡Œé¢<br>PWA æœ¬èº«å¼ºè°ƒæ¸è¿›å¼ï¼Œå¹¶ä¸è¦æ±‚ä¸€æ¬¡æ€§è¾¾åˆ°å®‰å…¨ã€æ€§èƒ½å’Œä½“éªŒä¸Šçš„æ‰€æœ‰è¦æ±‚ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ PWA Checklist æŸ¥çœ‹ç°æœ‰çš„ç‰¹å¾ã€‚</p><h2 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a>Service Worker</h2><p>1ã€ä½¿ç”¨æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚èƒ½åŠ›ï¼Œå®ç°ç¦»çº¿åº”ç”¨<br>2ã€ä½¿ç”¨Service Workeråœ¨åå°è¿è¡ŒåŒæ—¶å’Œé¡µé¢é€šä¿¡çš„èƒ½åŠ›ï¼Œè¶‹åŠ¿çº¿å¤§è§„æ¨¡åå°æ•°æ®å¤„ç†</p><h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><h3 id="httpheader"><a href="#httpheader" class="headerlink" title="httpheader"></a>httpheader</h3><h4 id="Cache-Control"><a href="#Cache-Control" class="headerlink" title="Cache-Control"></a>Cache-Control</h4><ul><li>max-age=â€secondsâ€<br>è®¾ç½®ç¼“å­˜å­˜å‚¨çš„æœ€å¤§å‘¨æœŸï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´ç¼“å­˜è¢«è®¤ä¸ºè¿‡æœŸ(å•ä½ç§’)ã€‚ä¸Expiresç›¸åï¼Œæ—¶é—´æ˜¯ç›¸å¯¹äºè¯·æ±‚çš„æ—¶é—´ã€‚</li><li>s-maxage=â€secondsâ€<br>è¦†ç›–max-age æˆ–è€… Expires å¤´ï¼Œä½†æ˜¯ä»…é€‚ç”¨äºå…±äº«ç¼“å­˜(æ¯”å¦‚å„ä¸ªä»£ç†)ï¼Œå¹¶ä¸”ç§æœ‰ç¼“å­˜ä¸­å®ƒè¢«å¿½ç•¥ã€‚</li><li>public<br>è¡¨æ˜å“åº”å¯ä»¥è¢«ä»»ä½•å¯¹è±¡ï¼ˆåŒ…æ‹¬ï¼šå‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œä»£ç†æœåŠ¡å™¨ï¼Œç­‰ç­‰ï¼‰ç¼“å­˜ã€‚</li><li>private<br>è¡¨æ˜å“åº”åªèƒ½è¢«å•ä¸ªç”¨æˆ·ç¼“å­˜ï¼Œä¸èƒ½ä½œä¸ºå…±äº«ç¼“å­˜ï¼ˆå³ä»£ç†æœåŠ¡å™¨ä¸èƒ½ç¼“å­˜å®ƒï¼‰,å¯ä»¥ç¼“å­˜å“åº”å†…å®¹ã€‚</li><li>no-cache<br>åœ¨å‘å¸ƒç¼“å­˜å‰¯æœ¬ä¹‹å‰ï¼Œå¼ºåˆ¶é«˜é€Ÿç¼“å­˜å°†è¯·æ±‚æäº¤ç»™åŸå§‹æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ã€‚</li><li>no-store<br>ç¼“å­˜ä¸åº”å­˜å‚¨æœ‰å…³å®¢æˆ·ç«¯è¯·æ±‚æˆ–æœåŠ¡å™¨å“åº”çš„ä»»ä½•å†…å®¹ã€‚<h4 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h4></li><li>ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œç”¨æ¥æŒ‡å®šèµ„æºåˆ°æœŸæ—¶é—´ï¼Œæ˜¯æœåŠ¡å™¨ç«¯çš„å…·ä½“çš„æ—¶é—´ç‚¹</li><li>å‘Šè¯‰æµè§ˆå™¨åœ¨è¿‡æœŸæ—¶é—´å‰æµè§ˆå™¨å¯ä»¥ç›´æ¥ä»æµè§ˆå™¨ç¼“å­˜å»æ•°æ®ï¼Œæ— éœ€å†æ¬¡è¯·æ±‚<h4 id="Last-Modified-If-Modified-Since"><a href="#Last-Modified-If-Modified-Since" class="headerlink" title="Last-Modified/If-Modified-Since"></a>Last-Modified/If-Modified-Since</h4><h5 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h5>The Last-Modified æ˜¯ä¸€ä¸ªå“åº”é¦–éƒ¨ï¼Œå…¶ä¸­åŒ…å«æºå¤´æœåŠ¡å™¨è®¤å®šçš„èµ„æºåšå‡ºä¿®æ”¹çš„æ—¥æœŸåŠæ—¶é—´ã€‚ å®ƒé€šå¸¸è¢«ç”¨ä½œä¸€ä¸ªéªŒè¯å™¨æ¥åˆ¤æ–­æ¥æ”¶åˆ°çš„æˆ–è€…å­˜å‚¨çš„èµ„æºæ˜¯å¦å½¼æ­¤ä¸€è‡´<br>1ã€è¯·æ±‚æµè§ˆå™¨ï¼Œç»™åˆ°ç¼“å­˜æ–‡ä»¶ï¼Œresponseå¸¦æœ‰last-modified ç»™åˆ°æµè§ˆå™¨å­˜å‚¨ä¸ºlast-modified-since<br>2ã€æµè§ˆå™¨å†æ¬¡è¯·æ±‚æ–‡ä»¶ï¼Œå¸¦æœ‰last-modiied-since, æœåŠ¡å™¨å¯¹æ¯”last-modifiedï¼Œè‹¥è¿‡æœŸåˆ™ç»™åˆ°æ–°çš„æ–‡ä»¶ï¼Œè‹¥ä¸è¿‡æœŸï¼Œåˆ™ç»§ç»­ä½¿ç”¨æœ¬åœ°æ–‡ä»¶<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5>1ã€æŸäº›æœåŠ¡å™¨ä¸èƒ½è·å–ç²¾ç¡®çš„ä¿®æ”¹æ—¶é—´<br>2ã€æ–‡ä»¶ä¿®æ”¹æ—¶é—´æ”¹äº†ï¼Œä½†æ–‡ä»¶å†…å®¹å´æ²¡æœ‰æ”¹å˜<h4 id="Etag-If-None-Match"><a href="#Etag-If-None-Match" class="headerlink" title="Etag/If-None-Match"></a>Etag/If-None-Match</h4></li><li>æ–‡ä»¶å†…å®¹çš„hashå€¼</li><li>etagâ€”â€”response header</li><li>if-none-match â€”â€” request header</li><li>éœ€è¦å’Œcache-controlä¸€èµ·ä½¿ç”¨<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> ---------------------    </span><br><span class="line">					   å½“æµè§ˆå™¨æœ¬åœ°æ²¡æœ‰ç¼“å­˜æˆ–è€…ä¸‹ä¸€å±‚å¤±æ•ˆæ—¶ï¼Œæˆ–è€…ç”¨æˆ·ç‚¹å‡»åˆ·æ–°</span><br><span class="line">\       200çŠ¶æ€        /   æµè§ˆå™¨ç›´æ¥å»æœåŠ¡å™¨ä¸‹è½½æœ€æ–°æ•°æ®</span><br><span class="line"></span><br><span class="line">  -------------------     </span><br><span class="line">					   è¿™ä¸€å±‚ç”± last-modified / Etag æ§åˆ¶,å½“ä¸‹ä¸€å±‚å¤±æ•ˆæ—¶ï¼Œ</span><br><span class="line">  \     304çŠ¶æ€       /    æˆ–ç”¨æˆ·ç‚¹å‡»åˆ·æ–°ï¼Œæµè§ˆå™¨å°±ä¼šå‘é€è¯·æ±‚ç»™æœåŠ¡å™¨ï¼Œå¦‚æœæ–‡ä»¶æ— å˜</span><br><span class="line">					   åŒ–åˆ™è¿”å›304</span><br><span class="line">    ----------------      </span><br><span class="line">				       è¿™å±‚ç”±expires/cache-controlæ§åˆ¶ï¼Œexpires(http 1.0     </span><br><span class="line">    \ 200(from disk) /    æœ‰æ•ˆ)æ˜¯ç»å¯¹æ—¶é—´ï¼Œcache-control(http1.1ç‰ˆæœ‰æ•ˆ)ç›¸å¯¹</span><br><span class="line">					   æ—¶é—´ï¼Œä¸¤è€…éƒ½å­˜åœ¨ï¼Œcache-controlè¦†ç›–expiresï¼Œæ²¡æœ‰å¤±æ•ˆ</span><br><span class="line">      --------------      åˆ™ç›´æ¥è®¿é—®è‡ªå·±ç¼“å­˜</span><br></pre></td></tr></table></figure></li></ul><p><img src="/img/loading.gif" data-original="/å‰ç«¯/font-end-optimize/font-end-cache.png" alt="Alt text"></p><h2 id="æœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–"><a href="#æœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–"></a>æœåŠ¡ç«¯æ€§èƒ½ä¼˜åŒ–</h2><h3 id="å¤šå±‚æ¬¡ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#å¤šå±‚æ¬¡ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="å¤šå±‚æ¬¡ä¼˜åŒ–æ–¹æ¡ˆ"></a>å¤šå±‚æ¬¡ä¼˜åŒ–æ–¹æ¡ˆ</h3><ul><li>æ„å»ºå±‚æ¨¡ç‰ˆç¼–è¯‘</li><li>æ•°æ®æ— å…³prerenderæ–¹å¼</li><li>æœåŠ¡ç«¯æ¸²æŸ“</li></ul></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article></section><nav class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/img/logo-gray.jpg" alt="gdccwxx"><p class="site-author-name" itemprop="name">gdccwxx</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">34</span> <span class="site-state-item-name">æ—¥å¿—</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">14</span> <span class="site-state-item-name">æ ‡ç­¾</span></a></div></nav><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/gdccwxx" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:765553928@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a></span></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">gdccwxx</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}()</script><script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script><script>window.imageLazyLoadSetting={isSPA:!1,preloadRatio:1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=o;var e=n.imageLazyLoadSetting.isSPA,i=n.imageLazyLoadSetting.preloadRatio||1,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight*i||document.documentElement.clientHeight*i)&&function(){var e=r[a],t=e,n=function(){r=r.filter(function(t){return e!==t})},i=new Image,o=t.getAttribute("data-original");i.onload=function(){t.src=o,n()},t.src!==o&&(i.src=o)}()}o(),n.addEventListener("scroll",function(){var t=o,e=n;clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>